"use strict";(self.webpackChunkuwb_client_app=self.webpackChunkuwb_client_app||[]).push([[521],{7378:(J,B,i)=>{i.d(B,{L:()=>T});var n=i(9291),x=i(9185),k=i(4089),m=i(6814),e=i(3999);function Z(g,M){if(1&g){const l=n.EpF();n.TgZ(0,"p-button",2),n.NdJ("onClick",function(){n.CHM(l);const y=n.oxw();return n.KtG(y.onAddClick())}),n.ALo(1,"translate"),n.qZA()}if(2&g){const l=n.oxw();n.Tol(l.styleClass),n.Q6J("disabled",l.disabledAddButton)("icon",l.mobileScreen?"pi pi-plus":"")("label",l.mobileScreen?"":n.lcZ(1,6,"global.buttons.add"))("styleClass",l.mobileScreen?l.mobileScreenStyleButtons:l.smallScreen?l.smallScreenStyleButtons:l.normalScreenStyleButtons)}}function h(g,M){if(1&g){const l=n.EpF();n.TgZ(0,"p-button",2),n.NdJ("onClick",function(){n.CHM(l);const y=n.oxw();return n.KtG(y.onEditClick())}),n.ALo(1,"translate"),n.qZA()}if(2&g){const l=n.oxw();n.Tol(l.styleClass),n.Q6J("disabled",l.disabledEditAndDeleteButton)("icon",l.mobileScreen?"pi pi-pencil":"")("label",l.mobileScreen?"":n.lcZ(1,6,"global.buttons.edit"))("styleClass",l.mobileScreen?l.mobileScreenStyleButtons:l.smallScreen?l.smallScreenStyleButtons:l.normalScreenStyleButtons)}}function A(g,M){if(1&g){const l=n.EpF();n.TgZ(0,"p-button",2),n.NdJ("onClick",function(){n.CHM(l);const y=n.oxw();return n.KtG(y.onDeleteClick())}),n.ALo(1,"translate"),n.qZA()}if(2&g){const l=n.oxw();n.Tol(l.styleClass),n.Q6J("disabled",l.disabledEditAndDeleteButton)("icon",l.mobileScreen?"pi pi-trash":"")("label",l.mobileScreen?"":n.lcZ(1,6,"global.buttons.delete"))("styleClass",l.mobileScreen?l.mobileScreenStyleButtons:l.smallScreen?l.smallScreenStyleButtons:l.normalScreenStyleButtons)}}const U=["*"];let T=(()=>{class g{constructor(l){this.sizeScreenService=l,this.showAddButton=!0,this.showEditButton=!0,this.showDeleteButton=!0,this.disabledAddButton=!1,this.disabledEditAndDeleteButton=!1,this.normalScreenStyleButtons="ui-button_size_175",this.smallScreenStyleButtons="ui-button_size_125",this.mobileScreenStyleButtons="ui-button_size_100",this.styleClass="col-4 px-2",this.emitAddClick=new n.vpe,this.emitEditClick=new n.vpe,this.emitDeleteClick=new n.vpe,this.smallScreen=!1,this.mobileScreen=!1}ngOnInit(){this.sizeScreenService.smallScreen$.subscribe(l=>{this.smallScreen=l}),this.sizeScreenService.mobileScreen$.subscribe(l=>{this.mobileScreen=l})}onAddClick(){this.emitAddClick.emit(!0)}onEditClick(){this.emitEditClick.emit(!0)}onDeleteClick(){this.emitDeleteClick.emit(!0)}}return g.\u0275fac=function(l){return new(l||g)(n.Y36(x.p))},g.\u0275cmp=n.Xpm({type:g,selectors:[["uwb-footer-buttons"]],inputs:{showAddButton:"showAddButton",showEditButton:"showEditButton",showDeleteButton:"showDeleteButton",disabledAddButton:"disabledAddButton",disabledEditAndDeleteButton:"disabledEditAndDeleteButton",normalScreenStyleButtons:"normalScreenStyleButtons",smallScreenStyleButtons:"smallScreenStyleButtons",mobileScreenStyleButtons:"mobileScreenStyleButtons",styleClass:"styleClass"},outputs:{emitAddClick:"emitAddClick",emitEditClick:"emitEditClick",emitDeleteClick:"emitDeleteClick"},ngContentSelectors:U,decls:5,vars:3,consts:[[1,"grid"],[3,"class","disabled","icon","label","styleClass","onClick",4,"ngIf"],[3,"disabled","icon","label","styleClass","onClick"]],template:function(l,w){1&l&&(n.F$t(),n.TgZ(0,"div",0),n.YNc(1,Z,2,8,"p-button",1),n.YNc(2,h,2,8,"p-button",1),n.YNc(3,A,2,8,"p-button",1),n.Hsn(4),n.qZA()),2&l&&(n.xp6(1),n.Q6J("ngIf",w.showAddButton),n.xp6(1),n.Q6J("ngIf",w.showEditButton),n.xp6(1),n.Q6J("ngIf",w.showDeleteButton))},dependencies:[k.zx,m.O5,e.X$]}),g})()},7397:(J,B,i)=>{i.d(B,{s:()=>y});var n=i(9291),x=i(6223),k=i(3562),m=i(2420),e=i(9972),Z=i(737),h=i(6814);function A(p,f){if(1&p){const r=n.EpF();n.TgZ(0,"div",5)(1,"div",6)(2,"input",7),n.NdJ("ngModelChange",function(b){n.CHM(r);const _=n.oxw();return n.KtG(_.filterText=b)})("input",function(b){n.CHM(r);const _=n.oxw();return n.KtG(_.customFilter(b))}),n.qZA(),n._UZ(3,"i",8),n.qZA()()}if(2&p){const r=n.oxw();n.xp6(2),n.Q6J("ngModel",r.filterText)}}function U(p,f){if(1&p&&(n.TgZ(0,"span"),n._uU(1),n.qZA()),2&p){const r=n.oxw().$implicit,c=n.oxw();n.xp6(1),n.hij(" ",null==r?null:r.data[c.optionLabel]," ")}}function T(p,f){if(1&p&&(n.TgZ(0,"span"),n._uU(1),n.qZA()),2&p){const r=n.oxw(2);n.xp6(1),n.hij(" ",r.placeholder," ")}}function g(p,f){if(1&p&&(n.YNc(0,U,2,1,"span",9),n.YNc(1,T,2,1,"span",9)),2&p){const r=f.$implicit,c=n.oxw();n.Q6J("ngIf",null==r?null:r.data),n.xp6(1),n.Q6J("ngIf",!(null!=r&&r.data||c.floatLabel))}}function M(p,f){if(1&p&&(n.TgZ(0,"span",10),n._uU(1),n.ALo(2,"slice"),n.qZA()),2&p){const r=f.$implicit,c=n.oxw();n.s9C("pTooltip",r.data[c.optionLabel]),n.xp6(1),n.hij(" ",r.data[c.optionLabel].length>30?n.Dn7(2,2,r.data[c.optionLabel],0,30)+"...":r.data[c.optionLabel]," ")}}function l(p,f){if(1&p&&(n.TgZ(0,"label",11),n._uU(1),n.qZA()),2&p){const r=n.oxw();n.xp6(1),n.Oqu(r.label)}}const w=function(){return{width:"100%"}};let y=(()=>{class p{constructor(){this.options=[],this.filter=!0,this.label="Wybierz opcje",this.optionLabel="name",this.styleClass="",this.selectionMode="single",this.floatLabel=!0,this.placeholder="",this.modelChange=new n.vpe,this.itemChange=new n.vpe,this.onModelChange=()=>m.Z,this.onModelTouched=()=>m.Z,this.handleOptions=[],this.filterText=""}ngOnChanges(r){r.options&&(this.handleOptions=this.options)}ngAfterViewInit(){this.treeSelect.registerOnChange(this.onModelChange),this.treeSelect.registerOnTouched(this.onModelTouched)}customFilter(r){const c=this.filterText.toLowerCase();""===c?this.options=this.handleOptions:(this.options=this.handleOptions,this.options=this.filterTree(this.options,c))}filterTree(r,c){const b=[];for(const _ of r)if(_?.data&&_.data.name.toLowerCase().includes(c)&&!b.find(E=>E.data.id===_.data.id)&&b.push(_),_.children&&_.children.length>0){const E=this.filterTree(_.children,c);if(E.length>0&&!b.find(D=>D.data.id===_.data.id)){const D={..._};D.children=E,b.push(D)}}return b}writeValue(r){this.treeSelectValue=r}registerOnChange(r){this.onModelChange=r}registerOnTouched(r){this.onModelTouched=r}emitModelAndItemChange(r){this.modelChange.emit(r.node.data),this.emitItemChange({value:r.node.data})}emitItemChange(r){const c=r.value?this.options.find(b=>b?.[this.itemValue]===r.value):void 0;this.itemChange.emit(Object.assign({},r,{item:c??null}))}}return p.\u0275fac=function(r){return new(r||p)},p.\u0275cmp=n.Xpm({type:p,selectors:[["uwb-tree-select"]],viewQuery:function(r,c){if(1&r&&n.Gf(k.mP,7),2&r){let b;n.iGM(b=n.CRH())&&(c.treeSelect=b.first)}},inputs:{options:"options",filter:"filter",label:"label",optionLabel:"optionLabel",treeSelectValue:"treeSelectValue",itemValue:"itemValue",styleClass:"styleClass",selectionMode:"selectionMode",floatLabel:"floatLabel",placeholder:"placeholder"},outputs:{modelChange:"modelChange",itemChange:"itemChange"},features:[n._Bn([{provide:x.JU,useExisting:(0,n.Gpc)(()=>p),multi:!0}]),n.TTD],decls:6,vars:12,consts:[["placeholder","","appendTo","body",3,"ngModel","options","placeholder","selectionMode","ngModelChange","onNodeSelect"],["pTemplate","header"],["pTemplate","value"],["pTemplate","default"],["for","label",4,"ngIf"],[1,"p-treeselect-header"],[1,"p-treeselect-filter-container","p-input-icon-right","custom-filter"],["type","text","autofocus","","placeholder","Filter",1,"p-treeselect-filter","p-inputtext","p-component",3,"ngModel","ngModelChange","input"],[1,"pi","pi-search"],[4,"ngIf"],[3,"pTooltip"],["for","label"]],template:function(r,c){1&r&&(n.TgZ(0,"span")(1,"p-treeSelect",0),n.NdJ("ngModelChange",function(_){return c.treeSelectValue=_})("onNodeSelect",function(_){return c.emitModelAndItemChange(_)}),n.YNc(2,A,4,1,"ng-template",1),n.YNc(3,g,2,2,"ng-template",2),n.YNc(4,M,3,6,"ng-template",3),n.qZA(),n.YNc(5,l,2,1,"label",4),n.qZA()),2&r&&(n.Tol(c.floatLabel?"p-float-label":""),n.xp6(1),n.Akn(n.DdM(11,w)),n.Tol(c.styleClass),n.Q6J("ngModel",c.treeSelectValue)("options",c.options)("placeholder",c.placeholder)("selectionMode",c.selectionMode),n.xp6(4),n.Q6J("ngIf",c.floatLabel))},dependencies:[e.jx,Z.u,k.mP,x.Fj,x.JJ,x.On,h.O5,h.OU],styles:[".p-inputtext.ng-valid[_ngcontent-%COMP%]{border-left:none;border:1px solid #ced4da}  .p-treeselect .p-treeselect-label span{color:#000}  .p-treeselect-items-wrapper::-webkit-scrollbar{width:12px}  .p-treeselect-items-wrapper::-webkit-scrollbar-thumb{border-radius:.5rem;background:var(--uwb-menu-scrollbar-thumb)}  .p-treeselect-items-wrapper::-webkit-scrollbar-thumb:hover{background:var(--uwb-menu-scrollbar-thumb-hover)}  .p-treeselect-items-wrapper::-webkit-scrollbar-track{background:var(--uwb-menu-scrollbar-track);background-color:transparent}"]}),p})()},521:(J,B,i)=>{i.r(B),i.d(B,{AreasModule:()=>fe});var n=i(6106),x=i(6208),k=i(2125),m=i(6223),e=i(9291),Z=i(8193),h=i(9935),A=i(5470),U=i(7966),T=i(3999),g=i(5969),M=i(7477),l=i(2435),w=i(7571),y=i(641),p=i(6861),f=i(6814);function r(a,u){1&a&&e._UZ(0,"uwb-input-warn",10),2&a&&e.Q6J("minLength",2)("maxLength",50)}let c=(()=>{class a{constructor(t,o,s,d,S,v,C){this.formBuilder=t,this.ref=o,this.config=s,this.areasService=d,this.areaTypesServices=S,this.toastService=v,this.translateService=C,this.dropdownItems=[],this.edit=!1}ngOnInit(){this.loadPageData(),this.loadFormGroup(),this.loadAreaTypes()}loadPageData(){this.edit=this.config.data.edit,this.selectedBackground=this.config.data.selectedBackground,this.selectedArea=this.config.data.selectedArea}loadFormGroup(){this.formGroup=this.formBuilder.group({name:[{value:null,disabled:!1},[m.kI.required,m.kI.minLength(2),m.kI.maxLength(50)]],areaTypeId:[{value:null,disabled:!1},[m.kI.required]],color:[{value:null,disabled:!1},[m.kI.required]],backgroundId:[{value:null,disabled:!1},[m.kI.required]]}),this.formGroup.patchValue(this.edit?{name:this.selectedArea?.name,areaTypeId:this.selectedArea?.areaType?.id,color:this.selectedArea?.color,backgroundId:this.selectedArea?.backgroundId}:{backgroundId:this.selectedBackground?.id})}loadAreaTypes(){this.areaTypesServices.findAllByOrganizationUnit(this.selectedBackground?.organizationUnitId).subscribe(t=>{this.dropdownItems=t.body??[]})}onAreaTypeChange(t){const o=this.dropdownItems.find(s=>s.id===t);this.formGroup?.get("color")?.setValue(o?.color)}onSave(){const t=this.formGroup?.getRawValue();this.edit?(t.id=this.selectedArea?.id,this.areasService.update(t).subscribe({next:()=>{this.toastService.showSuccessToast({summary:this.translateService.instant("global.toast.header.success"),detail:this.translateService.instant("area.dialog.editSuccess")}),this.onCloseDialog(!0)},error:()=>{this.toastService.showErrorToast({summary:this.translateService.instant("global.toast.header.error"),detail:this.translateService.instant("area.dialog.editError")})}})):this.areasService.create(t).subscribe({next:()=>{this.toastService.showSuccessToast({summary:this.translateService.instant("global.toast.header.success"),detail:this.translateService.instant("area.dialog.addSuccess")}),this.onCloseDialog(!0)},error:()=>{this.toastService.showErrorToast({summary:this.translateService.instant("global.toast.header.error"),detail:this.translateService.instant("area.dialog.addError")})}})}onCloseDialog(t){this.ref.close(t)}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(m.qu),e.Y36(Z.E7),e.Y36(Z.S),e.Y36(h.E),e.Y36(A.v),e.Y36(U.k),e.Y36(T.sK))},a.\u0275cmp=e.Xpm({type:a,selectors:[["uwb-areas-dialog"]],decls:18,vars:17,consts:[[3,"formGroup","ngSubmit","cancel"],["form-body",""],[3,"styleClass"],[1,"p-float-label"],["pInputText","","id","name","formControlName","name","minlength","2","maxlength","50"],["htmlFor","name"],[3,"minLength","maxLength",4,"ngIf"],["formControlName","areaTypeId",3,"items","optionLabel","itemValue","label","modelChange"],["pInputText","","id","color","type","color","formControlName","color"],["htmlFor","color"],[3,"minLength","maxLength"]],template:function(t,o){if(1&t&&(e.TgZ(0,"uwb-form",0),e.NdJ("ngSubmit",function(){return o.onSave()})("cancel",function(){return o.onCloseDialog()}),e.TgZ(1,"uwb-form-grid",1)(2,"uwb-form-control",2)(3,"span",3),e._UZ(4,"input",4),e.TgZ(5,"label",5),e._uU(6),e.ALo(7,"translate"),e.qZA()(),e.YNc(8,r,1,2,"uwb-input-warn",6),e.qZA(),e.TgZ(9,"uwb-form-control",2)(10,"uwb-single-select",7),e.NdJ("modelChange",function(d){return o.onAreaTypeChange(d)}),e.ALo(11,"translate"),e.qZA()(),e.TgZ(12,"uwb-form-control",2)(13,"span",3),e._UZ(14,"input",8),e.TgZ(15,"label",9),e._uU(16),e.ALo(17,"translate"),e.qZA()()()()()),2&t){let s;e.Q6J("formGroup",o.formGroup),e.xp6(2),e.Q6J("styleClass","col-12"),e.xp6(4),e.Oqu(e.lcZ(7,11,"area.name")),e.xp6(2),e.Q6J("ngIf",(null==o.formGroup||null==(s=o.formGroup.get("name"))?null:s.touched)&&(null==o.formGroup||null==(s=o.formGroup.get("name"))?null:s.invalid)),e.xp6(1),e.Q6J("styleClass","col-12"),e.xp6(1),e.s9C("label",e.lcZ(11,13,"area.areaType")),e.Q6J("items",o.dropdownItems)("optionLabel","name")("itemValue","id"),e.xp6(2),e.Q6J("styleClass","col-12"),e.xp6(4),e.Oqu(e.lcZ(17,15,"area.color"))}},dependencies:[g.o,M.U,l.A,w.c,y.g,p.z,m.Fj,m.JJ,m.JL,m.wO,m.nD,f.O5,m.sg,m.u,T.X$],encapsulation:2}),a})();var b=i(6641),_=i(5083),E=i(8892),D=i(8458),V=i(5630),K=i(1407),H=i(1321),F=i(9185),R=i(9972),N=i(737),z=i(4089),W=i(7378),j=i(9496),$=i(4112),I=i(6093),Y=i(8983),P=i(1059),O=i(8648),Q=i(902),G=i(3710),X=i(6990),q=i(9061);function ee(a,u){if(1&a&&(e.TgZ(0,"div"),e._UZ(1,"div",5),e.qZA()),2&a){const t=e.oxw();e.Tol(t.styleClass)}}function te(a,u){if(1&a){const t=e.EpF();e.TgZ(0,"p-button",11),e.NdJ("onClick",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onDrawClick())}),e.ALo(1,"translate"),e.qZA()}if(2&a){const t=e.oxw(3);e.Q6J("disabled",t.disabledMapButtons)("icon",t.mobileScreen?"pi pi-palette":"")("styleClass",t.mobileScreen?"ui-button_size_100":"ui-button_size_125")("label",t.mobileScreen?"":e.lcZ(1,4,"global.buttons.draw"))}}function ne(a,u){if(1&a){const t=e.EpF();e.TgZ(0,"p-button",11),e.NdJ("onClick",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onModifyClick())}),e.ALo(1,"translate"),e.qZA()}if(2&a){const t=e.oxw(3);e.Q6J("disabled",t.disabledMapButtons)("icon",t.mobileScreen?"pi pi-pencil":"")("styleClass",t.mobileScreen?"ui-button_size_100":"ui-button_size_125")("label",t.mobileScreen?"":e.lcZ(1,4,"global.buttons.edit"))}}function oe(a,u){if(1&a){const t=e.EpF();e.TgZ(0,"div"),e.YNc(1,te,2,6,"p-button",10),e.YNc(2,ne,2,6,"p-button",10),e.TgZ(3,"p-button",11),e.NdJ("onClick",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.deleteVertex())}),e.ALo(4,"translate"),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",0===t.vertexes.length),e.xp6(1),e.Q6J("ngIf",t.vertexes.length>0),e.xp6(1),e.Q6J("disabled",t.disabledMapButtons)("icon",t.mobileScreen?"pi pi-trash":"")("styleClass",t.mobileScreen?"ui-button_size_100":"ui-button_size_125")("label",t.mobileScreen?"":e.lcZ(4,6,"global.buttons.clear"))}}function ae(a,u){if(1&a){const t=e.EpF();e.TgZ(0,"p-button",12),e.NdJ("onClick",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.saveVertex())}),e.ALo(1,"translate"),e.qZA(),e.TgZ(2,"p-button",13),e.NdJ("onClick",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.loadVertexes())}),e.ALo(3,"translate"),e.qZA()}if(2&a){const t=e.oxw(2);e.s9C("label",e.lcZ(1,3,"global.buttons.save")),e.Q6J("disabled",t.disabledMapButtons),e.xp6(2),e.s9C("label",e.lcZ(3,5,"global.buttons.cancel"))}}function se(a,u){if(1&a&&(e.TgZ(0,"div",6),e._UZ(1,"div",5),e.TgZ(2,"div",7),e.YNc(3,oe,5,8,"div",8),e.YNc(4,ae,4,7,"ng-template",null,9,e.W1O),e.qZA()()),2&a){const t=e.MAs(5),o=e.oxw();e.xp6(3),e.Q6J("ngIf",!1===o.modified&&!1===o.drawable)("ngIfElse",t)}}function ie(a,u){if(1&a){const t=e.EpF();e.TgZ(0,"uwb-map-panel",15),e.NdJ("emitPreviousClick",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.goToPreviousPoint())})("emitNextClick",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.goToNextPoint())})("emitPlayClick",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.goToNextPointAutomatic())})("emitPauseClick",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.stopGoToNextPointAutomatic())})("emitTimeToChangePoint",function(s){e.CHM(t);const d=e.oxw(2);return e.KtG(d.onTimeToChangePointChenge(s))}),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("disabledButtons",t.disabledMapPanelButtons)}}function le(a,u){if(1&a&&(e.TgZ(0,"div")(1,"div",5),e.YNc(2,ie,1,1,"uwb-map-panel",14),e.qZA()()),2&a){const t=e.oxw();e.Tol(t.styleClass),e.xp6(2),e.Q6J("ngIf",t.background&&""!==t.background)}}function re(a,u){if(1&a){const t=e.EpF();e.TgZ(0,"div",7)(1,"p-button",20),e.NdJ("onClick",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.emitEditSelectedPoint.emit(s.selectedMapPoint))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"p-button",21),e.NdJ("onClick",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.emitDeleteSelectedPoint.emit(s.selectedMapPoint))}),e.ALo(4,"translate"),e.qZA()()}2&a&&(e.xp6(1),e.s9C("pTooltip",e.lcZ(2,2,"global.buttons.edit")),e.xp6(2),e.s9C("pTooltip",e.lcZ(4,4,"global.buttons.delete")))}function ce(a,u){if(1&a&&(e.TgZ(0,"div",17)(1,"span",18),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span",18),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"span",18),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"span",18),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.YNc(13,re,5,6,"div",19),e.qZA()),2&a){const t=e.oxw(2);e.xp6(2),e.AsE(" ",e.lcZ(3,9,"anchor.name"),": ",t.selectedMapPoint.name," "),e.xp6(3),e.AsE(" ",e.lcZ(6,11,"anchor.x"),": ",t.selectedMapPoint.x," "),e.xp6(3),e.AsE(" ",e.lcZ(9,13,"anchor.y"),": ",t.selectedMapPoint.y," "),e.xp6(3),e.AsE(" ",e.lcZ(12,15,"anchor.z"),": ",t.selectedMapPoint.z," "),e.xp6(2),e.Q6J("ngIf",t.showAnchorOverlayButtons)}}function de(a,u){if(1&a&&(e.ynx(0),e.YNc(1,ce,14,17,"div",16),e.BQk()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.selectedMapPoint&&t.showOverlay)}}function pe(a,u){if(1&a&&(e.TgZ(0,"div",17)(1,"span",18),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span",18),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"span",18),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"span",18),e._uU(11),e.ALo(12,"translate"),e.ALo(13,"date"),e.qZA()()),2&a){const t=e.oxw(2);e.xp6(2),e.AsE(" ",e.lcZ(3,8,"localization.tag.name"),": ",t.selectedMapPoint.name," "),e.xp6(3),e.AsE(" ",e.lcZ(6,10,"localization.tag.x"),": ",t.selectedMapPoint.x," "),e.xp6(3),e.AsE(" ",e.lcZ(9,12,"localization.tag.y"),": ",t.selectedMapPoint.y," "),e.xp6(3),e.AsE(" ",e.lcZ(12,14,"localization.tag.date"),": ",e.xi3(13,16,t.selectedMapPoint.date,"yyyy-M-dd, HH:mm:ss")," ")}}function ue(a,u){if(1&a&&(e.ynx(0),e.YNc(1,pe,14,19,"div",16),e.BQk()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.selectedMapPoint)}}let me=(()=>{class a extends $.G{constructor(t,o,s,d,S,v,C){super(t,o),this.cd=t,this.renderer=o,this.confirmDialogService=s,this.areaVertexesService=d,this.toastService=S,this.translateService=v,this.sizeScreenService=C,this.selectedaAreas=[],this.emitChangeVertexes=new e.vpe}ngOnInit(){this.sizeScreenService.smallScreen$.subscribe(t=>{this.smallScreen=t}),this.sizeScreenService.mobileScreen$.subscribe(t=>{this.mobileScreen=t})}ngOnChanges(t){t.background&&""!==this.background&&this.loadMap(),t.area&&(this.vertexBackgroundColor=this.area?.color,this.vertexColor=this.area?.color,this.loadLayer()),t.vertexes&&this.loadVertexes()}loadVertexes(){if(this.clearVertex(),this.vertexes.length>0)if(this.selectedaAreas.length>0)this.selectedaAreas.forEach(t=>{const o=new I.ZP({text:new Y.Z({text:t?.name,font:"25px Arial",fill:new P.Z({color:t?.color}),stroke:new O.Z({color:"black",width:3})})}),s=[];this.vertexes.filter(C=>C.areaId===t.id).forEach(C=>{const L=JSON.parse("["+C.x+","+C.y+"]");s.push(L)});const S=new Q.Z(new G.ZP([s]));S.setId("area_"+t?.id);const v=new I.ZP({fill:new P.Z({color:t?.color+this.vertexAlfa}),stroke:new O.Z({color:t?.color,width:3})});S.setStyle([v,o]),this.source.addFeature(S)}),this.source.changed();else{const t=this.area,o=new I.ZP({text:new Y.Z({text:t?.name,font:"30px Arial",fill:new P.Z({color:t?.color}),stroke:new O.Z({color:"black",width:2})})}),s=[];this.vertexes.forEach(v=>{const C=JSON.parse("["+v.x+","+v.y+"]");s.push(C)});const d=new Q.Z(new G.ZP([s]));d.setId("area_"+t?.id);const S=new I.ZP({fill:new P.Z({color:t?.color+this.vertexAlfa}),stroke:new O.Z({color:t?.color,width:3})});d.setStyle([S,o]),this.source.addFeature(d),this.source.changed()}}onModifyClick(){this.modified=!this.modified,this.modified?this.loadModifyOption():this.clearModifyInteractions()}getVertexesFromFeature(){const t=this.source.getFeatures()[0],o=this.area;if(null!=t){const s=t.getProperties().geometry.getFlatCoordinates();return t.getProperties(),(0,X.chunk)(s,2).map((v,C)=>({lp:C,x:v[0],y:v[1],areaId:o?.id}))}return[]}saveVertex(){if(this.modified){const t=this.getVertexesFromFeature();t.forEach(o=>{const s=this.vertexes.find(d=>d.lp===o.lp);o.id=s?.id??void 0}),this.areaVertexesService.updateList(t).subscribe({next:()=>{this.toastService.showSuccessToast({summary:this.translateService.instant("global.toast.header.success"),detail:this.translateService.instant("areaVertex.dialog.editSuccess")}),this.emitChangeVertexes.emit(!0)},error:()=>{this.toastService.showErrorToast({summary:this.translateService.instant("global.toast.header.error"),detail:this.translateService.instant("areaVertex.dialog.editError")})}})}else{const t=this.getVertexesFromFeature();this.areaVertexesService.createList(t).subscribe({next:()=>{this.toastService.showSuccessToast({summary:this.translateService.instant("global.toast.header.success"),detail:this.translateService.instant("areaVertex.dialog.addSuccess")}),this.emitChangeVertexes.emit(!0)},error:()=>{this.toastService.showErrorToast({summary:this.translateService.instant("global.toast.header.error"),detail:this.translateService.instant("areaVertex.dialog.addError")})}})}}deleteVertex(){if(this.vertexes.length>0){const t=this.vertexes.map(o=>o.id);this.confirmDialogService.openDeleteDialog({message:this.translateService.instant("areaVertex.dialog.deleteMessage")},o=>{o&&this.handleDeleteDialog(t)})}else this.clearVertex()}handleDeleteDialog(t){this.areaVertexesService.deleteList(t).subscribe({next:()=>{this.toastService.showSuccessToast({summary:this.translateService.instant("global.toast.header.success"),detail:this.translateService.instant("areaVertex.dialog.deleteSuccess")}),this.emitChangeVertexes.emit(!0)},error:o=>{this.toastService.showErrorToast({summary:this.translateService.instant("global.toast.header.error"),detail:this.translateService.instant("areaVertex.dialog.deleteError")})}})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(e.sBO),e.Y36(e.Qsj),e.Y36(V.D),e.Y36(D.F),e.Y36(U.k),e.Y36(T.sK),e.Y36(F.p))},a.\u0275cmp=e.Xpm({type:a,selectors:[["uwb-map-areas"]],inputs:{selectedaAreas:"selectedaAreas"},outputs:{emitChangeVertexes:"emitChangeVertexes"},features:[e.qOj,e.TTD],decls:8,vars:7,consts:[[3,"ngSwitch"],[3,"class",4,"ngSwitchCase"],["class","single_map_with_footer",4,"ngSwitchCase"],["id","popup",1,"overlay"],[4,"ngSwitchCase"],["id","map",1,"map"],[1,"single_map_with_footer"],[1,"buttons_container_center"],[4,"ngIf","ngIfElse"],["saveTemplate",""],["class","px-2",3,"disabled","icon","styleClass","label","onClick",4,"ngIf"],[1,"px-2",3,"disabled","icon","styleClass","label","onClick"],["styleClass","ui-button_size_125",1,"px-2",3,"disabled","label","onClick"],["styleClass","ui-button_size_125","type","button","data-dismiss","modal",3,"label","onClick"],[3,"disabledButtons","emitPreviousClick","emitNextClick","emitPlayClick","emitPauseClick","emitTimeToChangePoint",4,"ngIf"],[3,"disabledButtons","emitPreviousClick","emitNextClick","emitPlayClick","emitPauseClick","emitTimeToChangePoint"],["class","flex flex-column",4,"ngIf"],[1,"flex","flex-column"],[1,"p-1"],["class","buttons_container_center",4,"ngIf"],["styleClass","ui-button_size_125","icon","pi pi-pencil",1,"p-2",3,"pTooltip","onClick"],["styleClass","ui-button_size_125","icon","pi pi-times",1,"p-2",3,"pTooltip","onClick"]],template:function(t,o){1&t&&(e.ynx(0,0),e.YNc(1,ee,2,2,"div",1),e.YNc(2,se,6,2,"div",2),e.YNc(3,le,3,3,"div",1),e.BQk(),e.TgZ(4,"div",3),e.ynx(5,0),e.YNc(6,de,2,1,"ng-container",4),e.YNc(7,ue,2,1,"ng-container",4),e.BQk(),e.qZA()),2&t&&(e.Q6J("ngSwitch",o.mapDisplayType),e.xp6(1),e.Q6J("ngSwitchCase","normal"),e.xp6(1),e.Q6J("ngSwitchCase","mapWithButtons"),e.xp6(1),e.Q6J("ngSwitchCase","mapWithBodyInside"),e.xp6(2),e.Q6J("ngSwitch",o.overlayType),e.xp6(1),e.Q6J("ngSwitchCase","anchor"),e.xp6(1),e.Q6J("ngSwitchCase","tag"))},dependencies:[N.u,z.zx,f.O5,f.RF,f.n9,q.Z,f.uU,T.X$],styles:[".map[_ngcontent-%COMP%]{width:100%;height:100%;border:2px solid var(--uwb-primary);border-radius:15px}  .ol-control{display:flex}  .ol-control button{background-color:var(--uwb-button-background);color:var(--uwb-button-text-color);height:30px;width:30px;border-radius:15px}.overlay[_ngcontent-%COMP%]{background:var(--uwb-background);color:var(--uwb-internal-tab-font-color);border:0 none;border-radius:var(--border-radius);box-shadow:0 1px 3px #0000004d;padding:10px;position:absolute}.overlay[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700;text-wrap:nowrap}  .ol-zoom{right:.5rem;left:auto}"]}),a})();var he=i(7397);function _e(a,u){if(1&a&&(e.TgZ(0,"div",15),e._UZ(1,"img",16),e._uU(2),e.qZA()),2&a){const t=u.item;e.s9C("pTooltip",t.name),e.xp6(1),e.Q6J("src",t.path,e.LSH),e.xp6(1),e.hij(" ",t.name," ")}}const ge=function(){return[]},be=[{path:"areas",component:(()=>{class a{constructor(t,o,s,d,S,v,C,L,Ce,ve,Se,xe){this.authorityService=t,this.columnService=o,this.areasService=s,this.backgroundsService=d,this.areaVertexesService=S,this.dialogService=v,this.translateService=C,this.confirmDialogService=L,this.arrayBufferService=Ce,this.clientsService=ve,this.toastService=Se,this.sizeScreenService=xe,this.treeSelectItems=[],this.backgrounds=[],this.columns=[],this.areas=[],this.handleAreas=[],this.areaVertexes=[],this.dropdownFilterAreaTypeItems=[],this.selectedAreas=[],this.loading=!1}ngOnInit(){this.userOrganizationUnitId=this.authorityService.getUserOrganizationUnitId(),this.columns=this.columnService.getAreaColumns(),this.loadOrganizationUnits(),this.loadBackgrounds()}loadOrganizationUnits(){this.clientsService.findTree().subscribe(t=>{this.treeSelectItems=t.body??[],this.treeSelectItemSelected=this.clientsService.findByIdFromUnits(this.treeSelectItems[0],this.userOrganizationUnitId),this.selectedOrganizationUnit=this.treeSelectItemSelected.data})}loadBackgrounds(){this.backgroundsService.findAllByUserOrganizationUnit(this.selectedOrganizationUnit?.id??this.userOrganizationUnitId).subscribe(t=>{this.backgrounds=t.body??[],this.backgrounds.forEach(o=>o.fullPath=this.arrayBufferService.convertImage(o.pathArrayBuffer))})}loadAreas(t){this.loading=!0,this.areasService.findAllByBackground(t).subscribe(o=>{this.areas=o.body??[],this.handleAreas=this.areas,this.loadAreaTypes(),this.loading=!1})}loadAreaTypes(){const t=this.areas.filter(s=>void 0!==s.areaType),o=[];t.forEach(s=>{o.some(d=>d.id===s.areaType?.id)||o.push(s.areaType)}),this.dropdownFilterAreaTypeItems=o}loadAreaVertexes(t){this.areaVertexesService.findAllByArea(t).subscribe(o=>{this.areaVertexes=o.body??[]})}onOrganizationUnitSelect(t){this.selectedOrganizationUnit?.id!==t.id&&(this.selectedOrganizationUnit=t,this.treeSelectItemSelected=this.clientsService.findByIdFromUnits(this.treeSelectItems[0],this.selectedOrganizationUnit.id),this.selectedBackground=void 0,this.areas=[],this.areaVertexes=[],this.loadBackgrounds())}onBackgroundSelect(t){this.selectedBackground=t??void 0,this.selectedArea=void 0,this.areaVertexes=[],this.loadAreas(this.selectedBackground?.id)}onAreaSelect(t){this.selectedArea=t??void 0,this.selectedArea&&this.loadAreaVertexes(this.selectedArea?.id)}onAreaTypeFilterSelected(t){this.areas=t?this.handleAreas.filter(o=>o.areaType?.id===t):this.handleAreas}onShowAllAreasClick(){this.selectedAreas=this.areas,this.areaVertexesService.findAllByBackground(this.selectedBackground?.id).subscribe(t=>{this.areaVertexes=t.body??[]})}onSaveVertexes(t){t&&this.loadAreaVertexes(this.selectedArea?.id)}openDialog(t=!1){this.dialogService.open(c,{header:this.translateService.instant(t?"global.dialog.editHeader":"global.dialog.addHeader"),data:{edit:t,selectedBackground:this.selectedBackground,selectedArea:this.selectedArea},width:this.sizeScreenService.smallScreen?"100%":"40%"}).onClose.subscribe(s=>this.handleDialogResponse(s))}openDeleteDialog(){this.confirmDialogService.openDeleteDialog({},t=>{t&&this.handleDeleteDialog()})}handleDialogResponse(t){t&&(this.selectedArea=void 0,this.loadAreas(this.selectedBackground?.id))}handleDeleteDialog(){this.areasService.delete(this.selectedArea?.id).subscribe({next:()=>{this.toastService.showSuccessToast({summary:this.translateService.instant("global.toast.header.success"),detail:this.translateService.instant("areaType.dialog.deleteSuccess")}),this.handleDialogResponse(!0)},error:t=>{this.toastService.showErrorToast({summary:this.translateService.instant("global.toast.header.error"),detail:this.translateService.instant("areaType.dialog.deleteError")})}})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(b.g),e.Y36(_.w),e.Y36(h.E),e.Y36(E.s),e.Y36(D.F),e.Y36(Z.xA),e.Y36(T.sK),e.Y36(V.D),e.Y36(K.A),e.Y36(H.a),e.Y36(U.k),e.Y36(F.p))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-areas"]],decls:19,vars:37,consts:[[1,"area","grid"],[1,"col-5","area_table_with_navbar_and_buttons"],[1,"grid","px-2"],[1,"col-12","p-0",3,"treeSelectValue","options","optionLabel","floatLabel","placeholder","modelChange"],["optionLabel","name",1,"col-12","p-0",3,"items","label","itemTemplate","modelChange"],["pTemplate","item"],["itemTemplate",""],[1,"w-full",3,"columns","values","loading","showFilterOption","showHeaderSelect","selectionChange"],[1,"px-2",3,"disabled","label","onClick"],["filter","",1,"w-11rem","m-2"],[3,"items","optionLabel","itemValue","label","modelChange"],[1,"buttons_container_center"],[3,"disabledAddButton","disabledEditAndDeleteButton","normalScreenStyleButtons","emitAddClick","emitEditClick","emitDeleteClick"],[1,"col-7"],[1,"w-full",3,"background","area","selectedaAreas","vertexes","mapDisplayType","disabledMapButtons","emitChangeVertexes"],[1,"flex","align-items-center",3,"pTooltip"],[2,"height","30px",3,"src"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"uwb-tree-select",3),e.NdJ("modelChange",function(d){return o.onOrganizationUnitSelect(d)}),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"uwb-single-select",4),e.NdJ("modelChange",function(d){return o.onBackgroundSelect(d)}),e.ALo(6,"translate"),e.YNc(7,_e,3,3,"ng-template",5,6,e.W1O),e.qZA()(),e.TgZ(9,"uwb-table",7),e.NdJ("selectionChange",function(d){return o.onAreaSelect(d)}),e.TgZ(10,"p-button",8),e.NdJ("onClick",function(){return o.onShowAllAreasClick()}),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"div",9)(13,"uwb-single-select",10),e.NdJ("modelChange",function(d){return o.onAreaTypeFilterSelected(d)}),e.ALo(14,"translate"),e.qZA()()(),e.TgZ(15,"div",11)(16,"uwb-footer-buttons",12),e.NdJ("emitAddClick",function(){return o.openDialog()})("emitEditClick",function(){return o.openDialog(!0)})("emitDeleteClick",function(){return o.openDeleteDialog()}),e.qZA()()(),e.TgZ(17,"div",13)(18,"uwb-map-areas",14),e.NdJ("emitChangeVertexes",function(d){return o.onSaveVertexes(d)}),e.qZA()()()),2&t){const s=e.MAs(8);e.xp6(3),e.Q6J("treeSelectValue",o.treeSelectItemSelected)("options",o.treeSelectItems)("optionLabel","name")("floatLabel",!1)("placeholder",e.lcZ(4,28,"background.organizationUnit")),e.xp6(2),e.s9C("label",e.lcZ(6,30,"area.background")),e.Q6J("items",o.backgrounds)("itemTemplate",s),e.xp6(4),e.Q6J("columns",o.columns)("values",o.areas)("loading",o.loading)("showFilterOption",!0)("showHeaderSelect",!0),e.xp6(1),e.s9C("label",e.lcZ(11,32,"global.buttons.showAll")),e.Q6J("disabled",void 0===o.selectedBackground||void 0!==o.selectedArea||0===o.areas.length),e.xp6(3),e.s9C("label",e.lcZ(14,34,"area.areaType")),e.Q6J("items",o.dropdownFilterAreaTypeItems)("optionLabel","name")("itemValue","id"),e.xp6(3),e.Q6J("disabledAddButton",void 0===o.selectedBackground)("disabledEditAndDeleteButton",void 0===o.selectedArea)("normalScreenStyleButtons","ui-button_size_125"),e.xp6(2),e.Q6J("background",null==o.selectedBackground?null:o.selectedBackground.fullPath)("area",o.selectedArea)("selectedaAreas",void 0===o.selectedArea?o.selectedAreas:e.DdM(36,ge))("vertexes",o.areaVertexes)("mapDisplayType","mapWithButtons")("disabledMapButtons",void 0===o.selectedArea)}},dependencies:[R.jx,N.u,z.zx,W.L,y.g,j.EC,me,he.s,T.X$],styles:[".area .p-treeselect{width:100%}.area_table_with_navbar_and_buttons[_ngcontent-%COMP%]{display:grid;grid-template-rows:125px calc(100vh - 225px) 75px}"]}),a})()}];let fe=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[n.K,x.m,k.Bz.forChild(be)]}),a})()},5630:(J,B,i)=>{i.d(B,{D:()=>m});var n=i(9291),x=i(9972),k=i(3999);let m=(()=>{class e{constructor(h,A){this.confirmationService=h,this.translateService=A,this.confirmDialogOption={key:"mainDeleteConfirmDialog",header:this.translateService.instant("global.dialog.deleteHeader"),message:this.translateService.instant("global.dialog.deleteMessage"),icon:"pi pi-exclamation-triangle"}}openDeleteDialog(h={},A){this.confirmDialogOption={key:h.key??this.confirmDialogOption.key,header:h.header??this.confirmDialogOption.header,message:h.message??this.confirmDialogOption.message,icon:h.icon??this.confirmDialogOption.icon},this.confirmationService.confirm({key:h.key??this.confirmDialogOption.key,header:h.header??this.confirmDialogOption.header,message:h.message??this.confirmDialogOption.message,icon:h.icon??this.confirmDialogOption.icon,accept:()=>{A(!0)},reject:()=>{A(!1)}})}}return e.\u0275fac=function(h){return new(h||e)(n.LFG(x.YP),n.LFG(k.sK))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);