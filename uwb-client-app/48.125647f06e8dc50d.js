"use strict";(self.webpackChunkuwb_client_app=self.webpackChunkuwb_client_app||[]).push([[48],{6069:(pe,J,v)=>{v.d(J,{j:()=>he});var g=v(9931),B=v(9291);const oe=["op"],h=["*"];let he=(()=>{class W extends g.T{toogleOverlay(X){this.overlay?.toggle(X)}}return W.\u0275fac=function(){let k;return function(K){return(k||(k=B.n5z(W)))(K||W)}}(),W.\u0275cmp=B.Xpm({type:W,selectors:[["uwb-overlay"]],viewQuery:function(X,K){if(1&X&&B.Gf(oe,5),2&X){let se;B.iGM(se=B.CRH())&&(K.overlay=se.first)}},features:[B.qOj],ngContentSelectors:h,decls:3,vars:3,consts:[["appendTo","body",3,"showCloseIcon"],["op",""]],template:function(X,K){1&X&&(B.F$t(),B.TgZ(0,"p-overlayPanel",0,1),B.Hsn(2),B.qZA()),2&X&&(B.Akn(K.style),B.Q6J("showCloseIcon",!0))},dependencies:[g.T],encapsulation:2}),W})()},7397:(pe,J,v)=>{v.d(J,{s:()=>_e});var g=v(9291),B=v(6223),oe=v(3562),h=v(2420),he=v(9972),W=v(737),k=v(6814);function X(U,V){if(1&U){const m=g.EpF();g.TgZ(0,"div",5)(1,"div",6)(2,"input",7),g.NdJ("ngModelChange",function(N){g.CHM(m);const Z=g.oxw();return g.KtG(Z.filterText=N)})("input",function(N){g.CHM(m);const Z=g.oxw();return g.KtG(Z.customFilter(N))}),g.qZA(),g._UZ(3,"i",8),g.qZA()()}if(2&U){const m=g.oxw();g.xp6(2),g.Q6J("ngModel",m.filterText)}}function K(U,V){if(1&U&&(g.TgZ(0,"span"),g._uU(1),g.qZA()),2&U){const m=g.oxw().$implicit,A=g.oxw();g.xp6(1),g.hij(" ",null==m?null:m.data[A.optionLabel]," ")}}function se(U,V){if(1&U&&(g.TgZ(0,"span"),g._uU(1),g.qZA()),2&U){const m=g.oxw(2);g.xp6(1),g.hij(" ",m.placeholder," ")}}function xe(U,V){if(1&U&&(g.YNc(0,K,2,1,"span",9),g.YNc(1,se,2,1,"span",9)),2&U){const m=V.$implicit,A=g.oxw();g.Q6J("ngIf",null==m?null:m.data),g.xp6(1),g.Q6J("ngIf",!(null!=m&&m.data||A.floatLabel))}}function me(U,V){if(1&U&&(g.TgZ(0,"span",10),g._uU(1),g.ALo(2,"slice"),g.qZA()),2&U){const m=V.$implicit,A=g.oxw();g.s9C("pTooltip",m.data[A.optionLabel]),g.xp6(1),g.hij(" ",m.data[A.optionLabel].length>30?g.Dn7(2,2,m.data[A.optionLabel],0,30)+"...":m.data[A.optionLabel]," ")}}function ve(U,V){if(1&U&&(g.TgZ(0,"label",11),g._uU(1),g.qZA()),2&U){const m=g.oxw();g.xp6(1),g.Oqu(m.label)}}const ae=function(){return{width:"100%"}};let _e=(()=>{class U{constructor(){this.options=[],this.filter=!0,this.label="Wybierz opcje",this.optionLabel="name",this.styleClass="",this.selectionMode="single",this.floatLabel=!0,this.placeholder="",this.modelChange=new g.vpe,this.itemChange=new g.vpe,this.onModelChange=()=>h.Z,this.onModelTouched=()=>h.Z,this.handleOptions=[],this.filterText=""}ngOnChanges(m){m.options&&(this.handleOptions=this.options)}ngAfterViewInit(){this.treeSelect.registerOnChange(this.onModelChange),this.treeSelect.registerOnTouched(this.onModelTouched)}customFilter(m){const A=this.filterText.toLowerCase();""===A?this.options=this.handleOptions:(this.options=this.handleOptions,this.options=this.filterTree(this.options,A))}filterTree(m,A){const N=[];for(const Z of m)if(Z?.data&&Z.data.name.toLowerCase().includes(A)&&!N.find(H=>H.data.id===Z.data.id)&&N.push(Z),Z.children&&Z.children.length>0){const H=this.filterTree(Z.children,A);if(H.length>0&&!N.find(te=>te.data.id===Z.data.id)){const te={...Z};te.children=H,N.push(te)}}return N}writeValue(m){this.treeSelectValue=m}registerOnChange(m){this.onModelChange=m}registerOnTouched(m){this.onModelTouched=m}emitModelAndItemChange(m){this.modelChange.emit(m.node.data),this.emitItemChange({value:m.node.data})}emitItemChange(m){const A=m.value?this.options.find(N=>N?.[this.itemValue]===m.value):void 0;this.itemChange.emit(Object.assign({},m,{item:A??null}))}}return U.\u0275fac=function(m){return new(m||U)},U.\u0275cmp=g.Xpm({type:U,selectors:[["uwb-tree-select"]],viewQuery:function(m,A){if(1&m&&g.Gf(oe.mP,7),2&m){let N;g.iGM(N=g.CRH())&&(A.treeSelect=N.first)}},inputs:{options:"options",filter:"filter",label:"label",optionLabel:"optionLabel",treeSelectValue:"treeSelectValue",itemValue:"itemValue",styleClass:"styleClass",selectionMode:"selectionMode",floatLabel:"floatLabel",placeholder:"placeholder"},outputs:{modelChange:"modelChange",itemChange:"itemChange"},features:[g._Bn([{provide:B.JU,useExisting:(0,g.Gpc)(()=>U),multi:!0}]),g.TTD],decls:6,vars:12,consts:[["placeholder","","appendTo","body",3,"ngModel","options","placeholder","selectionMode","ngModelChange","onNodeSelect"],["pTemplate","header"],["pTemplate","value"],["pTemplate","default"],["for","label",4,"ngIf"],[1,"p-treeselect-header"],[1,"p-treeselect-filter-container","p-input-icon-right","custom-filter"],["type","text","autofocus","","placeholder","Filter",1,"p-treeselect-filter","p-inputtext","p-component",3,"ngModel","ngModelChange","input"],[1,"pi","pi-search"],[4,"ngIf"],[3,"pTooltip"],["for","label"]],template:function(m,A){1&m&&(g.TgZ(0,"span")(1,"p-treeSelect",0),g.NdJ("ngModelChange",function(Z){return A.treeSelectValue=Z})("onNodeSelect",function(Z){return A.emitModelAndItemChange(Z)}),g.YNc(2,X,4,1,"ng-template",1),g.YNc(3,xe,2,2,"ng-template",2),g.YNc(4,me,3,6,"ng-template",3),g.qZA(),g.YNc(5,ve,2,1,"label",4),g.qZA()),2&m&&(g.Tol(A.floatLabel?"p-float-label":""),g.xp6(1),g.Akn(g.DdM(11,ae)),g.Tol(A.styleClass),g.Q6J("ngModel",A.treeSelectValue)("options",A.options)("placeholder",A.placeholder)("selectionMode",A.selectionMode),g.xp6(4),g.Q6J("ngIf",A.floatLabel))},dependencies:[he.jx,W.u,oe.mP,B.Fj,B.JJ,B.On,k.O5,k.OU],styles:[".p-inputtext.ng-valid[_ngcontent-%COMP%]{border-left:none;border:1px solid #ced4da}  .p-treeselect .p-treeselect-label span{color:#000}  .p-treeselect-items-wrapper::-webkit-scrollbar{width:12px}  .p-treeselect-items-wrapper::-webkit-scrollbar-thumb{border-radius:.5rem;background:var(--uwb-menu-scrollbar-thumb)}  .p-treeselect-items-wrapper::-webkit-scrollbar-thumb:hover{background:var(--uwb-menu-scrollbar-thumb-hover)}  .p-treeselect-items-wrapper::-webkit-scrollbar-track{background:var(--uwb-menu-scrollbar-track);background-color:transparent}"]}),U})()},4048:(pe,J,v)=>{v.r(J),v.d(J,{OccurenceMapModule:()=>Mt});var g=v(6106),B=v(6208),oe=v(2125),h=v(9291),he=v(8892),W=v(2894),k=v(5374),X=v(6641),K=v(1407),se=v(1321),xe=v(9185),me=v(9972),ve=v(737),ae=v(4089),_e=v(1382),U=v(641),V=v(6062),m=v(1415),A=v(7055),N=v(3870),Z=v(5435),H=v(4654),te=v(1470),q=v(451),Ae=v(5329),Se=v(9365);const ue=34962,r=35048,u=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function f(d,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!Se.ME},t);const e=u.length;for(let n=0;n<e;++n)try{const o=d.getContext(u[n],t);if(o)return o}catch{}return null}var T=v(2780);function w(d){switch(d){case ue:return Float32Array;case 34963:return Uint32Array;default:return Float32Array}}const z=class M{constructor(t,e){this.array=null,this.type=t,(0,T.h)(t===ue||34963===t,62),this.usage=void 0!==e?e:35044}ofSize(t){return this.array=new(w(this.type))(t),this}fromArray(t){return this.array=w(this.type).from(t),this}fromArrayBuffer(t){return this.array=new(w(this.type))(t),this}getType(){return this.type}getArray(){return this.array}getUsage(){return this.usage}getSize(){return this.array?this.array.length:0}};var I=v(4974),fe=v(5226),re=v(6008),ie=v(4074);var L=v(9511),C=v(9070);const Ze=class Je{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer();const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),e.compileShader(n);const o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,t.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n  uniform float u_opacity;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n"),e.compileShader(o),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,o),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(p=>{this.uniforms_.push({value:t.uniforms[p],location:e.getUniformLocation(this.renderTargetProgram_,p)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const o=0,s=e.RGBA,p=0,_=e.RGBA,b=e.UNSIGNED_BYTE,E=null;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,o,s,n[0],n[1],p,_,b,E),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0)}}apply(t,e,n,o){const s=this.getGL(),p=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,e?e.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!e){const b=(0,C.sq)(s.canvas);if(!t.renderTargets[b]){const E=s.getContextAttributes();E&&E.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT)),t.renderTargets[b]=!0}}s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,p[0],p[1]),s.uniform1i(this.renderTargetTextureLocation_,0),s.uniform1f(this.renderTargetOpacityLocation_,t.layerStatesArray[t.layerIndex].opacity),this.applyUniforms(t),n&&n(s,t),s.drawArrays(s.TRIANGLES,0,6),o&&o(s,t)}getFrameBuffer(){return this.frameBuffer_}applyUniforms(t){const e=this.getGL();let n,o=1;this.uniforms_.forEach(function(s){if(n="function"==typeof s.value?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${o}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(s.location,o++);else if(Array.isArray(n))switch(n.length){case 2:return void e.uniform2f(s.location,n[0],n[1]);case 3:return void e.uniform3f(s.location,n[0],n[1],n[2]);case 4:return void e.uniform4f(s.location,n[0],n[1],n[2],n[3]);default:return}else"number"==typeof n&&e.uniform1f(s.location,n)})}};var Ke=v(925),G=v(9664);function Ie(d,t){return d[0]=t[0],d[1]=t[1],d[4]=t[2],d[5]=t[3],d[12]=t[4],d[13]=t[5],d}const Q={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},we={};function Ne(d){return"shared/"+d}let ze=0;function Ge(d){switch(d){case Q.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Q.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Q.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;default:return Float32Array.BYTES_PER_ELEMENT}}const rt=class tt extends L.Z{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?Ne(t.canvasCacheKey):function $e(){const d="unique/"+ze;return ze+=1,d}(),this.canvas_=function qe(d){let t=we[d];if(!t){const e=document.createElement("canvas");e.style.position="absolute",e.style.left="0",t={users:0,canvas:e},we[d]=t}return t.users+=1,t.canvas}(this.canvasCacheKey_),this.gl_=f(this.canvas_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.canvas_.addEventListener("webglcontextlost",this.boundHandleWebGLContextLost_),this.canvas_.addEventListener("webglcontextrestored",this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=(0,G.Ue)(),this.offsetScaleMatrix_=(0,G.Ue)(),this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(e=>new Ze({webGlContext:this.gl_,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms})):[new Ze({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[];for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===Ne(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,n=(0,C.sq)(t);let o=this.bufferCache_[n];o||(o={buffer:t,webGlBuffer:e.createBuffer()},this.bufferCache_[n]=o),e.bindBuffer(t.getType(),o.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,n=(0,C.sq)(t),o=this.bufferCache_[n];o&&!e.isContextLost()&&e.deleteBuffer(o.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){this.canvas_.removeEventListener("webglcontextlost",this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener("webglcontextrestored",this.boundHandleWebGLContextRestored_),function et(d){const t=we[d];if(!t||(t.users-=1,t.users>0))return;const o=f(t.canvas).getExtension("WEBGL_lose_context");o&&o.loseContext(),delete we[d]}(this.canvasCacheKey_),delete this.gl_,delete this.canvas_}prepareDraw(t,e){const n=this.gl_,o=this.getCanvas(),s=t.size,p=t.pixelRatio;(o.width!==s[0]*p||o.height!==s[1]*p)&&(o.width=s[0]*p,o.height=s[1]*p,o.style.width=s[0]+"px",o.style.height=s[1]+"px");for(let _=this.postProcessPasses_.length-1;_>=0;_--)this.postProcessPasses_[_].init(t);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,e?n.ZERO:n.ONE_MINUS_SRC_ALPHA)}bindTexture(t,e,n){const o=this.gl_;o.activeTexture(o.TEXTURE0+e),o.bindTexture(o.TEXTURE_2D,t),o.uniform1i(this.getUniformLocation(n),e)}prepareDrawToRenderTarget(t,e,n){const o=this.gl_,s=e.getSize();o.bindFramebuffer(o.FRAMEBUFFER,e.getFramebuffer()),o.viewport(0,0,s[0],s[1]),o.bindTexture(o.TEXTURE_2D,e.getTexture()),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,n?o.ZERO:o.ONE_MINUS_SRC_ALPHA)}drawElements(t,e){const n=this.gl_;this.getExtension("OES_element_index_uint"),n.drawElements(n.TRIANGLES,e-t,n.UNSIGNED_INT,4*t)}finalizeDraw(t,e,n){for(let o=0,s=this.postProcessPasses_.length;o<s;o++)o===s-1?this.postProcessPasses_[o].apply(t,null,e,n):this.postProcessPasses_[o].apply(t,this.postProcessPasses_[o+1])}getCanvas(){return this.canvas_}getGL(){return this.gl_}applyFrameState(t){const e=t.size,n=t.viewState.rotation,o=t.pixelRatio,s=(0,G.mc)(this.offsetScaleMatrix_);(0,G.bA)(s,2/e[0],2/e[1]);const p=(0,G.mc)(this.offsetRotateMatrix_);0!==n&&(0,G.U1)(p,-n),this.setUniformMatrixValue("u_offsetScaleMatrix",Ie(this.tmpMat4_,s)),this.setUniformMatrixValue("u_offsetRotateMatrix",Ie(this.tmpMat4_,p)),this.setUniformFloatValue("u_time",.001*(Date.now()-this.startTime_)),this.setUniformFloatValue("u_zoom",t.viewState.zoom),this.setUniformFloatValue("u_resolution",t.viewState.resolution),this.setUniformFloatValue("u_pixelRatio",o),this.setUniformFloatVec2("u_viewportSizePx",[e[0],e[1]])}applyUniforms(t){const e=this.gl_;let n,o=0;this.uniforms_.forEach(s=>{if(n="function"==typeof s.value?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${o}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(!(n instanceof HTMLImageElement)||n.complete)&&s.prevValue!==n&&(s.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),e.uniform1i(this.getUniformLocation(s.name),o++);else if(Array.isArray(n)&&6===n.length)this.setUniformMatrixValue(s.name,Ie(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:return void e.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);case 3:return void e.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);case 4:return void e.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);default:return}else"number"==typeof n&&e.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const n=this.gl_,o=n.createShader(e);return n.shaderSource(o,t),n.compileShader(o),o}getProgram(t,e){const n=this.gl_,o=this.compileShader(t,n.FRAGMENT_SHADER),s=this.compileShader(e,n.VERTEX_SHADER),p=n.createProgram();if(n.attachShader(p,o),n.attachShader(p,s),n.linkProgram(p),!n.getShaderParameter(o,n.COMPILE_STATUS)){const _=`Fragment shader compilation failed: ${n.getShaderInfoLog(o)}`;throw new Error(_)}if(n.deleteShader(o),!n.getShaderParameter(s,n.COMPILE_STATUS)){const _=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(_)}if(n.deleteShader(s),!n.getProgramParameter(p,n.LINK_STATUS)){const _=`GL program linking failed: ${n.getProgramInfoLog(p)}`;throw new Error(_)}return p}getUniformLocation(t){const e=(0,C.sq)(this.currentProgram_);return void 0===this.uniformLocationsByProgram_[e]&&(this.uniformLocationsByProgram_[e]={}),void 0===this.uniformLocationsByProgram_[e][t]&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=(0,C.sq)(this.currentProgram_);return void 0===this.attribLocationsByProgram_[e]&&(this.attribLocationsByProgram_[e]={}),void 0===this.attribLocationsByProgram_[e][t]&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const n=t.size,s=t.viewState.resolution,p=t.viewState.center;return(0,G.qC)(e,0,0,2/(s*n[0]),2/(s*n[1]),-t.viewState.rotation,-p[0],-p[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,n,o,s){const p=this.getAttributeLocation(t);p<0||(this.gl_.enableVertexAttribArray(p),this.gl_.vertexAttribPointer(p,e,n,!1,o,s))}enableAttributes(t){const e=function nt(d){let t=0;for(let e=0;e<d.length;e++){const n=d[e];t+=n.size*Ge(n.type)}return t}(t);let n=0;for(let o=0;o<t.length;o++){const s=t[o];this.enableAttributeArray_(s.name,s.size,s.type||5126,e,n),n+=s.size*Ge(s.type)}}handleWebGLContextLost(){(0,Ke.Z)(this.bufferCache_),this.currentProgram_=null}handleWebGLContextRestored(){}createTexture(t,e,n){const o=this.gl_;n=n||o.createTexture();const p=o.RGBA,b=o.RGBA,E=o.UNSIGNED_BYTE;return o.bindTexture(o.TEXTURE_2D,n),e?o.texImage2D(o.TEXTURE_2D,0,p,b,E,e):o.texImage2D(o.TEXTURE_2D,0,p,t[0],t[1],0,b,E,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),n}};class Fe extends fe.Z{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=(0,G.Ue)(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,t.addChangeListener(I.Z.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(ie.Z.PRECOMPOSE)){const o=new re.Z(ie.Z.PRECOMPOSE,void 0,e,t);n.dispatchEvent(o)}}dispatchPostComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(ie.Z.POSTCOMPOSE)){const o=new re.Z(ie.Z.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(o)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let o,e=!0,n=-1;for(let p=0,_=t.layerStatesArray.length;p<_;p++){const b=t.layerStatesArray[p].layer,E=b.getRenderer();if(!(E instanceof Fe)){e=!0;continue}const F=b.getClassName();if((e||F!==o)&&(n+=1,e=!1),o=F,E===this)break}const s="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s))&&(this.removeHelper(),this.helper=new rt({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),o&&(this.helper.getCanvas().className=o),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,n){const o=this.getLayer();if(o.hasListener(t)){(0,G.qC)(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new re.Z(t,this.inversePixelTransform_,n,e);o.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_(ie.Z.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(ie.Z.POSTRENDER,t,e)}}const it=Fe;var ot=v(7555);const ee=new Uint8Array(4);function ct(d,t){const e=256,n=255;return(t=t||[])[0]=Math.floor(d/e/e/e)/n,t[1]=Math.floor(d/e/e)%e/n,t[2]=Math.floor(d/e)%e/n,t[3]=d%e/n,t}v(3688);var Ee=v(7796);const dt=class ft extends it{constructor(t,e){const n=e.uniforms||{},o=(0,G.Ue)();n.u_projectionMatrix=o,super(t,{uniforms:n,postProcesses:e.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new z(ue,r),this.hitVerticesBuffer_=new z(ue,r),this.indicesBuffer_=new z(34963,r),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.hitDetectionEnabled_=!(!e.hitFragmentShader||!e.hitVertexShader),this.hitVertexShader_=e.hitVertexShader,this.hitFragmentShader_=e.hitFragmentShader;const s=e.attributes?e.attributes.map(function(_){return{name:"a_"+_.name,size:1,type:Q.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:Q.FLOAT},{name:"a_index",size:1,type:Q.FLOAT}].concat(s),this.hitDetectionAttributes=[{name:"a_position",size:2,type:Q.FLOAT},{name:"a_index",size:1,type:Q.FLOAT},{name:"a_hitColor",size:4,type:Q.FLOAT},{name:"a_featureUid",size:1,type:Q.FLOAT}].concat(s),this.customAttributes=e.attributes?e.attributes:[],this.previousExtent_=(0,H.lJ)(),this.currentTransform_=o,this.renderTransform_=(0,G.Ue)(),this.invertRenderTransform_=(0,G.Ue)(),this.renderInstructions_=new Float32Array(0),this.hitRenderInstructions_=new Float32Array(0),this.lastSentId=0,this.worker_=function ut(){const d='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS",r={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:\'`renderMode` must be `"hybrid"` or `"vector"`\',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class o extends Error{constructor(e){const t=r[e];super(t),this.code=e,this.name="AssertionError",this.message=t}}var i=o;function a(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function s(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new i(t)}(0!==n,32);const o=t[0],a=t[1],s=t[2],u=t[3],f=t[4],x=t[5];return e[0]=u/n,e[1]=-a/n,e[2]=-s/n,e[3]=o/n,e[4]=(s*x-u*f)/n,e[5]=-(o*x-a*f)/n,e}function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var f={exports:{}};function x(e,t,n){n=n||2;var r,o,i,a,s,u,f,x=t&&t.length,h=x?t[0]*n:e.length,v=l(e,0,h,n,!0),d=[];if(!v||v.next===v.prev)return d;if(x&&(v=function(e,t,n,r){var o,i,a,s=[];for(o=0,i=t.length;o<i;o++)(a=l(e,t[o]*r,o<i-1?t[o+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(A(a));for(s.sort(b),o=0;o<s.length;o++)n=g(s[o],n);return n}(e,t,v,n)),e.length>80*n){r=i=e[0],o=a=e[1];for(var y=n;y<h;y+=n)(s=e[y])<r&&(r=s),(u=e[y+1])<o&&(o=u),s>i&&(i=s),u>a&&(a=u);f=0!==(f=Math.max(i-r,a-o))?32767/f:0}return c(v,d,n,r,o,f,0),d}function l(e,t,n,r,o){var i,a;if(o===P(e,t,n,r)>0)for(i=t;i<n;i+=r)a=k(i,e[i],e[i+1],a);else for(i=n-r;i>=t;i-=r)a=k(i,e[i],e[i+1],a);return a&&F(a,a.next)&&(R(a),a=a.next),a}function h(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!F(r,r.next)&&0!==Z(r.prev,r,r.next))r=r.next;else{if(R(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function c(e,t,n,r,o,i,a){if(e){!a&&i&&function(e,t,n,r){var o=e;do{0===o.z&&(o.z=w(o.x,o.y,t,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,n,r,o,i,a,s,u,f=1;do{for(n=e,e=null,i=null,a=0;n;){for(a++,r=n,s=0,t=0;t<f&&(s++,r=r.nextZ);t++);for(u=f;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(o=n,n=n.nextZ,s--):(o=r,r=r.nextZ,u--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;n=r}i.nextZ=null,f*=2}while(a>1)}(o)}(e,r,o,i);for(var s,u,f=e;e.prev!==e.next;)if(s=e.prev,u=e.next,i?d(e,r,o,i):v(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(u.i/n|0),R(e),e=u.next,f=u.next;else if((e=u)===f){a?1===a?c(e=y(h(e),t,n),t,n,r,o,i,2):2===a&&p(e,t,n,r,o,i):c(h(e),t,n,r,o,i,1);break}}}function v(e){var t=e.prev,n=e,r=e.next;if(Z(t,n,r)>=0)return!1;for(var o=t.x,i=n.x,a=r.x,s=t.y,u=n.y,f=r.y,x=o<i?o<a?o:a:i<a?i:a,l=s<u?s<f?s:f:u<f?u:f,h=o>i?o>a?o:a:i>a?i:a,c=s>u?s>f?s:f:u>f?u:f,v=r.next;v!==t;){if(v.x>=x&&v.x<=h&&v.y>=l&&v.y<=c&&E(o,s,i,u,a,f,v.x,v.y)&&Z(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function d(e,t,n,r){var o=e.prev,i=e,a=e.next;if(Z(o,i,a)>=0)return!1;for(var s=o.x,u=i.x,f=a.x,x=o.y,l=i.y,h=a.y,c=s<u?s<f?s:f:u<f?u:f,v=x<l?x<h?x:h:l<h?l:h,d=s>u?s>f?s:f:u>f?u:f,y=x>l?x>h?x:h:l>h?l:h,p=w(c,v,t,n,r),b=w(d,y,t,n,r),g=e.prevZ,m=e.nextZ;g&&g.z>=p&&m&&m.z<=b;){if(g.x>=c&&g.x<=d&&g.y>=v&&g.y<=y&&g!==o&&g!==a&&E(s,x,u,l,f,h,g.x,g.y)&&Z(g.prev,g,g.next)>=0)return!1;if(g=g.prevZ,m.x>=c&&m.x<=d&&m.y>=v&&m.y<=y&&m!==o&&m!==a&&E(s,x,u,l,f,h,m.x,m.y)&&Z(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;g&&g.z>=p;){if(g.x>=c&&g.x<=d&&g.y>=v&&g.y<=y&&g!==o&&g!==a&&E(s,x,u,l,f,h,g.x,g.y)&&Z(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;m&&m.z<=b;){if(m.x>=c&&m.x<=d&&m.y>=v&&m.y<=y&&m!==o&&m!==a&&E(s,x,u,l,f,h,m.x,m.y)&&Z(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function y(e,t,n){var r=e;do{var o=r.prev,i=r.next.next;!F(o,i)&&T(o,r,r.next,i)&&z(o,i)&&z(i,o)&&(t.push(o.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),R(r),R(r.next),r=e=i),r=r.next}while(r!==e);return h(r)}function p(e,t,n,r,o,i){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&M(a,s)){var u=U(a,s);return a=h(a,a.next),u=h(u,u.next),c(a,t,n,r,o,i,0),void c(u,t,n,r,o,i,0)}s=s.next}a=a.next}while(a!==e)}function b(e,t){return e.x-t.x}function g(e,t){var n=function(e,t){var n,r=t,o=e.x,i=e.y,a=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=o&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===o))return n}r=r.next}while(r!==t);if(!n)return null;var u,f=n,x=n.x,l=n.y,h=1/0;r=n;do{o>=r.x&&r.x>=x&&o!==r.x&&E(i<l?o:a,i,x,l,i<l?a:o,i,r.x,r.y)&&(u=Math.abs(i-r.y)/(o-r.x),z(r,e)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&m(n,r)))&&(n=r,h=u)),r=r.next}while(r!==f);return n}(e,t);if(!n)return t;var r=U(n,e);return h(r,r.next),h(n,n.next)}function m(e,t){return Z(e.prev,e,t.prev)<0&&Z(t.next,e,e.next)<0}function w(e,t,n,r,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function A(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function E(e,t,n,r,o,i,a,s){return(o-a)*(t-s)>=(e-a)*(i-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(i-s)>=(o-a)*(r-s)}function M(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&T(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,o=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&o<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Z(e.prev,e,t.prev)||Z(e,t.prev,t))||F(e,t)&&Z(e.prev,e,e.next)>0&&Z(t.prev,t,t.next)>0)}function Z(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function F(e,t){return e.x===t.x&&e.y===t.y}function T(e,t,n,r){var o=S(Z(e,t,n)),i=S(Z(e,t,r)),a=S(Z(n,r,e)),s=S(Z(n,r,t));return o!==i&&a!==s||(!(0!==o||!I(e,n,t))||(!(0!==i||!I(e,r,t))||(!(0!==a||!I(n,e,r))||!(0!==s||!I(n,t,r)))))}function I(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function S(e){return e>0?1:e<0?-1:0}function z(e,t){return Z(e.prev,e,e.next)<0?Z(e,t,e.next)>=0&&Z(e,e.prev,t)>=0:Z(e,t,e.prev)<0||Z(e,e.next,t)<0}function U(e,t){var n=new B(e.i,e.x,e.y),r=new B(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function k(e,t,n,r){var o=new B(e,t,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function R(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function B(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(e,t,n,r){for(var o=0,i=t,a=n-r;i<n;i+=r)o+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return o}f.exports=x,f.exports.default=x,x.deviation=function(e,t,n,r){var o=t&&t.length,i=o?t[0]*n:e.length,a=Math.abs(P(e,0,i,n));if(o)for(var s=0,u=t.length;s<u;s++){var f=t[s]*n,x=s<u-1?t[s+1]*n:e.length;a-=Math.abs(P(e,f,x,n))}var l=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,c=r[s+1]*n,v=r[s+2]*n;l+=Math.abs((e[h]-e[v])*(e[c+1]-e[h+1])-(e[h]-e[c])*(e[v+1]-e[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},x.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var a=0;a<t;a++)n.vertices.push(e[o][i][a]);o>0&&(r+=e[o-1].length,n.holes.push(r))}return n};var N=u(f.exports);const _=[],O={vertexPosition:0,indexPosition:0};function q(e,t,n,r,o){e[t+0]=n,e[t+1]=r,e[t+2]=o}function L(e,t,n,r,o,i){const a=3+o,s=e[t+0],u=e[t+1],f=_;f.length=o;for(let n=0;n<f.length;n++)f[n]=e[t+2+n];let x=i?i.vertexPosition:0,l=i?i.indexPosition:0;const h=x/a;return q(n,x,s,u,0),f.length&&n.set(f,x+3),x+=a,q(n,x,s,u,1),f.length&&n.set(f,x+3),x+=a,q(n,x,s,u,2),f.length&&n.set(f,x+3),x+=a,q(n,x,s,u,3),f.length&&n.set(f,x+3),x+=a,r[l++]=h,r[l++]=h+1,r[l++]=h+3,r[l++]=h+1,r[l++]=h+2,r[l++]=h+3,O.vertexPosition=x,O.indexPosition=l,O}function C(e,t,n,r,o,i,s,u,f,x){const l=5+u.length,h=i.length/l,c=[e[t+0],e[t+1]],v=[e[n],e[n+1]],d=a(x,[...c]),y=a(x,[...v]);function p(e,t,n){const r=1e4;return Math.round(1500*t)+Math.round(1500*n)*r+e*r*r}function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),o=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-o[1],o[0]],a=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),s=[(n[0]-e[0])/a,(n[1]-e[1])/a],u=0===r||0===a?0:Math.acos((f=s[0]*o[0]+s[1]*o[1],x=-1,l=1,Math.min(Math.max(f,x),l)));var f,x,l;return s[0]*i[0]+s[1]*i[1]>0?u:2*Math.PI-u}const g=null!==o;let m=0,w=0;if(null!==r){m=b(d,y,a(x,[...[e[r],e[r+1]]]))}if(g){w=b(y,d,a(x,[...[e[o],e[o+1]]]))}i.push(c[0],c[1],v[0],v[1],p(0,m,w)),i.push(...u),i.push(c[0],c[1],v[0],v[1],p(1,m,w)),i.push(...u),i.push(c[0],c[1],v[0],v[1],p(2,m,w)),i.push(...u),i.push(c[0],c[1],v[0],v[1],p(3,m,w)),i.push(...u),s.push(h,h+1,h+2,h+1,h+3,h+2)}function G(e,t,n,r,o){const i=2+o;let a=t;const s=e.slice(a,a+o);a+=o;const u=e[a++];let f=0;const x=new Array(u-1);for(let t=0;t<u;t++)f+=e[a++],t<u-1&&(x[t]=f);const l=e.slice(a,a+2*f),h=N(l,x,2);for(let e=0;e<h.length;e++)r.push(h[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...s);return a+2*f}const j=self;j.onmessage=r=>{const o=r.data;switch(o.type){case t:{const e=3,t=2,n=o.customAttributesSize,r=t+n,i=new Float32Array(o.renderInstructions),a=i.length/r,s=4*a*(n+e),u=new Uint32Array(6*a),f=new Float32Array(s);let x;for(let e=0;e<i.length;e+=r)x=L(i,e,f,u,n,x);const l=Object.assign({vertexBuffer:f.buffer,indexBuffer:u.buffer,renderInstructions:i.buffer},o);j.postMessage(l,[f.buffer,u.buffer,i.buffer]);break}case n:{const e=[],t=[],n=o.customAttributesSize,r=2,i=new Float32Array(o.renderInstructions);let a=0;const u=o.renderInstructionsTransform,f=[1,0,0,1,0,0];let x,l;for(s(f,u);a<i.length;){l=Array.from(i.slice(a,a+n)),a+=n,x=i[a++];for(let n=0;n<x-1;n++)C(i,a+n*r,a+(n+1)*r,n>0?a+(n-1)*r:null,n<x-2?a+(n+2)*r:null,e,t,l,0,f);a+=x*r}const h=Uint32Array.from(t),c=Float32Array.from(e),v=Object.assign({vertexBuffer:c.buffer,indexBuffer:h.buffer,renderInstructions:i.buffer},o);j.postMessage(v,[c.buffer,h.buffer,i.buffer]);break}case e:{const e=[],t=[],n=o.customAttributesSize,r=new Float32Array(o.renderInstructions);let i=0;for(;i<r.length;)i=G(r,i,e,t,n);const a=Uint32Array.from(t),s=Float32Array.from(e),u=Object.assign({vertexBuffer:s.buffer,indexBuffer:a.buffer,renderInstructions:r.buffer},o);j.postMessage(u,[s.buffer,a.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(d,"binary").toString("base64"):URL.createObjectURL(new Blob([d],{type:"application/javascript"})))}(),this.worker_.addEventListener("message",_=>{const b=_.data;if("GENERATE_POINT_BUFFERS"===b.type){const E=b.projectionTransform;b.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(b.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(b.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(b.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=E,(0,G.nb)(this.invertRenderTransform_,this.renderTransform_),b.hitDetection?this.hitRenderInstructions_=new Float32Array(_.data.renderInstructions):(this.renderInstructions_=new Float32Array(_.data.renderInstructions),b.id===this.lastSentId&&(this.ready=!0)),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const p=this.getLayer().getSource();this.sourceListenKeys_=[(0,Ee.oL)(p,q.Z.ADDFEATURE,this.handleSourceFeatureAdded_,this),(0,Ee.oL)(p,q.Z.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,Ee.oL)(p,q.Z.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,Ee.oL)(p,q.Z.CLEAR,this.handleSourceFeatureClear_,this)],p.forEachFeature(_=>{this.featureCache_[(0,C.sq)(_)]={feature:_,properties:_.getProperties(),geometry:_.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new class st{constructor(t,e){this.helper_=t;const n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){(0,ot.fS)(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return ee[0]=0,ee[1]=0,ee[2]=0,ee[3]=0,ee;this.readAll();const n=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return ee[0]=this.data_[4*n],ee[1]=this.data_[4*n+1],ee[2]=this.data_[4*n+2],ee[3]=this.data_[4*n+3],ee}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(t[0]*t[1]*4)}}(this.helper))}handleSourceFeatureAdded_(t){const e=t.feature;this.featureCache_[(0,C.sq)(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(t){const e=t.feature;this.featureCache_[(0,C.sq)(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}}handleSourceFeatureDelete_(t){delete this.featureCache_[(0,C.sq)(t.feature)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const n=t.viewState.projection,p=this.getLayer().getSource().getWrapX()&&n.canWrapX(),_=n.getExtent(),b=t.extent,E=p?(0,H.dz)(_):null,F=p?Math.ceil((b[2]-_[2])/E)+1:1,O=p?Math.floor((b[0]-_[0])/E):0;let R=O;const P=this.indicesBuffer_.getSize();do{this.helper.makeProjectionTransform(t,this.currentTransform_),(0,G.Iu)(this.currentTransform_,R*E,0),(0,G.Jp)(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.drawElements(0,P)}while(++R<F);this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const S=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(t,O,F,E),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),S}prepareFrameInternal(t){const e=this.getLayer(),n=e.getSource(),o=t.viewState,s=!t.viewHints[Ae.Z.ANIMATING]&&!t.viewHints[Ae.Z.INTERACTING],p=!(0,H.fS)(this.previousExtent_,t.extent),_=this.sourceRevision_<n.getRevision();if(_&&(this.sourceRevision_=n.getRevision()),s&&(p||_)){const b=o.projection,E=o.resolution,F=e instanceof te.Z?e.getRenderBuffer():0,O=(0,H.f3)(t.extent,F*E);n.loadFeatures(O,E,b),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(t){const e=(0,G.Ue)();this.helper.makeProjectionTransform(t,e);const n=(2+this.customAttributes.length)*this.featureCount_;if((!this.renderInstructions_||this.renderInstructions_.length!==n)&&(this.renderInstructions_=new Float32Array(n)),this.hitDetectionEnabled_){const R=(7+this.customAttributes.length)*this.featureCount_;(!this.hitRenderInstructions_||this.hitRenderInstructions_.length!==R)&&(this.hitRenderInstructions_=new Float32Array(R))}let o,s;const p=[],_=[];let F,b=0,E=0;for(const R in this.featureCache_){if(o=this.featureCache_[R],s=o.geometry,!s||"Point"!==s.getType())continue;let P;p[0]=s.getFlatCoordinates()[0],p[1]=s.getFlatCoordinates()[1],(0,G.nn)(e,p),F=ct(E+6,_),this.renderInstructions_[b++]=p[0],this.renderInstructions_[b++]=p[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[E++]=p[0],this.hitRenderInstructions_[E++]=p[1],this.hitRenderInstructions_[E++]=F[0],this.hitRenderInstructions_[E++]=F[1],this.hitRenderInstructions_[E++]=F[2],this.hitRenderInstructions_[E++]=F[3],this.hitRenderInstructions_[E++]=Number(R));for(let S=0;S<this.customAttributes.length;S++)P=this.customAttributes[S].callback(o.feature,o.properties),this.renderInstructions_[b++]=P,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[E++]=P)}const O={id:++this.lastSentId,type:"GENERATE_POINT_BUFFERS",renderInstructions:this.renderInstructions_.buffer,customAttributesSize:this.customAttributes.length};if(O.projectionTransform=e,this.ready=!1,this.worker_.postMessage(O,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){const R={id:0,type:"GENERATE_POINT_BUFFERS",renderInstructions:this.hitRenderInstructions_.buffer,customAttributesSize:5+this.customAttributes.length};R.projectionTransform=e,R.hitDetection=!0,this.worker_.postMessage(R,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}}forEachFeatureAtCoordinate(t,e,n,o,s){if((0,T.h)(this.hitDetectionEnabled_,66),!this.hitRenderInstructions_)return;const p=(0,G.nn)(e.coordinateToPixelTransform,t.slice()),_=this.hitRenderTarget_.readPixel(p[0]/2,p[1]/2),E=function ht(d){let t=0;const e=256,n=255;return t+=Math.round(d[0]*e*e*e*n),t+=Math.round(d[1]*e*e*n),t+=Math.round(d[2]*e*n),t+=Math.round(d[3]*n),t}([_[0]/255,_[1]/255,_[2]/255,_[3]/255]),O=Math.floor(this.hitRenderInstructions_[E]).toString(),P=this.getLayer().getSource().getFeatureByUid(O);return P?o(P,this.getLayer(),null):void 0}renderHitDetection(t,e,n,o){if(!this.hitVerticesBuffer_.getSize())return;let s=e;this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.useProgram(this.hitProgram_,t),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),(0,G.Iu)(this.currentTransform_,s*o,0),(0,G.Jp)(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t);const p=this.indicesBuffer_.getSize();this.helper.drawElements(0,p)}while(++s<n)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){(0,Ee.bN)(t)}),this.sourceListenKeys_=null,super.disposeInternal()}};var gt=v(3469),pt=v(7120);const xt=["#00f","#0ff","#0f0","#ff0","#f00"],_t=class mt extends te.Z{constructor(t){t=t||{};const e=Object.assign({},t);delete e.gradient,delete e.radius,delete e.blur,delete e.weight,super(e),this.gradient_=null,this.addChangeListener("gradient",this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:xt),this.setBlur(void 0!==t.blur?t.blur:15),this.setRadius(void 0!==t.radius?t.radius:8);const n=t.weight?t.weight:"weight";this.weightFunction_="string"==typeof n?function(o){return o.get(n)}:n,this.setRenderOrder(null)}getBlur(){return this.get("blur")}getGradient(){return this.get("gradient")}getRadius(){return this.get("radius")}handleGradientChanged_(){this.gradient_=function vt(d){const n=(0,pt.E4)(1,256),o=n.createLinearGradient(0,0,1,256),s=1/(d.length-1);for(let p=0,_=d.length;p<_;++p)o.addColorStop(p*s,d[p]);return n.fillStyle=o,n.fillRect(0,0,1,256),n.canvas}(this.getGradient())}setBlur(t){this.set("blur",t)}setGradient(t){this.set("gradient",t)}setRadius(t){this.set("radius",t)}createRenderer(){return new dt(this,{className:this.getClassName(),attributes:[{name:"weight",callback:t=>{const e=this.weightFunction_(t);return void 0!==e?(0,gt.uZ)(e,0,1):1}}],vertexShader:"\n        precision mediump float;\n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform float u_size;\n        attribute vec2 a_position;\n        attribute float a_index;\n        attribute float a_weight;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n\n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;\n          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;\n          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;\n          v_texCoord = vec2(u, v);\n          v_weight = a_weight;\n        }",fragmentShader:"\n        precision mediump float;\n        uniform float u_blurSlope;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n\n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_weight;\n          gl_FragColor = vec4(alpha, alpha, alpha, alpha);\n        }",hitVertexShader:"\n        precision mediump float;\n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform float u_size;\n        attribute vec2 a_position;\n        attribute float a_index;\n        attribute float a_weight;\n        attribute vec4 a_hitColor;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n        varying vec4 v_hitColor;\n\n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;\n          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;\n          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;\n          v_texCoord = vec2(u, v);\n          v_hitColor = a_hitColor;\n          v_weight = a_weight;\n        }",hitFragmentShader:"\n        precision mediump float;\n        uniform float u_blurSlope;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n        varying vec4 v_hitColor;\n\n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_weight;\n          if (alpha < 0.05) {\n            discard;\n          }\n\n          gl_FragColor = v_hitColor;\n        }",uniforms:{u_size:()=>2*(this.get("radius")+this.get("blur")),u_blurSlope:()=>this.get("radius")/Math.max(1,this.get("blur"))},postProcesses:[{fragmentShader:"\n            precision mediump float;\n\n            uniform sampler2D u_image;\n            uniform sampler2D u_gradientTexture;\n            uniform float u_opacity;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n              vec4 color = texture2D(u_image, v_texCoord);\n              gl_FragColor.a = color.a * u_opacity;\n              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;\n              gl_FragColor.rgb *= gl_FragColor.a;\n            }",uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}};var Tt=v(5930),yt=v(902),Et=v(5311),bt=v(2620),Ct=v(8536),Rt=v(2012),je=v(6223),At=v(6069);let St=(()=>{class d{constructor(){this.background="",this.pointBlur=15,this.pointRadius=10,this.data=[],this.extent=[0,0,1024,968],this.projection=new Z.Z({code:"xkcd-image",units:"pixels",extent:this.extent})}ngOnInit(){this.loadHeatmap()}ngOnChanges(e){e.background&&this.loadHeatmap(),e.data&&this.loadData()}loadData(){this.source.clear(),this.data.forEach(e=>{const n=new yt.Z(new Et.Z([e.xPx,e.yPx]));this.source.addFeature(n),this.source.changed()})}loadHeatmap(){this.map&&this.map.dispose(),this.map=new V.Z({target:"map",view:new m.ZP({projection:this.projection,center:(0,H.qg)(this.extent),zoom:2,maxZoom:8})}),this.loadLayer()}loadLayer(){const e=new bt.Z({source:new Ct.Z});this.source=new Tt.Z({}),this.heatmapLayer=new _t({source:this.source,blur:this.pointBlur,radius:this.pointRadius,opacity:1});const n=[new A.Z({source:new N.Z({url:this.background,imageSize:[1e3,1e3],projection:this.projection,imageExtent:this.extent})}),this.heatmapLayer,e];setTimeout(()=>{this.map.updateSize()}),this.map.setLayers(n),this.map.render()}onHeatmapSettingsChange(){this.heatmapLayer.setRadius(this.pointRadius),this.heatmapLayer.setBlur(this.pointBlur),this.heatmapLayer.changed()}}return d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=h.Xpm({type:d,selectors:[["uwb-heatmap"]],inputs:{background:"background",pointBlur:"pointBlur",pointRadius:"pointRadius",data:"data"},features:[h.TTD],decls:11,vars:4,consts:[["id","map",1,"map"],["icon","pi pi-cog",3,"onClick"],["ol",""],[1,"w-16rem","m-2"],[1,"w-full",3,"ngModel","ngModelChange","onChange"]],template:function(e,n){if(1&e){const o=h.EpF();h.TgZ(0,"div",0)(1,"p-button",1),h.NdJ("onClick",function(p){h.CHM(o);const _=h.MAs(3);return h.KtG(_.toogleOverlay(p))}),h.qZA()(),h.TgZ(2,"uwb-overlay",null,2)(4,"div",3)(5,"p"),h._uU(6),h.qZA(),h.TgZ(7,"p-slider",4),h.NdJ("ngModelChange",function(p){return n.pointRadius=p})("onChange",function(){return n.onHeatmapSettingsChange()}),h.qZA(),h.TgZ(8,"p"),h._uU(9),h.qZA(),h.TgZ(10,"p-slider",4),h.NdJ("ngModelChange",function(p){return n.pointBlur=p})("onChange",function(){return n.onHeatmapSettingsChange()}),h.qZA()()()}2&e&&(h.xp6(6),h.hij("Promie\u0144: ",n.pointRadius,""),h.xp6(1),h.Q6J("ngModel",n.pointRadius),h.xp6(2),h.hij("Blur: ",n.pointBlur,""),h.xp6(1),h.Q6J("ngModel",n.pointBlur))},dependencies:[ae.zx,Rt.iR,je.JJ,je.On,At.j],styles:[".map[_ngcontent-%COMP%]{width:100%;height:100%;border:2px solid var(--uwb-primary);border-radius:15px}  .map .p-button{position:absolute;z-index:100;margin-left:.5rem;margin-top:.5rem}  .ol-control{display:flex}  .ol-control button{background-color:var(--uwb-button-background);color:var(--uwb-button-text-color);height:30px;width:30px;border-radius:15px}  .ol-zoom{right:.5rem;left:auto}"]}),d})();var wt=v(7397),Ut=v(3999);function Lt(d,t){if(1&d&&(h.TgZ(0,"div",11),h._UZ(1,"img",12),h._uU(2),h.qZA()),2&d){const e=t.item;h.s9C("pTooltip",e.name),h.xp6(1),h.Q6J("src",e.path,h.LSH),h.xp6(1),h.hij(" ",e.name," ")}}const Pt=[{path:"occurrence-map",component:(()=>{class d{constructor(e,n,o,s,p,_,b){this.backgroundsService=e,this.localizationsArchiveService=n,this.objectsService=o,this.authorityService=s,this.arrayBufferService=p,this.clientsService=_,this.sizeScreenService=b,this.treeSelectItems=[],this.backgrounds=[],this.objects=[],this.selectedRangeDate=[],this.handleSelectedRangeDate=[],this.localizations=[],this.radius=10,this.blur=15,this.smallScreen=!1}ngOnInit(){this.sizeScreenService.smallScreen$.subscribe(e=>{this.smallScreen=e}),this.userOrganizationUnitId=this.authorityService.getUserOrganizationUnitId(),this.loadOrganizationUnits(),this.loadBackgrounds()}loadOrganizationUnits(){this.clientsService.findTree().subscribe(e=>{this.treeSelectItems=e.body??[],this.treeSelectItemSelected=this.clientsService.findByIdFromUnits(this.treeSelectItems[0],this.userOrganizationUnitId),this.selectedOrganizationUnit=this.treeSelectItemSelected.data})}loadBackgrounds(){this.backgroundsService.findAllByUserOrganizationUnit(this.userOrganizationUnitId).subscribe(e=>{this.backgrounds=e.body??[],this.backgrounds.forEach(n=>n.fullPath=this.arrayBufferService.convertImage(n.pathArrayBuffer))})}loadObjects(){this.objectsService.findAllByUserOrganizationUnit(this.userOrganizationUnitId).subscribe(e=>{this.objects=e.body??[]})}loadLocalizationsData(){const e=this.selectedRangeDate[0],n=this.selectedRangeDate[1];this.localizationsArchiveService.findAllByTagIdAndDateBetween(this.selectedObject?.hexTagId,e,n).subscribe(o=>{this.localizations=o.body??[],this.localizations.forEach(s=>{s.xPx=this.selectedBackground?.scale?s.x*this.selectedBackground?.scale:s.x,s.yPx=this.selectedBackground?.scale?s.y*this.selectedBackground?.scale:s.y})})}onOrganizationUnitSelect(e){this.selectedOrganizationUnit?.id!==e.id&&(this.selectedOrganizationUnit=e,this.treeSelectItemSelected=this.clientsService.findByIdFromUnits(this.treeSelectItems[0],this.selectedOrganizationUnit.id),this.selectedBackground=void 0,this.loadBackgrounds())}onBackgroundSelect(e){this.selectedBackground=e,this.selectedBackground?this.loadObjects():this.objects=[]}onObjectSelect(e){this.selectedObject=e}onDateChange(e){this.selectedRangeDate=e}checkIsAllValid(){return this.selectedBackground&&this.selectedObject&&2===this.selectedRangeDate.length}onLoadLocalizationsArchive(){(this.handleSelectedObject?.id!==this.selectedObject?.id||this.selectedRangeDate[0]!==this.handleSelectedRangeDate[0]||this.selectedRangeDate[1]!==this.handleSelectedRangeDate[1])&&(this.loadLocalizationsData(),this.handleSelectedObject=this.selectedObject,this.handleSelectedRangeDate={...this.selectedRangeDate})}}return d.\u0275fac=function(e){return new(e||d)(h.Y36(he.s),h.Y36(W.d),h.Y36(k.h),h.Y36(X.g),h.Y36(K.A),h.Y36(se.a),h.Y36(xe.p))},d.\u0275cmp=h.Xpm({type:d,selectors:[["uwb-occurence-map"]],decls:14,vars:36,consts:[[1,"h-full"],[1,"grid"],[1,"col-12",3,"treeSelectValue","options","optionLabel","floatLabel","placeholder","modelChange"],["optionLabel","name",3,"items","label","itemTemplate","modelChange"],["pTemplate","item"],["itemTemplate",""],[1,"pt-0","px-1","flex","justify-content-center",3,"rangeMode","showTime","modelChange"],["optionLabel","name",3,"showClear","items","label","modelChange"],[1,"flex","justify-content-center","align-items-end",2,"height","80px"],["icon","pi pi-search",3,"disabled","onClick"],[3,"background","data","pointRadius","pointBlur"],[1,"flex","align-items-center",3,"pTooltip"],[2,"height","30px",3,"src"]],template:function(e,n){if(1&e&&(h.TgZ(0,"div",0)(1,"div",1)(2,"uwb-tree-select",2),h.NdJ("modelChange",function(s){return n.onOrganizationUnitSelect(s)}),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"uwb-single-select",3),h.NdJ("modelChange",function(s){return n.onBackgroundSelect(s)}),h.ALo(5,"translate"),h.YNc(6,Lt,3,3,"ng-template",4,5,h.W1O),h.qZA(),h.TgZ(8,"uwb-calendar",6),h.NdJ("modelChange",function(s){return n.onDateChange(s)}),h.qZA(),h.TgZ(9,"uwb-single-select",7),h.NdJ("modelChange",function(s){return n.onObjectSelect(s)}),h.ALo(10,"translate"),h.qZA(),h.TgZ(11,"div",8)(12,"p-button",9),h.NdJ("onClick",function(){return n.onLoadLocalizationsArchive()}),h.qZA()()(),h._UZ(13,"uwb-heatmap",10),h.qZA()),2&e){const o=h.MAs(7);h.Tol(n.smallScreen?"single_map_with_hight_navbar_small_screen":"single_map_with_hight_navbar"),h.xp6(2),h.Tol(n.smallScreen?"m-0":"mt-1"),h.Q6J("treeSelectValue",n.treeSelectItemSelected)("options",n.treeSelectItems)("optionLabel","name")("floatLabel",!1)("placeholder",h.lcZ(3,30,"background.organizationUnit")),h.xp6(2),h.Tol(n.smallScreen?"col-12":"col pt-0 px-1"),h.s9C("label",h.lcZ(5,32,"localization.backgrounds")),h.Q6J("items",n.backgrounds)("itemTemplate",o),h.xp6(4),h.Tol(n.smallScreen?"col-12":"col-3"),h.Q6J("rangeMode",!0)("showTime",!0),h.xp6(1),h.Tol(n.smallScreen?"col-12":"col-4 pt-0 px-1"),h.s9C("label",h.lcZ(10,34,"localization.objects")),h.Q6J("showClear",!1)("items",n.objects),h.xp6(2),h.Tol(n.smallScreen?"col-12":"col-1 pt-0 px-1"),h.xp6(1),h.Q6J("disabled",!n.checkIsAllValid()),h.xp6(1),h.Q6J("background",null==n.selectedBackground?null:n.selectedBackground.fullPath)("data",n.localizations)("pointRadius",n.radius)("pointBlur",n.blur)}},dependencies:[me.jx,ve.u,ae.zx,_e.q,U.g,St,wt.s,Ut.X$]}),d})()}];let Mt=(()=>{class d{}return d.\u0275fac=function(e){return new(e||d)},d.\u0275mod=h.oAB({type:d}),d.\u0275inj=h.cJS({imports:[g.K,B.m,oe.Bz.forChild(Pt)]}),d})()},3688:pe=>{function J(r,a,i){i=i||2;var x,y,T,D,M,w,z,l=a&&a.length,c=l?a[0]*i:r.length,u=v(r,0,c,i,!0),f=[];if(!u||u.next===u.prev)return f;if(l&&(u=function k(r,a,i,l){var u,f,T,c=[];for(u=0,f=a.length;u<f;u++)(T=v(r,a[u]*l,u<f-1?a[u+1]*l:r.length,l,!1))===T.next&&(T.steiner=!0),c.push(_e(T));for(c.sort(X),u=0;u<c.length;u++)i=K(c[u],i);return i}(r,a,u,i)),r.length>80*i){x=T=r[0],y=D=r[1];for(var I=i;I<c;I+=i)(M=r[I])<x&&(x=M),(w=r[I+1])<y&&(y=w),M>T&&(T=M),w>D&&(D=w);z=0!==(z=Math.max(T-x,D-y))?32767/z:0}return B(u,f,i,x,y,z,0),f}function v(r,a,i,l,c){var u,f;if(c===ye(r,a,i,l)>0)for(u=a;u<i;u+=l)f=ue(u,r[u],r[u+1],f);else for(u=i-l;u>=a;u-=l)f=ue(u,r[u],r[u+1],f);return f&&A(f,f.next)&&(ne(f),f=f.next),f}function g(r,a){if(!r)return r;a||(a=r);var l,i=r;do{if(l=!1,i.steiner||!A(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{if(ne(i),(i=a=i.prev)===i.next)break;l=!0}}while(l||i!==a);return a}function B(r,a,i,l,c,u,f){if(r){!f&&u&&function me(r,a,i,l){var c=r;do{0===c.z&&(c.z=ae(c.x,c.y,a,i,l)),c.prevZ=c.prev,c.nextZ=c.next,c=c.next}while(c!==r);c.prevZ.nextZ=null,c.prevZ=null,function ve(r){var a,i,l,c,u,f,x,y,T=1;do{for(i=r,r=null,u=null,f=0;i;){for(f++,l=i,x=0,a=0;a<T&&(x++,l=l.nextZ);a++);for(y=T;x>0||y>0&&l;)0!==x&&(0===y||!l||i.z<=l.z)?(c=i,i=i.nextZ,x--):(c=l,l=l.nextZ,y--),u?u.nextZ=c:r=c,c.prevZ=u,u=c;i=l}u.nextZ=null,T*=2}while(f>1)}(c)}(r,l,c,u);for(var y,T,x=r;r.prev!==r.next;)if(y=r.prev,T=r.next,u?h(r,l,c,u):oe(r))a.push(y.i/i|0),a.push(r.i/i|0),a.push(T.i/i|0),ne(r),r=T.next,x=T.next;else if((r=T)===x){f?1===f?B(r=he(g(r),a,i),a,i,l,c,u,2):2===f&&W(r,a,i,l,c,u):B(g(r),a,i,l,c,u,1);break}}}function oe(r){var a=r.prev,i=r,l=r.next;if(m(a,i,l)>=0)return!1;for(var c=a.x,u=i.x,f=l.x,x=a.y,y=i.y,T=l.y,D=c<u?c<f?c:f:u<f?u:f,M=x<y?x<T?x:T:y<T?y:T,w=c>u?c>f?c:f:u>f?u:f,z=x>y?x>T?x:T:y>T?y:T,I=l.next;I!==a;){if(I.x>=D&&I.x<=w&&I.y>=M&&I.y<=z&&U(c,x,u,y,f,T,I.x,I.y)&&m(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function h(r,a,i,l){var c=r.prev,u=r,f=r.next;if(m(c,u,f)>=0)return!1;for(var x=c.x,y=u.x,T=f.x,D=c.y,M=u.y,w=f.y,z=x<y?x<T?x:T:y<T?y:T,I=D<M?D<w?D:w:M<w?M:w,fe=x>y?x>T?x:T:y>T?y:T,re=D>M?D>w?D:w:M>w?M:w,ie=ae(z,I,a,i,l),de=ae(fe,re,a,i,l),L=r.prevZ,C=r.nextZ;L&&L.z>=ie&&C&&C.z<=de;){if(L.x>=z&&L.x<=fe&&L.y>=I&&L.y<=re&&L!==c&&L!==f&&U(x,D,y,M,T,w,L.x,L.y)&&m(L.prev,L,L.next)>=0||(L=L.prevZ,C.x>=z&&C.x<=fe&&C.y>=I&&C.y<=re&&C!==c&&C!==f&&U(x,D,y,M,T,w,C.x,C.y)&&m(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;L&&L.z>=ie;){if(L.x>=z&&L.x<=fe&&L.y>=I&&L.y<=re&&L!==c&&L!==f&&U(x,D,y,M,T,w,L.x,L.y)&&m(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;C&&C.z<=de;){if(C.x>=z&&C.x<=fe&&C.y>=I&&C.y<=re&&C!==c&&C!==f&&U(x,D,y,M,T,w,C.x,C.y)&&m(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function he(r,a,i){var l=r;do{var c=l.prev,u=l.next.next;!A(c,u)&&N(c,l,l.next,u)&&q(c,u)&&q(u,c)&&(a.push(c.i/i|0),a.push(l.i/i|0),a.push(u.i/i|0),ne(l),ne(l.next),l=r=u),l=l.next}while(l!==r);return g(l)}function W(r,a,i,l,c,u){var f=r;do{for(var x=f.next.next;x!==f.prev;){if(f.i!==x.i&&V(f,x)){var y=Se(f,x);return f=g(f,f.next),y=g(y,y.next),B(f,a,i,l,c,u,0),void B(y,a,i,l,c,u,0)}x=x.next}f=f.next}while(f!==r)}function X(r,a){return r.x-a.x}function K(r,a){var i=function se(r,a){var f,i=a,l=r.x,c=r.y,u=-1/0;do{if(c<=i.y&&c>=i.next.y&&i.next.y!==i.y){var x=i.x+(c-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(x<=l&&x>u&&(u=x,f=i.x<i.next.x?i:i.next,x===l))return f}i=i.next}while(i!==a);if(!f)return null;var w,y=f,T=f.x,D=f.y,M=1/0;i=f;do{l>=i.x&&i.x>=T&&l!==i.x&&U(c<D?l:u,c,T,D,c<D?u:l,c,i.x,i.y)&&(w=Math.abs(c-i.y)/(l-i.x),q(i,r)&&(w<M||w===M&&(i.x>f.x||i.x===f.x&&xe(f,i)))&&(f=i,M=w)),i=i.next}while(i!==y);return f}(r,a);if(!i)return a;var l=Se(i,r);return g(l,l.next),g(i,i.next)}function xe(r,a){return m(r.prev,r,a.prev)<0&&m(a.next,r,r.next)<0}function ae(r,a,i,l,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*c|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function _e(r){var a=r,i=r;do{(a.x<i.x||a.x===i.x&&a.y<i.y)&&(i=a),a=a.next}while(a!==r);return i}function U(r,a,i,l,c,u,f,x){return(c-f)*(a-x)>=(r-f)*(u-x)&&(r-f)*(l-x)>=(i-f)*(a-x)&&(i-f)*(u-x)>=(c-f)*(l-x)}function V(r,a){return r.next.i!==a.i&&r.prev.i!==a.i&&!function te(r,a){var i=r;do{if(i.i!==r.i&&i.next.i!==r.i&&i.i!==a.i&&i.next.i!==a.i&&N(i,i.next,r,a))return!0;i=i.next}while(i!==r);return!1}(r,a)&&(q(r,a)&&q(a,r)&&function Ae(r,a){var i=r,l=!1,c=(r.x+a.x)/2,u=(r.y+a.y)/2;do{i.y>u!=i.next.y>u&&i.next.y!==i.y&&c<(i.next.x-i.x)*(u-i.y)/(i.next.y-i.y)+i.x&&(l=!l),i=i.next}while(i!==r);return l}(r,a)&&(m(r.prev,r,a.prev)||m(r,a.prev,a))||A(r,a)&&m(r.prev,r,r.next)>0&&m(a.prev,a,a.next)>0)}function m(r,a,i){return(a.y-r.y)*(i.x-a.x)-(a.x-r.x)*(i.y-a.y)}function A(r,a){return r.x===a.x&&r.y===a.y}function N(r,a,i,l){var c=H(m(r,a,i)),u=H(m(r,a,l)),f=H(m(i,l,r)),x=H(m(i,l,a));return!!(c!==u&&f!==x||0===c&&Z(r,i,a)||0===u&&Z(r,l,a)||0===f&&Z(i,r,l)||0===x&&Z(i,a,l))}function Z(r,a,i){return a.x<=Math.max(r.x,i.x)&&a.x>=Math.min(r.x,i.x)&&a.y<=Math.max(r.y,i.y)&&a.y>=Math.min(r.y,i.y)}function H(r){return r>0?1:r<0?-1:0}function q(r,a){return m(r.prev,r,r.next)<0?m(r,a,r.next)>=0&&m(r,r.prev,a)>=0:m(r,a,r.prev)<0||m(r,r.next,a)<0}function Se(r,a){var i=new Te(r.i,r.x,r.y),l=new Te(a.i,a.x,a.y),c=r.next,u=a.prev;return r.next=a,a.prev=r,i.next=c,c.prev=i,l.next=i,i.prev=l,u.next=l,l.prev=u,l}function ue(r,a,i,l){var c=new Te(r,a,i);return l?(c.next=l.next,c.prev=l,l.next.prev=c,l.next=c):(c.prev=c,c.next=c),c}function ne(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Te(r,a,i){this.i=r,this.x=a,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ye(r,a,i,l){for(var c=0,u=a,f=i-l;u<i;u+=l)c+=(r[f]-r[u])*(r[u+1]+r[f+1]),f=u;return c}pe.exports=J,pe.exports.default=J,J.deviation=function(r,a,i,l){var c=a&&a.length,f=Math.abs(ye(r,0,c?a[0]*i:r.length,i));if(c)for(var x=0,y=a.length;x<y;x++)f-=Math.abs(ye(r,a[x]*i,x<y-1?a[x+1]*i:r.length,i));var M=0;for(x=0;x<l.length;x+=3){var w=l[x]*i,z=l[x+1]*i,I=l[x+2]*i;M+=Math.abs((r[w]-r[I])*(r[z+1]-r[w+1])-(r[w]-r[z])*(r[I+1]-r[w+1]))}return 0===f&&0===M?0:Math.abs((M-f)/f)},J.flatten=function(r){for(var a=r[0][0].length,i={vertices:[],holes:[],dimensions:a},l=0,c=0;c<r.length;c++){for(var u=0;u<r[c].length;u++)for(var f=0;f<a;f++)i.vertices.push(r[c][u][f]);c>0&&i.holes.push(l+=r[c-1].length)}return i}}}]);