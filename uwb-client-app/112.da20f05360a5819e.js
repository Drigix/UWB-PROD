"use strict";(self.webpackChunkuwb_client_app=self.webpackChunkuwb_client_app||[]).push([[112],{9061:(Di,xe,y)=>{y.d(xe,{Z:()=>Te});var c=y(9291),Ce=y(4089),ye=y(4274),Kt=y(6223),Se=y(3999);let Te=(()=>{class St{constructor(){this.disabledButtons=!1,this.emitPlayClick=new c.vpe,this.emitPauseClick=new c.vpe,this.emitPreviousClick=new c.vpe,this.emitNextClick=new c.vpe,this.emitTimeToChangePoint=new c.vpe,this.isPlay=!1,this.timeToChangePoint=2,this.minTimeToChangePoint=.1,this.maxTimeToChangePoint=5}ngOnInit(){}onPlayClick(){this.isPlay=!0,this.emitPlayClick.emit()}onPauseClick(){this.isPlay=!1,this.emitPauseClick.emit()}onPreviousClick(){this.emitPreviousClick.emit()}onNextClick(){this.emitNextClick.emit()}onTimeToChangePointChange(){null==this.timeToChangePoint&&(this.timeToChangePoint=2),this.emitTimeToChangePoint.emit(this.timeToChangePoint)}}return St.\u0275fac=function(T){return new(T||St)},St.\u0275cmp=c.Xpm({type:St,selectors:[["uwb-map-panel"]],inputs:{disabledButtons:"disabledButtons"},outputs:{emitPlayClick:"emitPlayClick",emitPauseClick:"emitPauseClick",emitPreviousClick:"emitPreviousClick",emitNextClick:"emitNextClick",emitTimeToChangePoint:"emitTimeToChangePoint"},decls:11,vars:11,consts:[[1,"map-panel","p-2"],[1,"grid","w-full","p-1"],["icon","pi pi-backward",1,"col","flex","justify-content-center",3,"disabled","onClick"],[1,"col","flex","justify-content-center",3,"icon","disabled","onClick"],["icon","pi pi-forward",1,"col","flex","justify-content-center",3,"disabled","onClick"],[1,"grid","w-full","justify-content-center","align-items-center","p-1"],["inputId","decimal",1,"mx-2",3,"ngModel","min","max","maxFractionDigits","ngModelChange","onBlur"]],template:function(T,j){1&T&&(c.TgZ(0,"div",0)(1,"div",1)(2,"p-button",2),c.NdJ("onClick",function(){return j.onPreviousClick()}),c.qZA(),c.TgZ(3,"p-button",3),c.NdJ("onClick",function(){return j.isPlay?j.onPauseClick():j.onPlayClick()}),c.qZA(),c.TgZ(4,"p-button",4),c.NdJ("onClick",function(){return j.onNextClick()}),c.qZA()(),c.TgZ(5,"div",5)(6,"label"),c._uU(7),c.ALo(8,"translate"),c.qZA(),c.TgZ(9,"p-inputNumber",6),c.NdJ("ngModelChange",function(Tt){return j.timeToChangePoint=Tt})("onBlur",function(){return j.onTimeToChangePointChange()}),c.qZA(),c._uU(10,"[s] "),c.qZA()()),2&T&&(c.xp6(2),c.Q6J("disabled",j.disabledButtons),c.xp6(1),c.Q6J("icon",j.isPlay?"pi pi-pause":"pi pi-play")("disabled",j.disabledButtons),c.xp6(1),c.Q6J("disabled",j.disabledButtons),c.xp6(3),c.hij("",c.lcZ(8,9,"localization.details.timeToChangePoint"),": "),c.xp6(2),c.Q6J("ngModel",j.timeToChangePoint)("min",j.minTimeToChangePoint)("max",j.maxTimeToChangePoint)("maxFractionDigits",1))},dependencies:[Ce.zx,ye.Rn,Kt.JJ,Kt.On,Se.X$],styles:[".map-panel[_ngcontent-%COMP%]{position:absolute;z-index:100;background-color:var(--uwb-background);border:2px solid var(--uwb-primary);border-left:none;border-top:none;border-bottom-right-radius:15px;border-top-left-radius:15px;width:25%;min-height:10vh}  .map-panel .p-button{border-radius:50%}  .map-panel input{width:30px}"]}),St})()},4112:(Di,xe,y)=>{y.d(xe,{G:()=>fs});var c=y(9291),Ce=y(6062),ye=y(1415),Kt=y(7055),Se=y(2620),Te=y(8536),St=y(3870),Jt=y(5435),T=y(4654),j=y(5930),Et=y(1470);const Tt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},zt=[Tt.FILL],gt=[Tt.STROKE],Pt=[Tt.BEGIN_PATH],Ke=[Tt.CLOSE_PATH],M=Tt;var Oi=y(5552);const Je=class Ai{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}};var _t=y(9886),w=y(748),X=y(7555),tt=y(2868);const At=class Gi extends Je{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let r=0,a=t.length;r<a;r+=e)n[0]=t[r],n[1]=t[r+1],(0,T.b8)(i,n)&&(s[o++]=n[0],s[o++]=n[1]);return o}appendFlatLineCoordinates(t,e,i,n,s,o){const r=this.coordinates;let a=r.length;const l=this.getBufferedMaxExtent();o&&(e+=n);let h=t[e],f=t[e+1];const u=this.tmpCoordinate_;let _,p,m,g=!0;for(_=e+n;_<i;_+=n)u[0]=t[_],u[1]=t[_+1],m=(0,T.pX)(l,u),m!==p?(g&&(r[a++]=h,r[a++]=f,g=!1),r[a++]=u[0],r[a++]=u[1]):m===Oi.Z.INTERSECTING?(r[a++]=u[0],r[a++]=u[1],g=!1):g=!0,h=u[0],f=u[1],p=m;return(s&&g||_===e+n)&&(r[a++]=h,r[a++]=f),a}drawCustomCoordinates_(t,e,i,n,s){for(let o=0,r=i.length;o<r;++o){const a=i[o],l=this.appendFlatLineCoordinates(t,e,a,n,!1,!1);s.push(l),e=a}return e}drawCustom(t,e,i,n){this.beginGeometry(t,e);const s=t.getType(),o=t.getStride(),r=this.coordinates.length;let a,l,h,f,u;switch(s){case"MultiPolygon":a=t.getOrientedFlatCoordinates(),f=[];const g=t.getEndss();u=0;for(let _=0,p=g.length;_<p;++_){const m=[];u=this.drawCustomCoordinates_(a,u,g[_],o,m),f.push(m)}this.instructions.push([M.CUSTOM,r,f,t,i,tt.ug]),this.hitDetectionInstructions.push([M.CUSTOM,r,f,t,n||i,tt.ug]);break;case"Polygon":case"MultiLineString":h=[],a="Polygon"==s?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(a,0,t.getEnds(),o,h),this.instructions.push([M.CUSTOM,r,h,t,i,tt.o1]),this.hitDetectionInstructions.push([M.CUSTOM,r,h,t,n||i,tt.o1]);break;case"LineString":case"Circle":a=t.getFlatCoordinates(),l=this.appendFlatLineCoordinates(a,0,a.length,o,!1,!1),this.instructions.push([M.CUSTOM,r,l,t,i,tt.Ml]),this.hitDetectionInstructions.push([M.CUSTOM,r,l,t,n||i,tt.Ml]);break;case"MultiPoint":a=t.getFlatCoordinates(),l=this.appendFlatPointCoordinates(a,o),l>r&&(this.instructions.push([M.CUSTOM,r,l,t,i,tt.Ml]),this.hitDetectionInstructions.push([M.CUSTOM,r,l,t,n||i,tt.Ml]));break;case"Point":a=t.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),l=this.coordinates.length,this.instructions.push([M.CUSTOM,r,l,t,i]),this.hitDetectionInstructions.push([M.CUSTOM,r,l,t,n||i])}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[M.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[M.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let n,s,o=-1;for(e=0;e<i;++e)n=t[e],s=n[0],s==M.END_GEOMETRY?o=e:s==M.BEGIN_GEOMETRY&&(n[2]=e,(0,X.FZ)(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const n=t.getColor();i.fillStyle=(0,_t.y)(n||w.bL)}else i.fillStyle=void 0;if(e){const n=e.getColor();i.strokeStyle=(0,_t.y)(n||w.Tx);const s=e.getLineCap();i.lineCap=void 0!==s?s:w.mb;const o=e.getLineDash();i.lineDash=o?o.slice():w.X9;const r=e.getLineDashOffset();i.lineDashOffset=r||w.He;const a=e.getLineJoin();i.lineJoin=void 0!==a?a:w.rc;const l=e.getWidth();i.lineWidth=void 0!==l?l:w.yC;const h=e.getMiterLimit();i.miterLimit=void 0!==h?h:w.V4,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[M.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[M.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;("string"!=typeof i||t.currentFillStyle!=i)&&(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,s=t.lineDash,o=t.lineDashOffset,r=t.lineJoin,a=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||s!=t.currentLineDash&&!(0,X.fS)(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=r||t.currentLineWidth!=a||t.currentMiterLimit!=l)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=r,t.currentLineWidth=a,t.currentMiterLimit=l)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[M.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){return!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(0,T.d9)(this.maxExtent),this.maxLineWidth>0)&&(0,T.f3)(this.bufferedMaxExtent_,this.resolution*(this.maxLineWidth+1)/2,this.bufferedMaxExtent_),this.bufferedMaxExtent_}};var qt=y(4340);const ze=class Yi extends At{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const s=this.state,o=void 0!==s.fillStyle,r=void 0!==s.strokeStyle,a=i.length;this.instructions.push(Pt),this.hitDetectionInstructions.push(Pt);for(let l=0;l<a;++l){const h=i[l],f=this.coordinates.length,u=this.appendFlatLineCoordinates(t,e,h,n,!0,!r),g=[M.MOVE_TO_LINE_TO,f,u];this.instructions.push(g),this.hitDetectionInstructions.push(g),r&&(this.instructions.push(Ke),this.hitDetectionInstructions.push(Ke)),e=h}return o&&(this.instructions.push(zt),this.hitDetectionInstructions.push(zt)),r&&(this.instructions.push(gt),this.hitDetectionInstructions.push(gt)),e}drawCircle(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([M.SET_FILL_STYLE,w.bL]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([M.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getFlatCoordinates(),r=t.getStride(),a=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,r,!1,!1);const l=[M.CIRCLE,a];this.instructions.push(Pt,l),this.hitDetectionInstructions.push(Pt,l),void 0!==i.fillStyle&&(this.instructions.push(zt),this.hitDetectionInstructions.push(zt)),void 0!==i.strokeStyle&&(this.instructions.push(gt),this.hitDetectionInstructions.push(gt)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([M.SET_FILL_STYLE,w.bL]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([M.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEnds(),r=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(r,0,o,a),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([M.SET_FILL_STYLE,w.bL]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([M.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEndss(),r=t.getOrientedFlatCoordinates(),a=t.getStride();let l=0;for(let h=0,f=o.length;h<f;++h)l=this.drawFlatCoordinatess_(r,l,o[h],a);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=(0,qt.uZ)(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};var J=y(9070),V=y(3469);function Vi(d,t,e,i,n){const s=[];let o=e,r=0,a=t.slice(e,2);for(;r<d&&o+n<i;){const[l,h]=a.slice(-2),f=t[o+n],u=t[o+n+1],g=Math.sqrt((f-l)*(f-l)+(u-h)*(u-h));if(r+=g,r>=d){const _=(d-r+g)/g,p=(0,V.t7)(l,f,_),m=(0,V.t7)(h,u,_);a.push(p,m),s.push(a),a=[p,m],r==d&&(o+=n),r=0}else if(r<d)a.push(t[o+n],t[o+n+1]),o+=n;else{const _=g-r,p=(0,V.t7)(l,f,_/g),m=(0,V.t7)(h,u,_/g);a.push(p,m),s.push(a),a=[p,m],r=0,o+=n}}return r>0&&s.push(a),s}function ji(d,t,e,i,n){let h,f,u,g,_,p,m,x,C,P,s=e,o=e,r=0,a=0,l=e;for(f=e;f<i;f+=n){const E=t[f],v=t[f+1];void 0!==_&&(C=E-_,P=v-p,g=Math.sqrt(C*C+P*P),void 0!==m&&(a+=u,h=Math.acos((m*C+x*P)/(u*g)),h>d&&(a>r&&(r=a,s=l,o=f),a=0,l=f-n)),u=g,m=C,x=P),_=E,p=v}return a+=g,a>r?[l,f]:[s,o]}const Gt={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Xi={Circle:ze,Default:At,Image:class Bi extends At{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([M.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([M.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([M.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([M.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class Ni extends At{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),r=[M.MOVE_TO_LINE_TO,s,o];return this.instructions.push(r),this.hitDetectionInstructions.push(r),i}drawLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([M.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,w.X9,w.He],Pt);const o=t.getFlatCoordinates(),r=t.getStride();this.drawFlatCoordinates_(o,0,o.length,r),this.hitDetectionInstructions.push(gt),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([M.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Pt);const o=t.getEnds(),r=t.getFlatCoordinates(),a=t.getStride();let l=0;for(let h=0,f=o.length;h<f;++h)l=this.drawFlatCoordinates_(r,l,o[h],a);this.hitDetectionInstructions.push(gt),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(gt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(gt),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Pt)}},Polygon:ze,Text:class Ui extends At{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const s=this.textState_;if(""===this.text_||!s||!this.textFillState_&&!this.textStrokeState_)return;const o=this.coordinates;let r=o.length;const a=t.getType();let l=null,h=t.getStride();if("line"!==s.placement||"LineString"!=a&&"MultiLineString"!=a&&"Polygon"!=a&&"MultiPolygon"!=a){let f=s.overflow?null:[];switch(a){case"Point":case"MultiPoint":l=t.getFlatCoordinates();break;case"LineString":l=t.getFlatMidpoint();break;case"Circle":l=t.getCenter();break;case"MultiLineString":l=t.getFlatMidpoints(),h=2;break;case"Polygon":l=t.getFlatInteriorPoint(),s.overflow||f.push(l[2]/this.resolution),h=3;break;case"MultiPolygon":const m=t.getFlatInteriorPoints();l=[];for(let x=0,C=m.length;x<C;x+=3)s.overflow||f.push(m[x+2]/this.resolution),l.push(m[x],m[x+1]);if(0===l.length)return;h=2}const u=this.appendFlatPointCoordinates(l,h);if(u===r)return;if(f&&(u-r)/2!=l.length/h){let m=r/2;f=f.filter((x,C)=>{const P=o[2*(m+C)]===l[C*h]&&o[2*(m+C)+1]===l[C*h+1];return P||--m,P})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let g=s.padding;if(g!=w.oB&&(s.scale[0]<0||s.scale[1]<0)){let m=s.padding[0],x=s.padding[1],C=s.padding[2],P=s.padding[3];s.scale[0]<0&&(x=-x,P=-P),s.scale[1]<0&&(m=-m,C=-C),g=[m,x,C,P]}const _=this.pixelRatio;this.instructions.push([M.DRAW_IMAGE,r,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,g==w.oB?w.oB:g.map(function(m){return m*_}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);const p=1/_;this.hitDetectionInstructions.push([M.DRAW_IMAGE,r,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,void 0,this.declutterImageWithText_,g,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),this.endGeometry(e)}else{if(!(0,T.kK)(this.getBufferedMaxExtent(),t.getExtent()))return;let f;if(l=t.getFlatCoordinates(),"LineString"==a)f=[l.length];else if("MultiLineString"==a)f=t.getEnds();else if("Polygon"==a)f=t.getEnds().slice(0,1);else if("MultiPolygon"==a){const p=t.getEndss();f=[];for(let m=0,x=p.length;m<x;++m)f.push(p[m][0])}this.beginGeometry(t,e);const u=s.repeat,g=u?void 0:s.textAlign;let _=0;for(let p=0,m=f.length;p<m;++p){let x;x=u?Vi(u*this.resolution,l,_,f[p],h):[l.slice(_,f[p])];for(let C=0,P=x.length;C<P;++C){const E=x[C];let v=0,b=E.length;if(null==g){const L=ji(s.maxAngle,E,0,E.length,2);v=L[0],b=L[1]}for(let L=v;L<b;L+=h)o.push(E[L],E[L+1]);const R=o.length;_=f[p],this.drawChars_(r,R),r=R}}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||w.PH,justify:e.justify,textBaseline:e.textBaseline||w.ru,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,o=this.textKey_,r=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,l=Gt[n.textBaseline],h=this.textOffsetY_*a,f=this.text_,u=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([M.DRAW_CHARS,t,e,l,n.overflow,r,n.maxAngle,a,h,s,u*a,f,o,1]),this.hitDetectionInstructions.push([M.DRAW_CHARS,t,e,l,n.overflow,r,n.maxAngle,1,h,s,u,f,o,1/a])}setTextStyle(t,e){let i,n,s;if(t){const o=t.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=(0,_t.y)(o.getColor()||w.bL)):(n=null,this.textFillState_=n);const r=t.getStroke();if(r){s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const _=r.getLineDash(),p=r.getLineDashOffset(),m=r.getWidth(),x=r.getMiterLimit();s.lineCap=r.getLineCap()||w.mb,s.lineDash=_?_.slice():w.X9,s.lineDashOffset=void 0===p?w.He:p,s.lineJoin=r.getLineJoin()||w.rc,s.lineWidth=void 0===m?w.yC:m,s.miterLimit=void 0===x?w.V4:x,s.strokeStyle=(0,_t.y)(r.getColor()||w.Tx)}else s=null,this.textStrokeState_=s;i=this.textState_;const a=t.getFont()||w.Df;(0,w.Qx)(a);const l=t.getScaleArray();i.overflow=t.getOverflow(),i.font=a,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||w.ru,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||w.oB,i.scale=void 0===l?[1,1]:l;const h=t.getOffsetX(),f=t.getOffsetY(),u=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===h?0:h,this.textOffsetY_=void 0===f?0:f,this.textRotateWithView_=void 0!==u&&u,this.textRotation_=void 0===g?0:g,this.strokeKey_=s?("string"==typeof s.strokeStyle?s.strokeStyle:(0,J.sq)(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+(0,J.sq)(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=e}}},qe=class Hi{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const s=i[n].finish();t[e][n]=s}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let n=this.buildersByZIndex_[i];void 0===n&&(n={},this.buildersByZIndex_[i]=n);let s=n[e];return void 0===s&&(s=new(0,Xi[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s),s}};var Pe=y(5060),H=y(9664),wt=y(7714);function Ki(d,t,e,i,n,s,o,r,a,l,h,f){let u=d[t],g=d[t+1],_=0,p=0,m=0,x=0;function C(){_=u,p=g,u=d[t+=i],g=d[t+1],x+=m,m=Math.sqrt((u-_)*(u-_)+(g-p)*(g-p))}do{C()}while(t<e-i&&x+m<s);let P=0===m?0:(s-x)/m;const E=(0,V.t7)(_,u,P),v=(0,V.t7)(p,g,P),b=t-i,R=x,L=s+r*a(l,n,h);for(;t<e-i&&x+m<L;)C();P=0===m?0:(L-x)/m;const O=(0,V.t7)(_,u,P),G=(0,V.t7)(p,g,P);let Y;if(f){const I=[E,v,O,G];(0,wt.U1)(I,0,4,2,f,I,I),Y=I[0]>I[2]}else Y=E>O;const Z=Math.PI,A=[],q=b+i===t;let B;if(m=0,x=R,u=d[t=b],g=d[t+1],q)return C(),B=Math.atan2(g-p,u-_),Y&&(B+=B>0?-Z:Z),A[0]=[(O+E)/2,(G+v)/2,(L-s)/2,B,n],A;for(let I=0,D=(n=n.replace(/\n/g," ")).length;I<D;){C();let k=Math.atan2(g-p,u-_);if(Y&&(k+=k>0?-Z:Z),void 0!==B){let lt=k-B;if(lt+=lt>Z?-2*Z:lt<-Z?2*Z:0,Math.abs(lt)>o)return null}B=k;const W=I;let U=0;for(;I<D;++I){const Dt=r*a(l,n[Y?D-I-1:I],h);if(t+i<e&&x+m<s+U+Dt/2)break;U+=Dt}if(I===W)continue;const at=Y?n.substring(D-W,D-I):n.substring(W,I);P=0===m?0:(s+U/2-x)/m;const S=(0,V.t7)(_,u,P),yi=(0,V.t7)(p,g,P);A.push([S,yi,U/2,k,at]),s+=U}return A}function we(d,t,e,i){let n=d[t],s=d[t+1],o=0;for(let r=t+i;r<e;r+=i){const a=d[r],l=d[r+1];o+=Math.sqrt((a-n)*(a-n)+(l-s)*(l-s)),n=a,s=l}return o}const Mt=(0,T.lJ)(),pt=[],ht=[],ct=[],mt=[];function Qe(d){return d[3].declutterBox}const Ji=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function $e(d,t){return("start"===t||"end"===t)&&!Ji.test(d)&&(t="start"===t?"left":"right"),Gt[t]}function zi(d,t,e){return e>0&&d.push("\n",""),d.push(t,""),d}const Qi=class qi{constructor(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=(0,H.Ue)(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,n){const s=t+e+i+n;if(this.labels_[s])return this.labels_[s];const o=n?this.strokeStates[n]:null,r=i?this.fillStates[i]:null,a=this.textStates[e],l=this.pixelRatio,h=[a.scale[0]*l,a.scale[1]*l],f=Array.isArray(t),u=a.justify?Gt[a.justify]:$e(Array.isArray(t)?t[0]:t,a.textAlign||w.PH),g=n&&o.lineWidth?o.lineWidth:0,_=f?t:t.split("\n").reduce(zi,[]),{width:p,height:m,widths:x,heights:C,lineWidths:P}=(0,w.Zw)(a,_),E=p+g,v=[],b=(E+2)*h[0],R=(m+g)*h[1],L={width:b<0?Math.floor(b):Math.ceil(b),height:R<0?Math.floor(R):Math.ceil(R),contextInstructions:v};(1!=h[0]||1!=h[1])&&v.push("scale",h),n&&(v.push("strokeStyle",o.strokeStyle),v.push("lineWidth",g),v.push("lineCap",o.lineCap),v.push("lineJoin",o.lineJoin),v.push("miterLimit",o.miterLimit),v.push("setLineDash",[o.lineDash]),v.push("lineDashOffset",o.lineDashOffset)),i&&v.push("fillStyle",r.fillStyle),v.push("textBaseline","middle"),v.push("textAlign","center");const O=.5-u;let G=u*E+O*g;const Y=[],Z=[];let D,A=0,q=0,B=0,I=0;for(let k=0,W=_.length;k<W;k+=2){const U=_[k];if("\n"===U){q+=A,A=0,G=u*E+O*g,++I;continue}const at=_[k+1]||a.font;at!==D&&(n&&Y.push("font",at),i&&Z.push("font",at),D=at),A=Math.max(A,C[B]);const S=[U,G+O*x[B]+u*(x[B]-P[I]),.5*(g+A)+q];G+=x[B],n&&Y.push("strokeText",S),i&&Z.push("fillText",S),++B}return Array.prototype.push.apply(v,Y),Array.prototype.push.apply(v,Z),this.labels_[s]=L,L}replayTextBackground_(t,e,i,n,s,o,r){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),r&&(this.setStrokeStyle_(t,r),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,s,o,r,a,l,h,f,u,g,_,p,m){let x=i-(r*=u[0]),C=n-(a*=u[1]);const P=s+l>t?t-l:s,E=o+h>e?e-h:o,v=_[3]+P*u[0]+_[1],b=_[0]+E*u[1]+_[2],R=x-_[3],L=C-_[0];let O;return(p||0!==f)&&(pt[0]=R,mt[0]=R,pt[1]=L,ht[1]=L,ht[0]=R+v,ct[0]=ht[0],ct[1]=L+b,mt[1]=ct[1]),0!==f?(O=(0,H.qC)((0,H.Ue)(),i,n,1,1,f,-i,-n),(0,H.nn)(O,pt),(0,H.nn)(O,ht),(0,H.nn)(O,ct),(0,H.nn)(O,mt),(0,T.T9)(Math.min(pt[0],ht[0],ct[0],mt[0]),Math.min(pt[1],ht[1],ct[1],mt[1]),Math.max(pt[0],ht[0],ct[0],mt[0]),Math.max(pt[1],ht[1],ct[1],mt[1]),Mt)):(0,T.T9)(Math.min(R,R+v),Math.min(L,L+b),Math.max(R,R+v),Math.max(L,L+b),Mt),g&&(x=Math.round(x),C=Math.round(C)),{drawImageX:x,drawImageY:C,drawImageW:P,drawImageH:E,originX:l,originY:h,declutterBox:{minX:Mt[0],minY:Mt[1],maxX:Mt[2],maxY:Mt[3],value:m},canvasTransform:O,scale:u}}replayImageOrLabel_(t,e,i,n,s,o,r){const l=n.declutterBox,h=t.canvas,f=r?r[2]*n.scale[0]/2:0;return l.minX-f<=h.width/e&&l.maxX+f>=0&&l.minY-f<=h.height/e&&l.maxY+f>=0&&(!(!o&&!r)&&this.replayTextBackground_(t,pt,ht,ct,mt,o,r),(0,w._f)(t,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){if(this.alignFill_){const e=(0,H.nn)(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const s=this.textStates[e],o=this.createLabel(t,e,n,i),r=this.strokeStates[i],a=this.pixelRatio,l=$e(Array.isArray(t)?t[0]:t,s.textAlign||w.PH),h=Gt[s.textBaseline||w.ru],f=r&&r.lineWidth?r.lineWidth:0;return{label:o,anchorX:l*(o.width/a-2*s.scale[0])+2*(.5-l)*f,anchorY:h*o.height/a+2*(.5-h)*f}}execute_(t,e,i,n,s,o,r,a){let l;this.pixelCoordinates_&&(0,X.fS)(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=(0,wt.vT)(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),(0,H.lk)(this.renderedTransform_,i));let h=0;const f=n.length;let g,_,p,m,x,C,P,E,v,b,R,L,u=0,O=0,G=0,Y=null,Z=null;const A=this.coordinateCache_,q=this.viewRotation_,B=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,I={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:q},D=this.instructions!=n||this.overlaps?0:200;let k,W,U,at;for(;h<f;){const S=n[h];switch(S[0]){case M.BEGIN_GEOMETRY:k=S[1],at=S[3],k.getGeometry()?void 0===r||(0,T.kK)(r,at.getExtent())?++h:h=S[2]+1:h=S[2];break;case M.BEGIN_PATH:O>D&&(this.fill_(t),O=0),G>D&&(t.stroke(),G=0),!O&&!G&&(t.beginPath(),m=NaN,x=NaN),++h;break;case M.CIRCLE:u=S[1];const lt=l[u],Dt=l[u+1],Si=l[u+2]-lt,Ti=l[u+3]-Dt,Pi=Math.sqrt(Si*Si+Ti*Ti);t.moveTo(lt+Pi,Dt),t.arc(lt,Dt,Pi,0,2*Math.PI,!0),++h;break;case M.CLOSE_PATH:t.closePath(),++h;break;case M.CUSTOM:u=S[1],g=S[2];const ms=S[4],wi=6==S.length?S[5]:void 0;I.geometry=S[3],I.feature=k,h in A||(A[h]=[]);const Vt=A[h];wi?wi(l,u,g,2,Vt):(Vt[0]=l[u],Vt[1]=l[u+1],Vt.length=2),ms(Vt,I),++h;break;case M.DRAW_IMAGE:u=S[1],g=S[2],E=S[3],_=S[4],p=S[5];let We=S[6];const xs=S[7],Cs=S[8],ys=S[9],vi=S[10];let Ye=S[11];const Ss=S[12];let fe=S[13];const Ei=S[14],jt=S[15];if(!E&&S.length>=20){v=S[19],b=S[20],R=S[21],L=S[22];const Q=this.drawLabelWithPointPlacement_(v,b,R,L);E=Q.label,S[3]=E,_=(Q.anchorX-S[23])*this.pixelRatio,S[4]=_,p=(Q.anchorY-S[24])*this.pixelRatio,S[5]=p,We=E.height,S[6]=We,fe=E.width,S[13]=fe}let Ve,je,ge,_e;S.length>25&&(Ve=S[25]),S.length>17?(je=S[16],ge=S[17],_e=S[18]):(je=w.oB,ge=!1,_e=!1),vi&&B?Ye+=q:!vi&&!B&&(Ye-=q);let Ts=0;for(;u<g;u+=2){if(Ve&&Ve[Ts++]<fe/this.pixelRatio)continue;const Q=this.calculateImageOrLabelDimensions_(E.width,E.height,l[u],l[u+1],fe,We,_,p,Cs,ys,Ye,Ss,s,je,ge||_e,k),Ot=[t,e,E,Q,xs,ge?Y:null,_e?Z:null];if(a){if("none"===Ei)continue;if("obstacle"===Ei){a.insert(Q.declutterBox);continue}{let nt,ut;if(jt){const $=g-u;if(!jt[$]){jt[$]=Ot;continue}if(nt=jt[$],delete jt[$],ut=Qe(nt),a.collides(ut))continue}if(a.collides(Q.declutterBox))continue;nt&&(a.insert(ut),this.replayImageOrLabel_.apply(this,nt)),a.insert(Q.declutterBox)}}this.replayImageOrLabel_.apply(this,Ot)}++h;break;case M.DRAW_CHARS:const Mi=S[1],Ii=S[2],Ue=S[3],Ps=S[4];L=S[5];const ws=S[6],ki=S[7],bi=S[8];R=S[9];const Xe=S[10];v=S[11],b=S[12];const Li=[S[13],S[13]],He=this.textStates[b],Ut=He.font,Xt=[He.scale[0]*ki,He.scale[1]*ki];let Ht;Ut in this.widths_?Ht=this.widths_[Ut]:(Ht={},this.widths_[Ut]=Ht);const Fi=we(l,Mi,Ii,2),Ri=Math.abs(Xt[0])*(0,w.Kd)(Ut,v,Ht);if(Ps||Ri<=Fi){const nt=Ki(l,Mi,Ii,2,v,(Fi-Ri)*Gt[this.textStates[b].textAlign],ws,Math.abs(Xt[0]),w.Kd,Ut,Ht,B?0:this.viewRotation_);t:if(nt){const ut=[];let $,pe,me,z,st;if(R)for($=0,pe=nt.length;$<pe;++$){st=nt[$],me=st[4],z=this.createLabel(me,b,"",R),_=st[2]+(Xt[0]<0?-Xe:Xe),p=Ue*z.height+2*(.5-Ue)*Xe*Xt[1]/Xt[0]-bi;const ft=this.calculateImageOrLabelDimensions_(z.width,z.height,st[0],st[1],z.width,z.height,_,p,0,0,st[3],Li,!1,w.oB,!1,k);if(a&&a.collides(ft.declutterBox))break t;ut.push([t,e,z,ft,1,null,null])}if(L)for($=0,pe=nt.length;$<pe;++$){st=nt[$],me=st[4],z=this.createLabel(me,b,L,""),_=st[2],p=Ue*z.height-bi;const ft=this.calculateImageOrLabelDimensions_(z.width,z.height,st[0],st[1],z.width,z.height,_,p,0,0,st[3],Li,!1,w.oB,!1,k);if(a&&a.collides(ft.declutterBox))break t;ut.push([t,e,z,ft,1,null,null])}a&&a.load(ut.map(Qe));for(let ft=0,vs=ut.length;ft<vs;++ft)this.replayImageOrLabel_.apply(this,ut[ft])}}++h;break;case M.END_GEOMETRY:if(void 0!==o){k=S[1];const Q=o(k,at);if(Q)return Q}++h;break;case M.FILL:D?O++:this.fill_(t),++h;break;case M.MOVE_TO_LINE_TO:for(u=S[1],g=S[2],W=l[u],U=l[u+1],C=W+.5|0,P=U+.5|0,(C!==m||P!==x)&&(t.moveTo(W,U),m=C,x=P),u+=2;u<g;u+=2)W=l[u],U=l[u+1],C=W+.5|0,P=U+.5|0,(u==g-2||C!==m||P!==x)&&(t.lineTo(W,U),m=C,x=P);++h;break;case M.SET_FILL_STYLE:Y=S,this.alignFill_=S[2],O&&(this.fill_(t),O=0,G&&(t.stroke(),G=0)),t.fillStyle=S[1],++h;break;case M.SET_STROKE_STYLE:Z=S,G&&(t.stroke(),G=0),this.setStrokeStyle_(t,S),++h;break;case M.STROKE:D?G++:t.stroke(),++h;break;default:++h}}O&&this.fill_(t),G&&t.stroke()}execute(t,e,i,n,s,o){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,s,void 0,void 0,o)}executeHitDetection(t,e,i,n,s){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,s)}};var dt=y(7120),$i=y(925);const ve=["Polygon","Circle","LineString","Image","Text","Default"],Ee={},ti=class tn{constructor(t,e,i,n,s,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=(0,H.Ue)(),this.createExecutors_(s)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];void 0===i&&(i={},this.executorsByZIndex_[e]=i);const n=t[e];for(const s in n)i[s]=new Qi(this.resolution_,this.pixelRatio_,this.overlaps_,n[s])}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let n=0,s=t.length;n<s;++n)if(t[n]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,s,o){const r=2*(n=Math.round(n))+1,a=(0,H.qC)(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=(0,dt.E4)(r,r,void 0,{willReadFrequently:!0}));const h=this.hitDetectionContext_;let f;h.canvas.width!==r||h.canvas.height!==r?(h.canvas.width=r,h.canvas.height=r):l||h.clearRect(0,0,r,r),void 0!==this.renderBuffer_&&(f=(0,T.lJ)(),(0,T.Wj)(f,t),(0,T.f3)(f,e*(this.renderBuffer_+n),f));const u=function en(d){if(void 0!==Ee[d])return Ee[d];const t=2*d+1,e=d*d,i=new Array(e+1);for(let s=0;s<=d;++s)for(let o=0;o<=d;++o){const r=s*s+o*o;if(r>e)break;let a=i[r];a||(a=[],i[r]=a),a.push(4*((d+s)*t+(d+o))+3),s>0&&a.push(4*((d-s)*t+(d+o))+3),o>0&&(a.push(4*((d+s)*t+(d-o))+3),s>0&&a.push(4*((d-s)*t+(d-o))+3))}const n=[];for(let s=0,o=i.length;s<o;++s)i[s]&&n.push(...i[s]);return Ee[d]=n,n}(n);let g;function _(v,b){const R=h.getImageData(0,0,r,r).data;for(let L=0,O=u.length;L<O;L++)if(R[u[L]]>0){if(!o||"Image"!==g&&"Text"!==g||o.includes(v)){const G=(u[L]-3)/4,Y=n-G%r,Z=n-(G/r|0),A=s(v,b,Y*Y+Z*Z);if(A)return A}h.clearRect(0,0,r,r);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);let m,x,C,P,E;for(p.sort(X.j2),m=p.length-1;m>=0;--m){const v=p[m].toString();for(C=this.executorsByZIndex_[v],x=ve.length-1;x>=0;--x)if(g=ve[x],P=C[g],void 0!==P&&(E=P.executeHitDetection(h,a,i,_,f),E))return E}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],s=e[2],o=e[3],r=[i,n,i,o,s,o,s,n];return(0,wt.vT)(r,0,8,2,t,r),r}isEmpty(){return(0,$i.x)(this.executorsByZIndex_)}execute(t,e,i,n,s,o,r){const a=Object.keys(this.executorsByZIndex_).map(Number);let l,h,f,u,g,_;for(a.sort(X.j2),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||ve,r&&a.reverse(),l=0,h=a.length;l<h;++l){const p=a[l].toString();for(g=this.executorsByZIndex_[p],f=0,u=o.length;f<u;++f)_=g[o[f]],void 0!==_&&_.execute(t,e,i,n,s,r)}this.maxExtent_&&t.restore()}};var Qt=y(5329),xt=y(3806);const sn=class nn extends Je{constructor(t,e,i,n,s,o,r){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.transformRotation_=n?(0,V.FH)(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=r,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=(0,H.Ue)()}drawImages_(t,e,i,n){if(!this.image_)return;const s=(0,wt.vT)(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,r=this.tmpLocalTransform_,a=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=a*this.imageOpacity_);let l=this.imageRotation_;0===this.transformRotation_&&(l-=this.viewRotation_),this.imageRotateWithView_&&(l+=this.viewRotation_);for(let h=0,f=s.length;h<f;h+=2){const u=s[h]-this.imageAnchorX_,g=s[h+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const _=u+this.imageAnchorX_,p=g+this.imageAnchorY_;(0,H.qC)(r,_,p,1,1,l,-_,-p),o.setTransform.apply(o,r),o.translate(_,p),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,g,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=a)}drawText_(t,e,i,n){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=(0,wt.vT)(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let r=this.textRotation_;for(0===this.transformRotation_&&(r-=this.viewRotation_),this.textRotateWithView_&&(r+=this.viewRotation_);e<i;e+=n){const a=s[e]+this.textOffsetX_,l=s[e+1]+this.textOffsetY_;0!==r||1!=this.textScale_[0]||1!=this.textScale_[1]?(o.translate(a-this.textOffsetX_,l-this.textOffsetY_),o.rotate(r),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,a,l),this.textFillState_&&o.fillText(this.text_,a,l))}}moveToLineTo_(t,e,i,n,s){const o=this.context_,r=(0,wt.vT)(t,e,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(r[0],r[1]);let a=r.length;s&&(a-=2);for(let l=2;l<a;l+=2)o.lineTo(r[l],r[l+1]);return s&&o.closePath(),i}drawRings_(t,e,i,n){for(let s=0,o=i.length;s<o;++s)e=this.moveToLineTo_(t,e,i[s],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,T.kK)(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=(0,xt.Kr)(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],s=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,T.kK)(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if((0,T.kK)(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();let s=0;const o=t.getEnds(),r=t.getStride();i.beginPath();for(let a=0,l=o.length;a<l;++a)s=this.moveToLineTo_(n,s,o[a],r,!1);i.stroke()}if(""!==this.text_){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,T.kK)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,T.kK)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let r=0,a=s.length;r<a;++r)n=this.drawRings_(i,n,s[r],o);this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),(0,X.fS)(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:w.PH;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const i=t.getColor();this.fillState_={fillStyle:(0,_t.y)(i||w.bL)}}else this.fillState_=null;if(e){const i=e.getColor(),n=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),r=e.getLineJoin(),a=e.getWidth(),l=e.getMiterLimit(),h=s||w.X9;this.strokeState_={lineCap:void 0!==n?n:w.mb,lineDash:1===this.pixelRatio_?h:h.map(f=>f*this.pixelRatio_),lineDashOffset:(o||w.He)*this.pixelRatio_,lineJoin:void 0!==r?r:w.rc,lineWidth:(void 0!==a?a:w.yC)*this.pixelRatio_,miterLimit:void 0!==l?l:w.V4,strokeStyle:(0,_t.y)(i||w.Tx)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const g=e.getColor();this.textFillState_={fillStyle:(0,_t.y)(g||w.bL)}}else this.textFillState_=null;const i=t.getStroke();if(i){const g=i.getColor(),_=i.getLineCap(),p=i.getLineDash(),m=i.getLineDashOffset(),x=i.getLineJoin(),C=i.getWidth(),P=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==_?_:w.mb,lineDash:p||w.X9,lineDashOffset:m||w.He,lineJoin:void 0!==x?x:w.rc,lineWidth:void 0!==C?C:w.yC,miterLimit:void 0!==P?P:w.V4,strokeStyle:(0,_t.y)(g||w.Tx)}}else this.textStrokeState_=null;const n=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),r=t.getRotateWithView(),a=t.getRotation(),l=t.getScaleArray(),h=t.getText(),f=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:void 0!==n?n:w.Df,textAlign:void 0!==f?f:w.PH,textBaseline:void 0!==u?u:w.ru},this.text_=void 0!==h?Array.isArray(h)?h.reduce((g,_,p)=>g+(p%2?" ":_),""):h:"",this.textOffsetX_=void 0!==s?this.pixelRatio_*s:0,this.textOffsetY_=void 0!==o?this.pixelRatio_*o:0,this.textRotateWithView_=void 0!==r&&r,this.textRotation_=void 0!==a?a:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=""}};var on=y(3822);const ot=.5;var Bt=y(1084);const ei={Point:function mn(d,t,e,i,n){const s=e.getImage(),o=e.getText();let r;if(s){if(s.getImageState()!=Bt.Z.LOADED)return;let a=d;if(n){const h=s.getDeclutterMode();if("none"!==h)if(a=n,"obstacle"===h){const f=d.getBuilder(e.getZIndex(),"Image");f.setImageStyle(s,r),f.drawPoint(t,i)}else o&&o.getText()&&(r={})}const l=a.getBuilder(e.getZIndex(),"Image");l.setImageStyle(s,r),l.drawPoint(t,i)}if(o&&o.getText()){let a=d;n&&(a=n);const l=a.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o,r),l.drawText(t,i)}},LineString:function gn(d,t,e,i,n){const s=e.getStroke();if(s){const r=d.getBuilder(e.getZIndex(),"LineString");r.setFillStrokeStyle(null,s),r.drawLineString(t,i)}const o=e.getText();if(o&&o.getText()){const r=(n||d).getBuilder(e.getZIndex(),"Text");r.setTextStyle(o),r.drawText(t,i)}},Polygon:function Cn(d,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(s||o){const a=d.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(s,o),a.drawPolygon(t,i)}const r=e.getText();if(r&&r.getText()){const a=(n||d).getBuilder(e.getZIndex(),"Text");a.setTextStyle(r),a.drawText(t,i)}},MultiPoint:function xn(d,t,e,i,n){const s=e.getImage(),o=e.getText();let r;if(s){if(s.getImageState()!=Bt.Z.LOADED)return;let a=d;if(n){const h=s.getDeclutterMode();if("none"!==h)if(a=n,"obstacle"===h){const f=d.getBuilder(e.getZIndex(),"Image");f.setImageStyle(s,r),f.drawMultiPoint(t,i)}else o&&o.getText()&&(r={})}const l=a.getBuilder(e.getZIndex(),"Image");l.setImageStyle(s,r),l.drawMultiPoint(t,i)}if(o&&o.getText()){let a=d;n&&(a=n);const l=a.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o,r),l.drawText(t,i)}},MultiLineString:function _n(d,t,e,i,n){const s=e.getStroke();if(s){const r=d.getBuilder(e.getZIndex(),"LineString");r.setFillStrokeStyle(null,s),r.drawMultiLineString(t,i)}const o=e.getText();if(o&&o.getText()){const r=(n||d).getBuilder(e.getZIndex(),"Text");r.setTextStyle(o),r.drawText(t,i)}},MultiPolygon:function pn(d,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(o||s){const a=d.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(s,o),a.drawMultiPolygon(t,i)}const r=e.getText();if(r&&r.getText()){const a=(n||d).getBuilder(e.getZIndex(),"Text");a.setTextStyle(r),a.drawText(t,i)}},GeometryCollection:function fn(d,t,e,i,n){const s=t.getGeometriesArray();let o,r;for(o=0,r=s.length;o<r;++o)(0,ei[s[o].getType()])(d,s[o],e,i,n)},Circle:function dn(d,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(s||o){const a=d.getBuilder(e.getZIndex(),"Circle");a.setFillStrokeStyle(s,o),a.drawCircle(t,i)}const r=e.getText();if(r&&r.getText()){const a=(n||d).getBuilder(e.getZIndex(),"Text");a.setTextStyle(r),a.drawText(t,i)}}};function hn(d,t){return parseInt((0,J.sq)(d),10)-parseInt((0,J.sq)(t),10)}function Me(d,t){return.5*d/t}function ii(d,t,e,i,n,s,o){let r=!1;const a=e.getImage();if(a){const l=a.getImageState();l==Bt.Z.LOADED||l==Bt.Z.ERROR?a.unlistenImageChange(n):(l==Bt.Z.IDLE&&a.load(),a.listenImageChange(n),r=!0)}return function un(d,t,e,i,n,s){const o=e.getGeometryFunction()(t);if(!o)return;const r=o.simplifyTransformed(i,n);e.getRenderer()?ni(d,r,e,t):(0,ei[r.getType()])(d,r,e,t,s)}(d,t,e,i,s,o),r}function ni(d,t,e,i){if("GeometryCollection"!=t.getType())d.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer());else{const s=t.getGeometries();for(let o=0,r=s.length;o<r;++o)ni(d,s[o],e,i)}}var F=y(5111),N=y(722);const Sn=class yn extends Pe.Z{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,T.lJ)(),this.wrappedRenderedExtent_=(0,T.lJ)(),this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,s=e.viewState,o=s.center,r=s.resolution,a=s.projection,l=s.rotation,h=a.getExtent(),f=this.getLayer().getSource(),u=e.pixelRatio,g=e.viewHints,_=!(g[Qt.Z.ANIMATING]||g[Qt.Z.INTERACTING]),p=this.compositionContext_,m=Math.round(e.size[0]*u),x=Math.round(e.size[1]*u),C=f.getWrapX()&&a.canWrapX(),P=C?(0,T.dz)(h):null,E=C?Math.ceil((n[2]-h[2])/P)+1:1;let v=C?Math.floor((n[0]-h[0])/P):0;do{const b=this.getRenderTransform(o,r,l,u,m,x,v*P);t.execute(p,1,b,l,_,void 0,i)}while(++v<E)}setupCompositionContext_(){if(1!==this.opacity_){const t=(0,dt.E4)(this.context.canvas.width,this.context.canvas.height,Pe.r);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,(0,dt.jy)(this.compositionContext_),Pe.r.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];(0,H.n3)(this.pixelTransform,1/i,1/i),(0,H.nb)(this.inversePixelTransform,this.pixelTransform);const s=(0,H.BB)(this.pixelTransform);this.useContainer(e,s,this.getBackground(t));const o=this.context,r=o.canvas,a=this.replayGroup_,l=this.declutterExecutorGroup;if((!a||a.isEmpty())&&(!l||l.isEmpty()))return null;const h=Math.round(t.size[0]*i),f=Math.round(t.size[1]*i);r.width!=h||r.height!=f?(r.width=h,r.height=f,r.style.transform!==s&&(r.style.transform=s)):this.containerReused||o.clearRect(0,0,h,f),this.preRender(o,t);const u=t.viewState,g=u.projection;this.opacity_=n.opacity,this.setupCompositionContext_();let _=!1,p=!0;if(n.extent&&this.clipping){const m=(0,F.dY)(n.extent,g);p=(0,T.kK)(m,t.extent),_=p&&!(0,T.r4)(m,t.extent),_&&this.clipUnrotated(this.compositionContext_,t,m)}return p&&this.renderWorlds(a,t),_&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==u.rotation&&(this.renderedRotation_=u.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];(0,H.nn)(this.pixelTransform,i);const n=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,r=this.renderedProjection_,a=this.wrappedRenderedExtent_,l=this.getLayer(),h=[],f=i[0]*ot,u=i[1]*ot;h.push(this.getRenderTransform(n,s,o,ot,f,u,0).slice());const g=l.getSource(),_=r.getExtent();if(g.getWrapX()&&r.canWrapX()&&!(0,T.r4)(_,a)){let p=a[0];const m=(0,T.dz)(_);let C,x=0;for(;p<_[0];)--x,C=m*x,h.push(this.getRenderTransform(n,s,o,ot,f,u,C).slice()),p+=m;for(x=0,p=a[2];p>_[2];)++x,C=m*x,h.push(this.getRenderTransform(n,s,o,ot,f,u,C).slice()),p-=m}this.hitDetectionImageData_=function rn(d,t,e,i,n,s,o){const l=(0,dt.E4)(d[0]*ot,d[1]*ot);l.imageSmoothingEnabled=!1;const h=l.canvas,f=new sn(l,ot,n,null,o),u=e.length,g=Math.floor(16777215/u),_={};for(let m=1;m<=u;++m){const x=e[m-1],C=x.getStyleFunction()||i;if(!i)continue;let P=C(x,s);if(!P)continue;Array.isArray(P)||(P=[P]);const v=(m*g).toString(16).padStart(7,"#00000");for(let b=0,R=P.length;b<R;++b){const L=P[b],O=L.getGeometryFunction()(x);if(!O||!(0,T.kK)(n,O.getExtent()))continue;const G=L.clone(),Y=G.getFill();Y&&Y.setColor(v);const Z=G.getStroke();Z&&(Z.setColor(v),Z.setLineDash(null)),G.setText(void 0);const A=L.getImage();if(A&&0!==A.getOpacity()){const D=A.getImageSize();if(!D)continue;const k=(0,dt.E4)(D[0],D[1],void 0,{alpha:!1}),W=k.canvas;k.fillStyle=v,k.fillRect(0,0,W.width,W.height),G.setImage(new on.Z({img:W,imgSize:D,anchor:A.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:A.getOrigin(),opacity:1,size:A.getSize(),scale:A.getScale(),rotation:A.getRotation(),rotateWithView:A.getRotateWithView()}))}const q=G.getZIndex()||0;let B=_[q];B||(B={},_[q]=B,B.Polygon=[],B.Circle=[],B.LineString=[],B.Point=[]);const I=O.getType();if("GeometryCollection"===I){const D=O.getGeometriesArrayRecursive();for(let k=0,W=D.length;k<W;++k){const U=D[k];B[U.getType().replace("Multi","")].push(U,G)}}else B[I.replace("Multi","")].push(O,G)}}const p=Object.keys(_).map(Number).sort(X.j2);for(let m=0,x=p.length;m<x;++m){const C=_[p[m]];for(const P in C){const E=C[P];for(let v=0,b=E.length;v<b;v+=2){f.setStyle(E[v+1]);for(let R=0,L=t.length;R<L;++R)f.setTransform(t[R]),f.drawGeometry(E[v])}}}return l.getImageData(0,0,h.width,h.height)}(i,h,this.renderedFeatures_,l.getStyleFunction(),a,s,o)}e(function an(d,t,e){const i=[];if(e){const n=Math.floor(Math.round(d[0])*ot),s=Math.floor(Math.round(d[1])*ot),o=4*((0,V.uZ)(n,0,e.width-1)+(0,V.uZ)(s,0,e.height-1)*e.width),h=e.data[o+2]+256*(e.data[o+1]+256*e.data[o]),f=Math.floor(16777215/t.length);h&&h%f==0&&i.push(t[h/f-1])}return i}(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,n,s){if(!this.replayGroup_)return;const o=e.viewState.resolution,r=e.viewState.rotation,a=this.getLayer(),l={},h=function(g,_,p){const m=(0,J.sq)(g),x=l[m];if(x){if(!0!==x&&p<x.distanceSq){if(0===p)return l[m]=!0,s.splice(s.lastIndexOf(x),1),n(g,a,_);x.geometry=_,x.distanceSq=p}}else{if(0===p)return l[m]=!0,n(g,a,_);s.push(l[m]={feature:g,layer:a,geometry:_,distanceSq:p,callback:n})}};let f;const u=[this.replayGroup_];return this.declutterExecutorGroup&&u.push(this.declutterExecutorGroup),u.some(g=>f=g.forEachFeatureAtCoordinate(t,o,r,i,h,g===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(_=>_.value):null)),f}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[Qt.Z.ANIMATING],s=t.viewHints[Qt.Z.INTERACTING],o=e.getUpdateWhileAnimating(),r=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!r&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,l=t.viewState,h=l.projection,f=l.resolution,u=t.pixelRatio,g=e.getRevision(),_=e.getRenderBuffer();let p=e.getRenderOrder();void 0===p&&(p=hn);const m=l.center.slice(),x=(0,T.f3)(a,_*f),C=x.slice(),P=[x.slice()],E=h.getExtent();if(i.getWrapX()&&h.canWrapX()&&!(0,T.r4)(E,t.extent)){const I=(0,T.dz)(E),D=Math.max((0,T.dz)(x)/2,I);x[0]=E[0]-D,x[2]=E[2]+D,(0,N.Cf)(m,h);const k=(0,T.Cf)(P[0],h);k[0]<E[0]&&k[2]<E[2]?P.push([k[0]+I,k[1],k[2]+I,k[3]]):k[0]>E[0]&&k[2]>E[2]&&P.push([k[0]-I,k[1],k[2]-I,k[3]])}if(this.ready&&this.renderedResolution_==f&&this.renderedRevision_==g&&this.renderedRenderOrder_==p&&(0,T.r4)(this.wrappedRenderedExtent_,x))return(0,X.fS)(this.renderedExtent_,C)||(this.hitDetectionImageData_=null,this.renderedExtent_=C),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const v=new qe(Me(f,u),x,f,u);let b;this.getLayer().getDeclutter()&&(b=new qe(Me(f,u),x,f,u));const R=(0,F.Cs)();let L;if(R){for(let I=0,D=P.length;I<D;++I){const W=(0,F.Fj)(P[I],h);i.loadFeatures(W,(0,F.on)(f,h),R)}L=(0,F.WO)(R,h)}else for(let I=0,D=P.length;I<D;++I)i.loadFeatures(P[I],f,h);const O=function cn(d,t){const e=Me(d,t);return e*e}(f,u);let G=!0;const Y=I=>{let D;const k=I.getStyleFunction()||e.getStyleFunction();if(k&&(D=k(I,f)),D){const W=this.renderFeature(I,O,D,v,L,b);G=G&&!W}},Z=(0,F.Fj)(x,h),A=i.getFeaturesInExtent(Z);p&&A.sort(p);for(let I=0,D=A.length;I<D;++I)Y(A[I]);this.renderedFeatures_=A,this.ready=G;const q=v.finish(),B=new ti(x,f,u,i.getOverlaps(),q,e.getRenderBuffer());return b&&(this.declutterExecutorGroup=new ti(x,f,u,i.getOverlaps(),b.finish(),e.getRenderBuffer())),this.renderedResolution_=f,this.renderedRevision_=g,this.renderedRenderOrder_=p,this.renderedExtent_=C,this.wrappedRenderedExtent_=x,this.renderedCenter_=m,this.renderedProjection_=h,this.replayGroup_=B,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,s,o){if(!i)return!1;let r=!1;if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)r=ii(n,t,i[a],e,this.boundHandleStyleImageChange_,s,o)||r;else r=ii(n,t,i,e,this.boundHandleStyleImageChange_,s,o);return r}},Ie=class Tn extends Et.Z{constructor(t){super(t)}createRenderer(){return new Sn(this)}};var Zt=y(3449);class $t extends xt.ZP{constructor(t,e,i){super(),void 0!==i&&void 0===e?this.setFlatCoordinates(i,t):this.setCenterAndRadius(t,e=e||0,i)}clone(){const t=new $t(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const s=this.flatCoordinates,o=t-s[0],r=e-s[1],a=o*o+r*r;if(a<n){if(0===a)for(let l=0;l<this.stride;++l)i[l]=s[l];else{const l=this.getRadius()/Math.sqrt(a);i[0]=s[0]+l*o,i[1]=s[1]+l*r;for(let h=2;h<this.stride;++h)i[h]=s[h]}return i.length=this.stride,a}return n}containsXY(t,e){const i=this.flatCoordinates,n=t-i[0],s=e-i[1];return n*n+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return(0,T.T9)(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if((0,T.kK)(t,e)){const i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]||(0,T.H6)(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+i;for(let s=1;s<e;++s)n[e+s]=t[s];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let s=(0,Zt.IG)(n,0,t,this.stride);n[s++]=n[0]+e;for(let o=1,r=this.stride;o<r;++o)n[s++]=n[o];n.length=s,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),n=this.getStride();this.setCenter((0,wt.U1)(i,0,i.length,n,t,e,i)),this.changed()}}const Pn=$t;var si=y(9395),Nt=y(8688),Ct=y(902),wn=y(5738),et=y(7796);class te extends wn.Z{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(et.bN),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push((0,et.oL)(this.geometries_[t],Nt.Z.CHANGE,this.changed,this))}clone(){const t=new te(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<(0,T.qf)(this.getExtent(),t,e))return n;const s=this.geometries_;for(let o=0,r=s.length;o<r;++o)n=s[o].closestPointXY(t,e,i,n);return n}containsXY(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)if(i[n].containsXY(t,e))return!0;return!1}computeExtent(t){(0,T.YN)(t);const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)(0,T.l7)(t,e[i].getExtent());return t}getGeometries(){return oi(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let n=!1;for(let s=0,o=i.length;s<o;++s){const r=i[s],a=r.getSimplifiedGeometry(t);e.push(a),a!==r&&(n=!0)}if(n){const s=new te(null);return s.setGeometriesArray(e),s}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].rotate(t,e);this.changed()}scale(t,e,i){i||(i=(0,T.qg)(this.getExtent()));const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(oi(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function oi(d){const t=[];for(let e=0,i=d.length;e<i;++e)t.push(d[e].clone());return t}const vn=te;var En=y(6269),It=y(9227),Mn=y(8611);function ri(d,t,e,i,n,s,o){let r,a;const l=(e-t)/i;if(1===l)r=t;else if(2===l)r=t,a=n;else if(0!==l){let h=d[t],f=d[t+1],u=0;const g=[0];for(let m=t+i;m<e;m+=i){const x=d[m],C=d[m+1];u+=Math.sqrt((x-h)*(x-h)+(C-f)*(C-f)),g.push(u),h=x,f=C}const _=n*u,p=(0,X.ry)(g,_);p<0?(a=(_-g[-p-2])/(g[-p-1]-g[-p-2]),r=t+(-p-2)*i):r=t+p*i}o=o>1?o:2,s=s||new Array(o);for(let h=0;h<o;++h)s[h]=void 0===r?NaN:void 0===a?d[r+h]:(0,V.t7)(d[r+h],d[r+i+h],a);return s}function ke(d,t,e,i,n,s){if(e==t)return null;let o;if(n<d[t+i-1])return s?(o=d.slice(t,t+i),o[i-1]=n,o):null;if(d[e-1]<n)return s?(o=d.slice(e-i,e),o[i-1]=n,o):null;if(n==d[t+i-1])return d.slice(t,t+i);let r=t/i,a=e/i;for(;r<a;){const u=r+a>>1;n<d[(u+1)*i-1]?a=u:r=u+1}const l=d[r*i-1];if(n==l)return d.slice((r-1)*i,(r-1)*i+i);const f=(n-l)/(d[(r+1)*i-1]-l);o=[];for(let u=0;u<i-1;++u)o.push((0,V.t7)(d[(r-1)*i+u],d[r*i+u],f));return o.push(n),o}var be=y(959);class ee extends xt.ZP{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}appendCoordinate(t){this.flatCoordinates?(0,X.l7)(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new ee(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<(0,T.qf)(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,It.Bv)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,It.H$)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))}forEachSegment(t){return(0,Mn.E)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:ke(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e=void 0!==e&&e)}getCoordinates(){return(0,tt.Ml)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ri(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return we(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=(0,qt.dt)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ee(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return(0,be.Kz)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,Zt.Sg)(this.flatCoordinates,0,t,this.stride),this.changed()}}const kt=ee;var kn=y(6494),it=y(6560);class ie extends xt.ZP{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let n=this.getLayout();const s=t,o=[],r=[];for(let a=0,l=s.length;a<l;++a){const h=s[a];0===a&&(n=h.getLayout()),(0,X.l7)(o,h.getFlatCoordinates()),r.push(o.length)}this.setFlatCoordinates(n,o),this.ends_=r}}appendLineString(t){this.flatCoordinates?(0,X.l7)(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ie(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<(0,T.qf)(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,It.Af)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,It.Xl)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))}getCoordinateAtM(t,e,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:function In(d,t,e,i,n,s,o){if(o)return ke(d,t,e[e.length-1],i,n,s);let r;if(n<d[i-1])return s?(r=d.slice(0,i),r[i-1]=n,r):null;if(d[d.length-1]<n)return s?(r=d.slice(d.length-i),r[i-1]=n,r):null;for(let a=0,l=e.length;a<l;++a){const h=e[a];if(t!=h){if(n<d[t+i-1])return null;if(n<=d[h-1])return ke(d,t,h,i,n,!1);t=h}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,e=void 0!==e&&e,i=void 0!==i&&i)}getCoordinates(){return(0,tt.o1)(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new kt(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[];let s=0;for(let o=0,r=e.length;o<r;++o){const a=e[o],l=new kt(t.slice(s,a),i);n.push(l),s=a}return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const n=this.ends_,s=this.stride;for(let o=0,r=n.length;o<r;++o){const a=n[o],l=ri(e,i,a,s,.5);(0,X.l7)(t,l),i=a}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=(0,qt.UJ)(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new ie(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return(0,be.AW)(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,Zt._5)(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const ai=ie;var yt=y(5311);class Le extends xt.ZP{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?(0,X.l7)(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new Le(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<(0,T.qf)(this.getExtent(),t,e))return n;const s=this.flatCoordinates,o=this.stride;for(let r=0,a=s.length;r<a;r+=o){const l=(0,V.bI)(t,e,s[r],s[r+1]);if(l<n){n=l;for(let h=0;h<o;++h)i[h]=s[r+h];i.length=o}}return n}getCoordinates(){return(0,tt.Ml)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){return t<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=t?null:new yt.Z(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,n=[];for(let s=0,o=t.length;s<o;s+=i){const r=new yt.Z(t.slice(s,s+i),e);n.push(r)}return n}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let n=0,s=e.length;n<s;n+=i)if((0,T.jE)(t,e[n],e[n+1]))return!0;return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,Zt.Sg)(this.flatCoordinates,0,t,this.stride),this.changed()}}const li=Le;var vt=y(3710),bn=y(8835),Fe=y(4124),Ln=y(2278),Rn=y(4817);class ne extends xt.ZP{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let n=this.getLayout();const s=t,o=[],r=[];for(let a=0,l=s.length;a<l;++a){const h=s[a];0===a&&(n=h.getLayout());const f=o.length,u=h.getEnds();for(let g=0,_=u.length;g<_;++g)u[g]+=f;(0,X.l7)(o,h.getFlatCoordinates()),r.push(u)}e=n,t=o,i=r}void 0!==e&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(this.flatCoordinates){const i=this.flatCoordinates.length;(0,X.l7)(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let n=0,s=e.length;n<s;++n)e[n]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=this.endss_[n].slice();const i=new ne(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,n){return n<(0,T.qf)(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,It.sD)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,It.gI)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return(0,Rn.Zl)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return(0,Ln.Eu)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),(0,Fe.dL)(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,(0,tt.ug)(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=function Fn(d,t,e,i){const n=[];let s=(0,T.lJ)();for(let o=0,r=e.length;o<r;++o){const a=e[o];s=(0,T.GN)(d,t,a[0],i),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=a[a.length-1]}return n}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,bn.U)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new li(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;(0,Fe.Oj)(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=(0,Fe.dL)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=(0,qt.Pp)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new ne(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(0===t)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const i=this.endss_[t].slice(),n=i[i.length-1];if(0!==e)for(let s=0,o=i.length;s<o;++s)i[s]-=e;return new vt.ZP(this.flatCoordinates.slice(e,n),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[];let s=0;for(let o=0,r=i.length;o<r;++o){const a=i[o].slice(),l=a[a.length-1];if(0!==s)for(let f=0,u=a.length;f<u;++f)a[f]-=s;const h=new vt.ZP(e.slice(s,l),t,a);n.push(h),s=l}return n}getType(){return"MultiPolygon"}intersectsExtent(t){return(0,be.oW)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,Zt.QT)(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()}}const hi=ne;var Re=y(2624),se=y(589),rt=y(8995),Wt=y(6093);class re extends si.ZP{constructor(t,e){super(t),this.feature=e}}function ae(d,t){return(0,V.bI)(d[0],d[1],t[0],t[1])}function bt(d,t){const e=d.length;return t<0?d[t+e]:t>=e?d[t-e]:d[t]}function le(d,t,e){let i,n;t<e?(i=t,n=e):(i=e,n=t);const s=Math.ceil(i),o=Math.floor(n);if(s>o)return ae(Lt(d,i),Lt(d,n));let r=0;i<s&&(r+=ae(Lt(d,i),bt(d,s))),o<n&&(r+=ae(bt(d,o),Lt(d,n)));for(let a=s;a<o-1;++a)r+=ae(bt(d,a),bt(d,a+1));return r}function ci(d,t,e){if(t instanceof kt)he(d,t.getCoordinates(),!1,e);else if(t instanceof ai){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n)he(d,i[n],!1,e)}else if(t instanceof vt.ZP){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n)he(d,i[n],!0,e)}else if(t instanceof hi){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let r=0,a=o.length;r<a;++r)he(d,o[r],!0,e)}}else if(t instanceof vn){const i=t.getGeometries();for(let n=0;n<i.length;++n)ci(d,i[n],e)}}const De={index:-1,endIndex:NaN};function he(d,t,e,i){const n=d[0],s=d[1];for(let o=0,r=t.length-1;o<r;++o){const h=di(n,s,t[o],t[o+1]);if(0===h.squaredDistance){const f=o+h.along;return void i.push({coordinates:t,ring:e,startIndex:f,endIndex:f})}}}const Oe={along:0,squaredDistance:0};function di(d,t,e,i){const n=e[0],s=e[1],a=i[0]-n,l=i[1]-s;let h=0,f=n,u=s;return(0!==a||0!==l)&&(h=(0,V.uZ)(((d-n)*a+(t-s)*l)/(a*a+l*l),0,1),f+=a*h,u+=l*h),Oe.along=h,Oe.squaredDistance=(0,V.FH)((0,V.bI)(d,t,f,u),10),Oe}function Lt(d,t){const e=d.length;let i=Math.floor(t);const n=t-i;i>=e?i-=e:i<0&&(i+=e);let s=i+1;s>=e&&(s-=e);const o=d[i],r=o[0],a=o[1],l=d[s];return[r+(l[0]-r)*n,a+(l[1]-a)*n]}function Gn(){const d=(0,Wt.Ly)();return function(t,e){return d[t.getGeometry().getType()]}}const ui=class An extends Re.Z{constructor(t){const e=t;e.stopDown||(e.stopDown=se.Dv),super(e),this.shouldHandle_=!1,this.downPx_=null,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=function Bn(d){switch(d){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+d)}}(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:se.uX,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY";let i=t.geometryFunction;if(!i){const n=this.mode_;if("Circle"===n)i=function(s,o,r){const a=o||new Pn([NaN,NaN]),l=(0,F.Vs)(s[0],r),h=(0,N.bI)(l,(0,F.Vs)(s[s.length-1],r));a.setCenterAndRadius(l,Math.sqrt(h),this.geometryLayout_);const f=(0,F.Cs)();return f&&a.transform(r,f),a};else{let s;"Point"===n?s=yt.Z:"LineString"===n?s=kt:"Polygon"===n&&(s=vt.ZP),i=function(o,r,a){return r?r.setCoordinates("Polygon"===n?o[0].length?[o[0].concat([o[0][0]])]:[]:o,this.geometryLayout_):r=new s(o,this.geometryLayout_),r}}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new Ie({source:new j.Z({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:Gn(),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:rt.rM,this.freehandCondition_=t.freehand?rt.Bx:t.freehandCondition?t.freehandCondition:rt.vY,this.setTrace(t.trace||!1),this.traceState_={active:!1},this.traceSource_=t.traceSource||t.source||null,this.addChangeListener(En.Z.ACTIVE,this.updateState_)}setTrace(t){let e;e=t?!0===t?rt.Bx:t:rt.Fi,this.traceCondition_=e}setMap(t){super.setMap(t),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(t){t.originalEvent.type===Nt.Z.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(t);let e=t.type===it.Z.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&t.type===it.Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===it.Z.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===it.Z.POINTERDOWN?i=!1:e&&this.getPointerCount()<2?(i=t.type===it.Z.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):("mouse"===t.originalEvent.pointerType||t.type===it.Z.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t)):t.type===it.Z.DBLCLICK&&(i=!1),super.handleEvent(t)&&i}handleDownEvent(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new kn.Z(it.Z.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))},this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(t){if(!this.traceSource_||!this.traceCondition_(t))return;if(this.traceState_.active)return void this.deactivateTrace_();const e=this.getMap(),i=e.getCoordinateFromPixel([t.pixel[0]-this.snapTolerance_,t.pixel[1]+this.snapTolerance_]),n=e.getCoordinateFromPixel([t.pixel[0]+this.snapTolerance_,t.pixel[1]-this.snapTolerance_]),s=(0,T.hI)([i,n]),o=this.traceSource_.getFeaturesInExtent(s);if(0===o.length)return;const r=function Dn(d,t){const e=[];for(let i=0;i<t.length;++i)ci(d,t[i].getGeometry(),e);return e}(t.coordinate,o);r.length&&(this.traceState_={active:!0,startPx:t.pixel.slice(),targets:r,targetIndex:-1})}addOrRemoveTracedCoordinates_(t,e){const i=t.startIndex<=t.endIndex;i===t.startIndex<=e?i&&e>t.endIndex||!i&&e<t.endIndex?this.addTracedCoordinates_(t,t.endIndex,e):(i&&e<t.endIndex||!i&&e>t.endIndex)&&this.removeTracedCoordinates_(e,t.endIndex):(this.removeTracedCoordinates_(t.startIndex,t.endIndex),this.addTracedCoordinates_(t,t.startIndex,e))}removeTracedCoordinates_(t,e){if(t===e)return;let i=0;if(t<e){const n=Math.ceil(t);let s=Math.floor(e);s===e&&(s-=1),i=s-n+1}else{const n=Math.floor(t);let s=Math.ceil(e);s===e&&(s+=1),i=n-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(t,e,i){if(e===i)return;const n=[];if(e<i){const s=Math.ceil(e);let o=Math.floor(i);o===i&&(o-=1);for(let r=s;r<=o;++r)n.push(bt(t.coordinates,r))}else{const s=Math.floor(e);let o=Math.ceil(i);o===i&&(o+=1);for(let r=s;r>=o;--r)n.push(bt(t.coordinates,r))}n.length&&this.appendCoordinates(n)}updateTrace_(t){const e=this.traceState_;if(!e.active||-1===e.targetIndex&&(0,N.TE)(e.startPx,t.pixel)<this.snapTolerance_)return;const i=function On(d,t,e,i){const n=d[0],s=d[1];let o=1/0,r=-1,a=NaN;for(let f=0;f<t.targets.length;++f){const u=t.targets[f],g=u.coordinates;let p,_=1/0;for(let m=0;m<g.length-1;++m){const P=di(n,s,g[m],g[m+1]);P.squaredDistance<_&&(_=P.squaredDistance,p=m+P.along)}_<o&&(o=_,u.ring&&t.targetIndex===f&&(u.endIndex>u.startIndex?p<u.startIndex&&(p+=g.length):u.endIndex<u.startIndex&&p>u.startIndex&&(p-=g.length)),a=p,r=f)}const l=t.targets[r];let h=l.ring;if(t.targetIndex===r&&h){const f=Lt(l.coordinates,a),u=e.getPixelFromCoordinate(f);(0,N.TE)(u,t.startPx)>i&&(h=!1)}if(h){const f=l.coordinates,u=f.length,g=l.startIndex,_=a;if(g<_){const p=le(f,g,_);le(f,g,_-u)<p&&(a-=u)}else{const p=le(f,g,_);le(f,g,_+u)<p&&(a+=u)}}return De.index=r,De.endIndex=a,De}(t.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==i.index){if(-1!==e.targetIndex){const a=e.targets[e.targetIndex];this.removeTracedCoordinates_(a.startIndex,a.endIndex)}const r=e.targets[i.index];this.addTracedCoordinates_(r,r.startIndex,i.endIndex)}else this.addOrRemoveTracedCoordinates_(e.targets[e.targetIndex],i.endIndex);e.targetIndex=i.index;const n=e.targets[e.targetIndex];n.endIndex=i.endIndex;const s=Lt(n.coordinates,n.endIndex),o=this.getMap().getPixelFromCoordinate(s);t.coordinate=s,t.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(t){let e=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);const i=this.traceState_.active;if(this.toggleTraceState_(t),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(t.coordinate),!n&&this.freehand_?this.finishDrawing():!this.freehand_&&(!n||"Point"===this.mode_)&&(this.atFinish_(t.pixel,i)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&t.preventDefault(),e}handlePointerMove_(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const e=this.downPx_,i=t.pixel,n=e[0]-i[0],s=e[1]-i[1],o=n*n+s*s;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(t),this.modifyDrawing_(t.coordinate)):this.createOrUpdateSketchPoint_(t.coordinate.slice())}atFinish_(t,e){let i=!1;if(this.sketchFeature_){let n=!1,s=[this.finishCoordinate_];const o=this.mode_;if("Point"===o)i=!0;else if("Circle"===o)i=2===this.sketchCoords_.length;else if("LineString"===o)n=!e&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===o){const r=this.sketchCoords_;n=r[0].length>this.minPoints_,s=[r[0][0],r[0][r[0].length-2]],s=e?[r[0][0]]:[r[0][0],r[0][r[0].length-2]]}if(n){const r=this.getMap();for(let a=0,l=s.length;a<l;a++){const h=s[a],f=r.getPixelFromCoordinate(h),u=t[0]-f[0],g=t[1]-f[1],_=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(u*u+g*g)<=_,i){this.finishCoordinate_=h;break}}}}return i}createOrUpdateSketchPoint_(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new Ct.Z(new yt.Z(t)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(t){this.sketchLine_||(this.sketchLine_=new Ct.Z);const e=t.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new kt(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(t){const e=this.getMap().getView().getProjection(),i=(0,xt.tP)(this.geometryLayout_);for(;t.length<i;)t.push(0);this.finishCoordinate_=t,"Point"===this.mode_?this.sketchCoords_=t.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Ct.Z(new kt(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new Ct.Z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new re("drawstart",this.sketchFeature_))}modifyDrawing_(t){const e=this.getMap(),i=this.sketchFeature_.getGeometry(),n=e.getView().getProjection(),s=(0,xt.tP)(this.geometryLayout_);let o,r;for(;t.length<s;)t.push(0);"Point"===this.mode_?r=this.sketchCoords_:"Polygon"===this.mode_?(o=this.sketchCoords_[0],r=o[o.length-1],this.atFinish_(e.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):(o=this.sketchCoords_,r=o[o.length-1]),r[0]=t[0],r[1]=t[1],this.geometryFunction_(this.sketchCoords_,i,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),"Polygon"===i.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(t){const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,s;const o=this.mode_;"LineString"===o||"Circle"===o?(this.finishCoordinate_=t.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(t.slice()),this.geometryFunction_(s,e,i)):"Polygon"===o&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(t.slice()),n&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,e,i)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),n&&this.finishDrawing()}removeLastPoints_(t){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;for(let s=0;s<t;++s){let o;if("LineString"===n||"Circle"===n){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const r=this.finishCoordinate_.slice();o[o.length-1]=r,this.createOrUpdateSketchPoint_(r)}this.geometryFunction_(o,e,i),"Polygon"===e.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if("Polygon"===n){o=this.sketchCoords_[0],o.splice(-2,1);const r=this.sketchLine_.getGeometry();if(o.length>=2){const a=o[o.length-2].slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}r.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,e,i)}if(1===o.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const t=this.abortDrawing_();if(!t)return;let e=this.sketchCoords_;const i=t.getGeometry(),n=this.getMap().getView().getProjection();"LineString"===this.mode_?(e.pop(),this.geometryFunction_(e,i,n)):"Polygon"===this.mode_&&(e[0].pop(),this.geometryFunction_(e,i,n),e=i.getCoordinates()),"MultiPoint"===this.type_?t.setGeometry(new li([e])):"MultiLineString"===this.type_?t.setGeometry(new ai([e])):"MultiPolygon"===this.type_&&t.setGeometry(new hi([e])),this.dispatchEvent(new re("drawend",t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}abortDrawing_(){this.finishCoordinate_=null;const t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),t}abortDrawing(){const t=this.abortDrawing_();t&&this.dispatchEvent(new re("drawabort",t))}appendCoordinates(t){const e=this.mode_,i=!this.sketchFeature_;let n;if(i&&this.startDrawing_(t[0]),"LineString"===e||"Circle"===e)n=this.sketchCoords_;else{if("Polygon"!==e)return;n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&n.shift(),n.pop();for(let o=0;o<t.length;o++)this.addToDrawing_(t[o]);const s=t[t.length-1];this.addToDrawing_(s),this.modifyDrawing_(s)}extend(t){const i=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=i.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new Ct.Z(new yt.Z(n)),this.updateSketchFeatures_(),this.dispatchEvent(new re("drawstart",this.sketchFeature_))}updateSketchFeatures_(){const t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);const e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)}updateState_(){const t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing(),this.overlay_.setMap(e?t:null)}};var ce=y(9529),fi=y(4989),de=y(451);function gi(d){return d.feature?d.feature:d.element?d.element:null}const Ae=[],Nn=class Zn extends Re.Z{constructor(t){const e=t=t||{};e.handleDownEvent||(e.handleDownEvent=se.uX),e.stopDown||(e.stopDown=se.Dv),super(e),this.source_=t.source?t.source:null,this.vertex_=void 0===t.vertex||t.vertex,this.edge_=void 0===t.edge||t.edge,this.features_=t.features?t.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.rBush_=new fi.Z,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(t,e){e=void 0===e||e;const i=(0,J.sq)(t),n=t.getGeometry();if(n){const s=this.GEOMETRY_SEGMENTERS_[n.getType()];if(s){this.indexedFeaturesExtents_[i]=n.getExtent((0,T.lJ)());const o=[];if(s(o,n),1===o.length)this.rBush_.insert((0,T.hI)(o[0]),{feature:t,segment:o[0]});else if(o.length>1){const r=o.map(l=>(0,T.hI)(l)),a=o.map(l=>({feature:t,segment:l}));this.rBush_.load(r,a)}}}e&&(this.featureChangeListenerKeys_[i]=(0,et.oL)(t,Nt.Z.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t}handleEvent(t){const e=this.snapTo(t.pixel,t.coordinate,t.map);return e&&(t.coordinate=e.vertex.slice(0,2),t.pixel=e.vertexPixel),super.handleEvent(t)}handleFeatureAdd_(t){const e=gi(t);e&&this.addFeature(e)}handleFeatureRemove_(t){const e=gi(t);e&&this.removeFeature(e)}handleFeatureChange_(t){const e=t.target;if(this.handlingDownUpSequence){const i=(0,J.sq)(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)}handleUpEvent(t){const e=Object.values(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(t,e){const i=void 0===e||e,n=(0,J.sq)(t),s=this.indexedFeaturesExtents_[n];if(s){const o=this.rBush_,r=[];o.forEachInExtent(s,function(a){t===a.feature&&r.push(a)});for(let a=r.length-1;a>=0;--a)o.remove(r[a])}i&&((0,et.bN)(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])}setMap(t){const e=this.getMap(),i=this.featuresListenerKeys_,n=this.getFeatures_();e&&(i.forEach(et.bN),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(et.bN),this.featureChangeListenerKeys_={}),super.setMap(t),t&&(this.features_?i.push((0,et.oL)(this.features_,ce.Z.ADD,this.handleFeatureAdd_,this),(0,et.oL)(this.features_,ce.Z.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push((0,et.oL)(this.source_,de.Z.ADDFEATURE,this.handleFeatureAdd_,this),(0,et.oL)(this.source_,de.Z.REMOVEFEATURE,this.handleFeatureRemove_,this)),n.forEach(s=>this.addFeature(s)))}snapTo(t,e,i){const n=i.getView().getProjection(),s=(0,F.Vs)(e,n),o=(0,F.Fj)((0,T.f3)((0,T.hI)([s]),i.getView().getResolution()*this.pixelTolerance_),n),r=this.rBush_.getInExtent(o),a=r.length;if(0===a)return null;let l,h=1/0;const f=this.pixelTolerance_*this.pixelTolerance_,u=()=>{if(l){const g=i.getPixelFromCoordinate(l);if((0,N.bI)(t,g)<=f)return{vertex:l,vertexPixel:[Math.round(g[0]),Math.round(g[1])]}}return null};if(this.vertex_){for(let _=0;_<a;++_){const p=r[_];"Circle"!==p.feature.getGeometry().getType()&&p.segment.forEach(m=>{const x=(0,F.Vs)(m,n),C=(0,N.bI)(s,x);C<h&&(l=m,h=C)})}const g=u();if(g)return g}if(this.edge_){for(let _=0;_<a;++_){let p=null;const m=r[_];if("Circle"===m.feature.getGeometry().getType()){let x=m.feature.getGeometry();const C=(0,F.Cs)();C&&(x=x.clone().transform(C,n)),p=(0,N.Ed)(s,x)}else{const[x,C]=m.segment;C&&(Ae[0]=(0,F.Vs)(x,n),Ae[1]=(0,F.Vs)(C,n),p=(0,N.oL)(s,Ae))}if(p){const x=(0,N.bI)(s,p);x<h&&(l=(0,F.lO)(p,n),h=x)}}const g=u();if(g)return g}return null}updateFeature_(t){this.removeFeature(t,!1),this.addFeature(t,!1)}segmentCircleGeometry_(t,e){const i=this.getMap().getView().getProjection();let n=e;const s=(0,F.Cs)();s&&(n=n.clone().transform(s,i));const o=(0,vt.Bb)(n);s&&o.transform(i,s);const r=o.getCoordinates()[0];for(let a=0,l=r.length-1;a<l;++a)t.push(r.slice(a,a+2))}segmentGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let n=0;n<i.length;++n){const s=this.GEOMETRY_SEGMENTERS_[i[n].getType()];s&&s(t,i[n])}}segmentLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length-1;n<s;++n)t.push(i.slice(n,n+2))}segmentMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let r=0,a=o.length-1;r<a;++r)t.push(o.slice(r,r+2))}}segmentMultiPointGeometry_(t,e){e.getCoordinates().forEach(i=>{t.push([i])})}segmentMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let r=0,a=o.length;r<a;++r){const l=o[r];for(let h=0,f=l.length-1;h<f;++h)t.push(l.slice(h,h+2))}}}segmentPointGeometry_(t,e){t.push([e.getCoordinates()])}segmentPolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let r=0,a=o.length-1;r<a;++r)t.push(o.slice(r,r+2))}}};var _i=y(1165);const mi=[0,0,0,0],Ft=[];class Be extends si.ZP{constructor(t,e,i){super(t),this.features=e,this.mapBrowserEvent=i}}function Yn(d,t){return d.index-t.index}function xi(d,t,e){const i=t.geometry;if("Circle"===i.getType()){let s=i;if(1===t.index){const o=(0,F.Cs)();o&&(s=s.clone().transform(o,e));const r=(0,N.bI)(s.getCenter(),(0,F.Vs)(d,e)),a=Math.sqrt(r)-s.getRadius();return a*a}}const n=(0,F.Vs)(d,e);return Ft[0]=(0,F.Vs)(t.segment[0],e),Ft[1]=(0,F.Vs)(t.segment[1],e),(0,N.Bs)(n,Ft)}function Ci(d,t,e){const i=t.geometry;if("Circle"===i.getType()&&1===t.index){let s=i;const o=(0,F.Cs)();return o&&(s=s.clone().transform(o,e)),(0,F.lO)(s.getClosestPoint((0,F.Vs)(d,e)),e)}const n=(0,F.Vs)(d,e);return Ft[0]=(0,F.Vs)(t.segment[0],e),Ft[1]=(0,F.Vs)(t.segment[1],e),(0,F.lO)((0,N.oL)(n,Ft),e)}function Vn(){const d=(0,Wt.Ly)();return function(t,e){return d.Point}}const jn=class Wn extends Re.Z{constructor(t){let e;if(super(t),this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=t.condition?t.condition:rt.Xp,this.defaultDeleteCondition_=function(i){return(0,rt.Ko)(i)&&(0,rt.Kf)(i)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:rt.Bx,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new fi.Z,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ie({source:new j.Z({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:Vn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,t.features?e=t.features:t.source&&(this.source_=t.source,e=new _i.Z(this.source_.getFeatures()),this.source_.addEventListener(de.Z.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(de.Z.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!e)throw new Error("The modify interaction requires features, a source or a layer");t.hitDetection&&(this.hitDetection_=t.hitDetection),this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ce.Z.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ce.Z.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===t.snapToPointer?!this.hitDetection_:t.snapToPointer}addFeature_(t){const e=t.getGeometry();if(e){const n=this.SEGMENT_WRITERS_[e.getType()];n&&n(t,e)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),t.addEventListener(Nt.Z.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new _i.Z;const i=this.featuresBeingModified_.getArray();for(let n=0,s=e.length;n<s;++n){const o=e[n];for(let r=0,a=o.length;r<a;++r){const l=o[r].feature;l&&!i.includes(l)&&this.featuresBeingModified_.push(l)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new Be("modifystart",this.featuresBeingModified_,t))}}removeFeature_(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(Nt.Z.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(t){const e=this.rBush_,i=[];e.forEach(function(n){t===n.feature&&i.push(n)});for(let n=i.length-1;n>=0;--n){const s=i[n];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===s&&this.dragSegments_.splice(o,1);e.remove(s)}}setActive(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(t)}setMap(t){this.overlay_.setMap(t),super.setMap(t)}getOverlay(){return this.overlay_}handleSourceAdd_(t){t.feature&&this.features_.push(t.feature)}handleSourceRemove_(t){t.feature&&this.features_.remove(t.feature)}handleFeatureAdd_(t){this.addFeature_(t.element)}handleFeatureChange_(t){if(!this.changingFeature_){const e=t.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(t){this.removeFeature_(t.element)}writePointGeometry_(t,e){const i=e.getCoordinates(),n={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),n)}writeMultiPointGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n],r={feature:t,geometry:e,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(e.getExtent(),r)}}writeLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length-1;n<s;++n){const o=i.slice(n,n+2),r={feature:t,geometry:e,index:n,segment:o};this.rBush_.insert((0,T.hI)(o),r)}}writeMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let r=0,a=o.length-1;r<a;++r){const l=o.slice(r,r+2),h={feature:t,geometry:e,depth:[n],index:r,segment:l};this.rBush_.insert((0,T.hI)(l),h)}}}writePolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let r=0,a=o.length-1;r<a;++r){const l=o.slice(r,r+2),h={feature:t,geometry:e,depth:[n],index:r,segment:l};this.rBush_.insert((0,T.hI)(l),h)}}}writeMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let r=0,a=o.length;r<a;++r){const l=o[r];for(let h=0,f=l.length-1;h<f;++h){const u=l.slice(h,h+2),g={feature:t,geometry:e,depth:[r,n],index:h,segment:u};this.rBush_.insert((0,T.hI)(u),g)}}}}writeCircleGeometry_(t,e){const i=e.getCenter(),n={feature:t,geometry:e,index:0,segment:[i,i]},s={feature:t,geometry:e,index:1,segment:[i,i]},o=[n,s];n.featureSegments=o,s.featureSegments=o,this.rBush_.insert((0,T.HK)(i),n);let r=e;const a=(0,F.Cs)();if(a&&this.getMap()){const l=this.getMap().getView().getProjection();r=r.clone().transform(a,l),r=(0,vt.Bb)(r).transform(l,a)}this.rBush_.insert(r.getExtent(),s)}writeGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let n=0;n<i.length;++n){const s=i[n];(0,this.SEGMENT_WRITERS_[s.getType()])(t,s)}}createOrUpdateVertexFeature_(t,e,i){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(t):(n=new Ct.Z(new yt.Z(t)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",e),n.set("geometries",i),n}handleEvent(t){if(!t.originalEvent)return!0;let e;return this.lastPointerEvent_=t,!t.map.getView().getInteracting()&&t.type==it.Z.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(e=!(t.type!=it.Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==it.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(t)&&!e}handleDragEvent(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_);const e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],n=[];for(let s=0,o=this.dragSegments_.length;s<o;++s){const r=this.dragSegments_[s],a=r[0],l=a.feature;i.includes(l)||i.push(l);const h=a.geometry;n.includes(h)||n.push(h);const f=a.depth;let u;const g=a.segment,_=r[1];for(;e.length<h.getStride();)e.push(g[_][e.length]);switch(h.getType()){case"Point":u=e,g[0]=e,g[1]=e;break;case"MultiPoint":u=h.getCoordinates(),u[a.index]=e,g[0]=e,g[1]=e;break;case"LineString":u=h.getCoordinates(),u[a.index+_]=e,g[_]=e;break;case"MultiLineString":case"Polygon":u=h.getCoordinates(),u[f[0]][a.index+_]=e,g[_]=e;break;case"MultiPolygon":u=h.getCoordinates(),u[f[1]][f[0]][a.index+_]=e,g[_]=e;break;case"Circle":if(g[0]=e,g[1]=e,0===a.index)this.changingFeature_=!0,h.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;const p=t.map.getView().getProjection();let m=(0,N.TE)((0,F.Vs)(h.getCenter(),p),(0,F.Vs)(e,p));const x=(0,F.Cs)();if(x){const C=h.clone().transform(x,p);C.setRadius(m),m=C.transform(p,x).getRadius()}h.setRadius(m),this.changingFeature_=!1}}u&&this.setGeometryCoordinates_(h,u)}this.createOrUpdateVertexFeature_(e,i,n)}handleDownEvent(t){if(!this.condition_(t))return!1;const e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const n=t.map.getView().getProjection(),s=[],o=i.getGeometry().getCoordinates(),r=(0,T.hI)([o]),a=this.rBush_.getInExtent(r),l={};a.sort(Yn);for(let h=0,f=a.length;h<f;++h){const u=a[h],g=u.segment;let _=(0,J.sq)(u.geometry);const p=u.depth;if(p&&(_+="-"+p.join("-")),l[_]||(l[_]=new Array(2)),"Circle"!==u.geometry.getType()||1!==u.index)if(!(0,N.fS)(g[0],o)||l[_][0])if(!(0,N.fS)(g[1],o)||l[_][1])(0,J.sq)(g)in this.vertexSegments_&&!l[_][0]&&!l[_][1]&&this.insertVertexCondition_(t)&&s.push(u);else{if(l[_][0]&&0===l[_][0].index){let m=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":m=m[p[1]];case"Polygon":if(u.index!==m[p[0]].length-2)continue}}this.dragSegments_.push([u,1]),l[_][1]=u}else this.dragSegments_.push([u,0]),l[_][0]=u;else{const m=Ci(e,u,n);(0,N.fS)(m,o)&&!l[_][0]&&(this.dragSegments_.push([u,0]),l[_][0]=u)}}s.length&&this.willModifyFeatures_(t,[s]);for(let h=s.length-1;h>=0;--h)this.insertVertex_(s[h],o)}return!!this.vertexFeature_}handleUpEvent(t){for(let e=this.dragSegments_.length-1;e>=0;--e){const i=this.dragSegments_[e][0],n=i.geometry;if("Circle"===n.getType()){const s=n.getCenter(),o=i.featureSegments[0],r=i.featureSegments[1];o.segment[0]=s,o.segment[1]=s,r.segment[0]=s,r.segment[1]=s,this.rBush_.update((0,T.HK)(s),o);let a=n;const l=(0,F.Cs)();if(l){const h=t.map.getView().getProjection();a=a.clone().transform(l,h),a=(0,vt.Bb)(a).transform(h,l)}this.rBush_.update(a.getExtent(),r)}else this.rBush_.update((0,T.hI)(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Be("modifyend",this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1}handlePointerMove_(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)}handlePointerAtPixel_(t,e,i){const n=i||e.getCoordinateFromPixel(t),s=e.getView().getProjection(),o=function(l,h){return xi(n,l,s)-xi(n,h,s)};let r,a;if(this.hitDetection_&&e.forEachFeatureAtPixel(t,(h,f,u)=>{u&&(u=new yt.Z((0,F.lO)(u.getCoordinates(),s)));const g=u||h.getGeometry();if("Point"===g.getType()&&h instanceof Ct.Z&&this.features_.getArray().includes(h)){a=g;const _=h.getGeometry().getFlatCoordinates().slice(0,2);r=[{feature:h,geometry:a,segment:[_,_]}]}return!0},{layerFilter:"object"==typeof this.hitDetection_?h=>h===this.hitDetection_:void 0}),!r){const l=(0,F.dY)((0,T.HK)(n,mi),s),h=e.getView().getResolution()*this.pixelTolerance_,f=(0,F.Fj)((0,T.f3)(l,h,mi),s);r=this.rBush_.getInExtent(f)}if(r&&r.length>0){const l=r.sort(o)[0],h=l.segment;let f=Ci(n,l,s);const u=e.getPixelFromCoordinate(f);let g=(0,N.TE)(t,u);if(a||g<=this.pixelTolerance_){const _={};if(_[(0,J.sq)(h)]=!0,this.snapToPointer_||(this.delta_[0]=f[0]-n[0],this.delta_[1]=f[1]-n[1]),"Circle"===l.geometry.getType()&&1===l.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(f,[l.feature],[l.geometry]);else{const p=e.getPixelFromCoordinate(h[0]),m=e.getPixelFromCoordinate(h[1]),x=(0,N.bI)(u,p),C=(0,N.bI)(u,m);g=Math.sqrt(Math.min(x,C)),this.snappedToVertex_=g<=this.pixelTolerance_,this.snappedToVertex_&&(f=x>C?h[1]:h[0]),this.createOrUpdateVertexFeature_(f,[l.feature],[l.geometry]);const P={};P[(0,J.sq)(l.geometry)]=!0;for(let E=1,v=r.length;E<v;++E){const b=r[E].segment;if(!((0,N.fS)(h[0],b[0])&&(0,N.fS)(h[1],b[1])||(0,N.fS)(h[0],b[1])&&(0,N.fS)(h[1],b[0])))break;{const R=(0,J.sq)(r[E].geometry);R in P||(P[R]=!0,_[(0,J.sq)(b)]=!0)}}}return void(this.vertexSegments_=_)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(t,e){const i=t.segment,n=t.feature,s=t.geometry,o=t.depth,r=t.index;let a;for(;e.length<s.getStride();)e.push(0);switch(s.getType()){case"MultiLineString":case"Polygon":a=s.getCoordinates(),a[o[0]].splice(r+1,0,e);break;case"MultiPolygon":a=s.getCoordinates(),a[o[1]][o[0]].splice(r+1,0,e);break;case"LineString":a=s.getCoordinates(),a.splice(r+1,0,e);break;default:return}this.setGeometryCoordinates_(s,a);const l=this.rBush_;l.remove(t),this.updateSegmentIndices_(s,r,o,1);const h={segment:[i[0],e],feature:n,geometry:s,depth:o,index:r};l.insert((0,T.hI)(h.segment),h),this.dragSegments_.push([h,1]);const f={segment:[e,i[1]],feature:n,geometry:s,depth:o,index:r+1};l.insert((0,T.hI)(f.segment),f),this.dragSegments_.push([f,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=it.Z.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_);const e=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Be("modifyend",this.featuresBeingModified_,t)),this.featuresBeingModified_=null,e}return!1}removeVertex_(){const t=this.dragSegments_,e={};let n,s,o,r,a,l,h,f,u,g,_,i=!1;for(a=t.length-1;a>=0;--a)o=t[a],g=o[0],_=(0,J.sq)(g.feature),g.depth&&(_+="-"+g.depth.join("-")),_ in e||(e[_]={}),0===o[1]?(e[_].right=g,e[_].index=g.index):1==o[1]&&(e[_].left=g,e[_].index=g.index+1);for(_ in e){switch(u=e[_].right,h=e[_].left,l=e[_].index,f=l-1,g=void 0!==h?h:u,f<0&&(f=0),r=g.geometry,s=r.getCoordinates(),n=s,i=!1,r.getType()){case"MultiLineString":s[g.depth[0]].length>2&&(s[g.depth[0]].splice(l,1),i=!0);break;case"LineString":s.length>2&&(s.splice(l,1),i=!0);break;case"MultiPolygon":n=n[g.depth[1]];case"Polygon":n=n[g.depth[0]],n.length>4&&(l==n.length-1&&(l=0),n.splice(l,1),i=!0,0===l&&(n.pop(),n.push(n[0]),f=n.length-1))}if(i){this.setGeometryCoordinates_(r,s);const p=[];if(void 0!==h&&(this.rBush_.remove(h),p.push(h.segment[0])),void 0!==u&&(this.rBush_.remove(u),p.push(u.segment[1])),void 0!==h&&void 0!==u){const m={depth:g.depth,feature:g.feature,geometry:g.geometry,index:f,segment:p};this.rBush_.insert((0,T.hI)(m.segment),m)}this.updateSegmentIndices_(r,l,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return i}setGeometryCoordinates_(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(t,e,i,n){this.rBush_.forEachInExtent(t.getExtent(),function(s){s.geometry===t&&(void 0===i||void 0===s.depth||(0,X.fS)(s.depth,i))&&s.index>e&&(s.index+=n)})}};var Ze=y(8648),Ne=y(9443),Rt=y(1059),Un=y(1092),Xn=y(1645),Hn=y(4096);const Jn=class Kn extends Un.Z{constructor(t){super(),this.options=t,this.id=t.id,this.insertFirst=void 0===t.insertFirst||t.insertFirst,this.stopEvent=void 0===t.stopEvent||t.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==t.className?t.className:"ol-overlay-container "+Hn.$A,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=!0===t.autoPan?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener("element",this.handleElementChanged),this.addChangeListener("map",this.handleMapChanged),this.addChangeListener("offset",this.handleOffsetChanged),this.addChangeListener("position",this.handlePositionChanged),this.addChangeListener("positioning",this.handlePositioningChanged),void 0!==t.element&&this.setElement(t.element),this.setOffset(void 0!==t.offset?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),void 0!==t.position&&this.setPosition(t.position)}getElement(){return this.get("element")}getId(){return this.id}getMap(){return this.get("map")||null}getOffset(){return this.get("offset")}getPosition(){return this.get("position")}getPositioning(){return this.get("positioning")}handleElementChanged(){(0,dt.ep)(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&((0,dt.ZF)(this.element),(0,et.bN)(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=(0,et.oL)(t,Xn.Z.POSTRENDER,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set("element",t)}setMap(t){this.set("map",t)}setOffset(t){this.set("offset",t)}setPosition(t){this.set("position",t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get("position"))return;const i=this.getRect(e.getTargetElement(),e.getSize()),n=this.getElement(),s=this.getRect(n,[(0,dt.iO)(n),(0,dt.Pb)(n)]),o=void 0===(t=t||{}).margin?20:t.margin;if(!(0,T.r4)(i,s)){const r=s[0]-i[0],a=i[2]-s[2],l=s[1]-i[1],h=i[3]-s[3],f=[0,0];if(r<0?f[0]=r-o:a<0&&(f[0]=Math.abs(a)+o),l<0?f[1]=l-o:h<0&&(f[1]=Math.abs(h)+o),0!==f[0]||0!==f[1]){const u=e.getView().getCenterInternal(),g=e.getPixelFromCoordinateInternal(u);if(!g)return;const _=[g[0]+f[0],g[1]+f[1]],p=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(_),duration:p.duration,easing:p.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),n=i.left+window.pageXOffset,s=i.top+window.pageYOffset;return[n,s,n+e[0],s+e[1]]}setPositioning(t){this.set("positioning",t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e)return void this.setVisible(!1);const i=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(t,e){const i=this.element.style,n=this.getOffset(),s=this.getPositioning();this.setVisible(!0);let a="0%",l="0%";"bottom-right"==s||"center-right"==s||"top-right"==s?a="-100%":("bottom-center"==s||"center-center"==s||"top-center"==s)&&(a="-50%"),"bottom-left"==s||"bottom-center"==s||"bottom-right"==s?l="-100%":("center-left"==s||"center-center"==s||"center-right"==s)&&(l="-50%");const h=`translate(${a}, ${l}) translate(${Math.round(t[0]+n[0])+"px"}, ${Math.round(t[1]+n[1])+"px"})`;this.rendered.transform_!=h&&(this.rendered.transform_=h,i.transform=h)}getOptions(){return this.options}};var zn=y(737),qn=y(4089),ue=y(6814),Qn=y(9061),$n=y(3999);function ts(d,t){if(1&d&&(c.TgZ(0,"div"),c._UZ(1,"div",5),c.qZA()),2&d){const e=c.oxw();c.Tol(e.styleClass)}}function es(d,t){if(1&d){const e=c.EpF();c.TgZ(0,"p-button",11),c.NdJ("onClick",function(){c.CHM(e);const n=c.oxw(3);return c.KtG(n.onDrawClick())}),c.ALo(1,"translate"),c.qZA()}if(2&d){const e=c.oxw(3);c.Q6J("disabled",e.disabledMapButtons)("icon",e.mobileScreen?"pi pi-palette":"")("styleClass",e.mobileScreen?"ui-button_size_100":"ui-button_size_125")("label",e.mobileScreen?"":c.lcZ(1,4,"global.buttons.draw"))}}function is(d,t){if(1&d){const e=c.EpF();c.TgZ(0,"p-button",11),c.NdJ("onClick",function(){c.CHM(e);const n=c.oxw(3);return c.KtG(n.onModifyClick())}),c.ALo(1,"translate"),c.qZA()}if(2&d){const e=c.oxw(3);c.Q6J("disabled",e.disabledMapButtons)("icon",e.mobileScreen?"pi pi-pencil":"")("styleClass",e.mobileScreen?"ui-button_size_100":"ui-button_size_125")("label",e.mobileScreen?"":c.lcZ(1,4,"global.buttons.edit"))}}function ns(d,t){if(1&d){const e=c.EpF();c.TgZ(0,"div"),c.YNc(1,es,2,6,"p-button",10),c.YNc(2,is,2,6,"p-button",10),c.TgZ(3,"p-button",11),c.NdJ("onClick",function(){c.CHM(e);const n=c.oxw(2);return c.KtG(n.deleteVertex())}),c.ALo(4,"translate"),c.qZA()()}if(2&d){const e=c.oxw(2);c.xp6(1),c.Q6J("ngIf",0===e.vertexes.length),c.xp6(1),c.Q6J("ngIf",e.vertexes.length>0),c.xp6(1),c.Q6J("disabled",e.disabledMapButtons)("icon",e.mobileScreen?"pi pi-trash":"")("styleClass",e.mobileScreen?"ui-button_size_100":"ui-button_size_125")("label",e.mobileScreen?"":c.lcZ(4,6,"global.buttons.clear"))}}function ss(d,t){if(1&d){const e=c.EpF();c.TgZ(0,"p-button",12),c.NdJ("onClick",function(){c.CHM(e);const n=c.oxw(2);return c.KtG(n.saveVertex())}),c.ALo(1,"translate"),c.qZA(),c.TgZ(2,"p-button",13),c.NdJ("onClick",function(){c.CHM(e);const n=c.oxw(2);return c.KtG(n.loadVertexes())}),c.ALo(3,"translate"),c.qZA()}if(2&d){const e=c.oxw(2);c.s9C("label",c.lcZ(1,3,"global.buttons.save")),c.Q6J("disabled",e.disabledMapButtons),c.xp6(2),c.s9C("label",c.lcZ(3,5,"global.buttons.cancel"))}}function os(d,t){if(1&d&&(c.TgZ(0,"div",6),c._UZ(1,"div",5),c.TgZ(2,"div",7),c.YNc(3,ns,5,8,"div",8),c.YNc(4,ss,4,7,"ng-template",null,9,c.W1O),c.qZA()()),2&d){const e=c.MAs(5),i=c.oxw();c.xp6(3),c.Q6J("ngIf",!1===i.modified&&!1===i.drawable)("ngIfElse",e)}}function rs(d,t){if(1&d){const e=c.EpF();c.TgZ(0,"uwb-map-panel",15),c.NdJ("emitPreviousClick",function(){c.CHM(e);const n=c.oxw(2);return c.KtG(n.goToPreviousPoint())})("emitNextClick",function(){c.CHM(e);const n=c.oxw(2);return c.KtG(n.goToNextPoint())})("emitPlayClick",function(){c.CHM(e);const n=c.oxw(2);return c.KtG(n.goToNextPointAutomatic())})("emitPauseClick",function(){c.CHM(e);const n=c.oxw(2);return c.KtG(n.stopGoToNextPointAutomatic())})("emitTimeToChangePoint",function(n){c.CHM(e);const s=c.oxw(2);return c.KtG(s.onTimeToChangePointChenge(n))}),c.qZA()}if(2&d){const e=c.oxw(2);c.Q6J("disabledButtons",e.disabledMapPanelButtons)}}function as(d,t){if(1&d&&(c.TgZ(0,"div")(1,"div",5),c.YNc(2,rs,1,1,"uwb-map-panel",14),c.qZA()()),2&d){const e=c.oxw();c.Tol(e.styleClass),c.xp6(2),c.Q6J("ngIf",e.background&&""!==e.background)}}function ls(d,t){if(1&d){const e=c.EpF();c.TgZ(0,"div",7)(1,"p-button",20),c.NdJ("onClick",function(){c.CHM(e);const n=c.oxw(3);return c.KtG(n.emitEditSelectedPoint.emit(n.selectedMapPoint))}),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"p-button",21),c.NdJ("onClick",function(){c.CHM(e);const n=c.oxw(3);return c.KtG(n.emitDeleteSelectedPoint.emit(n.selectedMapPoint))}),c.ALo(4,"translate"),c.qZA()()}2&d&&(c.xp6(1),c.s9C("pTooltip",c.lcZ(2,2,"global.buttons.edit")),c.xp6(2),c.s9C("pTooltip",c.lcZ(4,4,"global.buttons.delete")))}function hs(d,t){if(1&d&&(c.TgZ(0,"div",17)(1,"span",18),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.TgZ(4,"span",18),c._uU(5),c.ALo(6,"translate"),c.qZA(),c.TgZ(7,"span",18),c._uU(8),c.ALo(9,"translate"),c.qZA(),c.TgZ(10,"span",18),c._uU(11),c.ALo(12,"translate"),c.qZA(),c.YNc(13,ls,5,6,"div",19),c.qZA()),2&d){const e=c.oxw(2);c.xp6(2),c.AsE(" ",c.lcZ(3,9,"anchor.name"),": ",e.selectedMapPoint.name," "),c.xp6(3),c.AsE(" ",c.lcZ(6,11,"anchor.x"),": ",e.selectedMapPoint.x," "),c.xp6(3),c.AsE(" ",c.lcZ(9,13,"anchor.y"),": ",e.selectedMapPoint.y," "),c.xp6(3),c.AsE(" ",c.lcZ(12,15,"anchor.z"),": ",e.selectedMapPoint.z," "),c.xp6(2),c.Q6J("ngIf",e.showAnchorOverlayButtons)}}function cs(d,t){if(1&d&&(c.ynx(0),c.YNc(1,hs,14,17,"div",16),c.BQk()),2&d){const e=c.oxw();c.xp6(1),c.Q6J("ngIf",e.selectedMapPoint&&e.showOverlay)}}function ds(d,t){if(1&d&&(c.TgZ(0,"div",17)(1,"span",18),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.TgZ(4,"span",18),c._uU(5),c.ALo(6,"translate"),c.qZA(),c.TgZ(7,"span",18),c._uU(8),c.ALo(9,"translate"),c.qZA(),c.TgZ(10,"span",18),c._uU(11),c.ALo(12,"translate"),c.ALo(13,"date"),c.qZA()()),2&d){const e=c.oxw(2);c.xp6(2),c.AsE(" ",c.lcZ(3,8,"localization.tag.name"),": ",e.selectedMapPoint.name," "),c.xp6(3),c.AsE(" ",c.lcZ(6,10,"localization.tag.x"),": ",e.selectedMapPoint.x," "),c.xp6(3),c.AsE(" ",c.lcZ(9,12,"localization.tag.y"),": ",e.selectedMapPoint.y," "),c.xp6(3),c.AsE(" ",c.lcZ(12,14,"localization.tag.date"),": ",c.xi3(13,16,e.selectedMapPoint.date,"yyyy-M-dd, HH:mm:ss")," ")}}function us(d,t){if(1&d&&(c.ynx(0),c.YNc(1,ds,14,19,"div",16),c.BQk()),2&d){const e=c.oxw();c.xp6(1),c.Q6J("ngIf",e.selectedMapPoint)}}let fs=(()=>{class d{constructor(e,i){this.cd=e,this.renderer=i,this.background="",this.vertexes=[],this.anchors=[],this.drawable=!1,this.drawableLineString=!1,this.modified=!1,this.clear=!1,this.vertexAlfa="66",this.vertexBackgroundColor="#8f8f8f",this.vertexColor="#ffcc33",this.mapDisplayType="normal",this.mapWithButtons=!1,this.disabledMapButtons=!1,this.styleClass="h-full",this.mapClickMode="else",this.emitLengthLineString=new c.vpe,this.emitNewPoint=new c.vpe,this.emitEditSelectedPoint=new c.vpe,this.emitDeleteSelectedPoint=new c.vpe,this.extent=[0,0,1024,968],this.projection=new Jt.Z({code:"xkcd-image",units:"pixels",extent:this.extent}),this.disabledMapPanelButtons=!1,this.showOverlay=!0,this.showAnchorOverlayButtons=!1,this.smallScreen=!1,this.mobileScreen=!1}ngOnInit(){this.loadMap()}ngOnChanges(e){e.background&&""!==this.background&&this.loadMap(),this.cd.detectChanges()}ngOnDestroy(){this.mapInterval&&clearInterval(this.mapInterval),this.map.setTarget(void 0),this.map.dispose()}loadMap(){this.selectedMapPoint=void 0,this.map&&this.map.dispose(),this.map=new Ce.Z({target:"map",view:new ye.ZP({projection:this.projection,center:(0,T.qg)(this.extent),zoom:2,maxZoom:8})}),this.loadLayer(),this.drawableLineString&&this.loadDrawLineStringOption(),this.overlay?this.overlay.setPosition(void 0):this.overlay=new Jn({element:document.getElementById("popup")}),this.map.addOverlay(this.overlay)}loadLayer(){const e=new Se.Z({source:new Te.Z});this.source=new j.Z;const i=new Ie({source:this.source,style:new Wt.ZP({fill:new Rt.Z({color:this.vertexBackgroundColor+this.vertexAlfa}),stroke:new Ze.Z({color:this.vertexColor,width:2}),image:new Ne.Z({radius:7,fill:new Rt.Z({color:this.vertexColor})})})}),n=[new Kt.Z({source:new St.Z({url:this.background,imageSize:[1e3,1e3],projection:this.projection,imageExtent:this.extent})}),i,e];setTimeout(()=>{this.map.updateSize()}),this.map.setLayers(n),this.map.render()}loadVertexes(){}loadDrawOption(){this.drawInteraction=new ui({source:this.source,type:"Polygon",freehandCondition:rt.Fi,style:new Wt.ZP({fill:new Rt.Z({color:this.vertexBackgroundColor+this.vertexAlfa}),stroke:new Ze.Z({color:this.vertexColor,width:2}),image:new Ne.Z({radius:7,fill:new Rt.Z({color:this.vertexColor})})})}),this.map.addInteraction(this.drawInteraction),this.snap=new Nn({source:this.source}),this.map.addInteraction(this.snap)}loadDrawLineStringOption(){this.drawInteraction=new ui({source:this.source,type:"LineString",maxPoints:2,style:new Wt.ZP({fill:new Rt.Z({color:this.vertexBackgroundColor+this.vertexAlfa}),stroke:new Ze.Z({color:this.vertexColor,width:2}),image:new Ne.Z({radius:7,fill:new Rt.Z({color:this.vertexColor})})})}),this.drawInteraction.on("drawend",e=>{const i=e.feature.getProperties().geometry.getLength();this.emitLengthLineString.emit(i)}),this.map.addInteraction(this.drawInteraction)}loadModifyOption(){this.modify=new jn({source:this.source}),this.map.addInteraction(this.modify)}onDrawClick(){this.drawable=!this.drawable,this.drawable?this.loadDrawOption():this.clearDrawInteractions()}onModifyClick(){}saveVertex(){}clearVertex(){null!=this.source&&(this.clearDrawInteractions(),this.clearModifyInteractions(),this.drawable=!1,this.modified=!1,this.source.clear())}deleteVertex(){}clearDrawInteractions(){this.drawable=!1,null!=this.map&&(this.map.removeInteraction(this.drawInteraction),this.map.removeInteraction(this.snap))}clearModifyInteractions(){this.modified=!1,null!=this.map&&this.map.removeInteraction(this.modify)}addPointToMap(e,i,n){const s=new Ct.Z(new yt.Z(e));s.setId(i),s.setStyle(n),this.source.addFeature(s),this.source.changed()}removePointFromMap(e){const i=this.source.getFeatureById(e);i&&(this.source.removeFeature(i),this.source.changed())}goToPreviousPoint(){}goToNextPoint(){}goToNextPointAutomatic(){}stopGoToNextPointAutomatic(){}onTimeToChangePointChenge(e){}}return d.\u0275fac=function(e){return new(e||d)(c.Y36(c.sBO),c.Y36(c.Qsj))},d.\u0275cmp=c.Xpm({type:d,selectors:[["uwb-map"]],inputs:{background:"background",area:"area",vertexes:"vertexes",anchors:"anchors",drawable:"drawable",drawableLineString:"drawableLineString",modified:"modified",clear:"clear",vertexAlfa:"vertexAlfa",vertexBackgroundColor:"vertexBackgroundColor",vertexColor:"vertexColor",mapDisplayType:"mapDisplayType",mapWithButtons:"mapWithButtons",disabledMapButtons:"disabledMapButtons",styleClass:"styleClass",selectedMapPoint:"selectedMapPoint",mapClickMode:"mapClickMode"},outputs:{emitLengthLineString:"emitLengthLineString",emitNewPoint:"emitNewPoint",emitEditSelectedPoint:"emitEditSelectedPoint",emitDeleteSelectedPoint:"emitDeleteSelectedPoint"},features:[c.TTD],decls:8,vars:7,consts:[[3,"ngSwitch"],[3,"class",4,"ngSwitchCase"],["class","single_map_with_footer",4,"ngSwitchCase"],["id","popup",1,"overlay"],[4,"ngSwitchCase"],["id","map",1,"map"],[1,"single_map_with_footer"],[1,"buttons_container_center"],[4,"ngIf","ngIfElse"],["saveTemplate",""],["class","px-2",3,"disabled","icon","styleClass","label","onClick",4,"ngIf"],[1,"px-2",3,"disabled","icon","styleClass","label","onClick"],["styleClass","ui-button_size_125",1,"px-2",3,"disabled","label","onClick"],["styleClass","ui-button_size_125","type","button","data-dismiss","modal",3,"label","onClick"],[3,"disabledButtons","emitPreviousClick","emitNextClick","emitPlayClick","emitPauseClick","emitTimeToChangePoint",4,"ngIf"],[3,"disabledButtons","emitPreviousClick","emitNextClick","emitPlayClick","emitPauseClick","emitTimeToChangePoint"],["class","flex flex-column",4,"ngIf"],[1,"flex","flex-column"],[1,"p-1"],["class","buttons_container_center",4,"ngIf"],["styleClass","ui-button_size_125","icon","pi pi-pencil",1,"p-2",3,"pTooltip","onClick"],["styleClass","ui-button_size_125","icon","pi pi-times",1,"p-2",3,"pTooltip","onClick"]],template:function(e,i){1&e&&(c.ynx(0,0),c.YNc(1,ts,2,2,"div",1),c.YNc(2,os,6,2,"div",2),c.YNc(3,as,3,3,"div",1),c.BQk(),c.TgZ(4,"div",3),c.ynx(5,0),c.YNc(6,cs,2,1,"ng-container",4),c.YNc(7,us,2,1,"ng-container",4),c.BQk(),c.qZA()),2&e&&(c.Q6J("ngSwitch",i.mapDisplayType),c.xp6(1),c.Q6J("ngSwitchCase","normal"),c.xp6(1),c.Q6J("ngSwitchCase","mapWithButtons"),c.xp6(1),c.Q6J("ngSwitchCase","mapWithBodyInside"),c.xp6(2),c.Q6J("ngSwitch",i.overlayType),c.xp6(1),c.Q6J("ngSwitchCase","anchor"),c.xp6(1),c.Q6J("ngSwitchCase","tag"))},dependencies:[zn.u,qn.zx,ue.O5,ue.RF,ue.n9,Qn.Z,ue.uU,$n.X$],styles:[".map[_ngcontent-%COMP%]{width:100%;height:100%;border:2px solid var(--uwb-primary);border-radius:15px}  .ol-control{display:flex}  .ol-control button{background-color:var(--uwb-button-background);color:var(--uwb-button-text-color);height:30px;width:30px;border-radius:15px}.overlay[_ngcontent-%COMP%]{background:var(--uwb-background);color:var(--uwb-internal-tab-font-color);border:0 none;border-radius:var(--border-radius);box-shadow:0 1px 3px #0000004d;padding:10px;position:absolute}.overlay[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700;text-wrap:nowrap}  .ol-zoom{right:.5rem;left:auto}"]}),d})()}}]);